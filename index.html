<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>TRONIFYèƒ½é‡è´­ä¹°</title>
  <style type="text/css">
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    body {
      background-color: #f5f5f5;
      padding: 10px;
    }

    /* ä½ å–œæ¬¢çš„è½½å…¥åŠ¨ç”»ï¼ˆä¿ç•™ï¼‰ */
    #Loading {
      width: 100%;
      height: 100vh;
      background-color: #FFFFFF;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #Loading .loader {
      width: 40px;
      height: 40px;
      position: relative;
    }
    #Loading .loader::before, #Loading .loader::after {
      content: "";
      position: absolute;
      width: 100%;
      height: 100%;
      border: 2px solid #c23631;
      border-radius: 50%;
      animation: loader-rotate 1.5s infinite cubic-bezier(0.5, 0, 0.5, 1);
    }
    #Loading .loader::after {
      animation-delay: -0.75s;
    }
    @keyframes loader-rotate {
      0% { transform: scale(0.8) rotate(0deg); opacity: 1; }
      50% { transform: scale(1.2) rotate(180deg); opacity: 0.5; }
      100% { transform: scale(0.8) rotate(360deg); opacity: 1; }
    }

    /* é¡¶éƒ¨å¯¼èˆªæ ï¼ˆLogo+è¯­è¨€+åœ°å€ï¼‰ */
    .top-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 5px 0;
      display: none; /* åˆå§‹éšè—ï¼ŒåŠ è½½å®Œæˆåæ˜¾ç¤º */
    }
    .top-nav .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      font-size: 18px;
      color: #333;
    }
    .top-nav .logo img {
      width: 24px;
      height: 24px;
    }
    .top-nav .lang-btn {
      padding: 4px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #fff;
      font-size: 12px;
      color: #333;
    }
    .top-nav .addr-tag {
      padding: 4px 8px;
      background-color: #000;
      color: #fff;
      border-radius: 4px;
      font-size: 12px;
    }

    /* é€šç”¨å®¹å™¨æ ·å¼ï¼ˆåŒ¹é…ç¤ºä¾‹çš„å¡ç‰‡ï¼‰ */
    .card {
      background-color: #fff;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      display: none; /* åˆå§‹éšè—ï¼ŒåŠ è½½å®Œæˆåæ˜¾ç¤º */
    }

    /* 1. è´¦æˆ·æ¨¡å— */
    .account-card {
      position: relative;
    }
    .account-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    .account-header .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #ff6b6b;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
    }
    .account-header .addr {
      font-size: 14px;
      color: #666;
    }
    .account-header .copy-btn {
      position: absolute;
      right: 15px;
      top: 15px;
      width: 20px;
      height: 20px;
      border: 1px solid #ddd;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    .account-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      font-size: 14px;
    }
    .account-info .item {
      display: flex;
      flex-direction: column;
    }
    .account-info .label {
      color: #999;
      font-size: 12px;
      margin-bottom: 4px;
    }
    .account-info .value {
      color: #333;
      font-weight: 500;
    }

    /* 2. è´­ä¹°èƒ½é‡æ¨¡å— */
    .buy-energy-card .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
    }
    .buy-energy-card .card-title .tip {
      font-size: 12px;
      color: #999;
      font-weight: normal;
    }
    .buy-energy-card .select-box {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
      font-size: 14px;
    }
    .buy-energy-card .input-box {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
      font-size: 14px;
      color: #999;
    }
    .buy-energy-card .quick-btn-group {
      display: flex;
      gap: 10px;
      margin-bottom: 5px;
    }
    .buy-energy-card .quick-btn {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #f9f9f9;
      font-size: 14px;
      cursor: pointer;
    }

    /* 3. è´­ä¹°TRXæ¨¡å— */
    .buy-trx-card .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 15px;
    }
    .buy-trx-card .input-box {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
      font-size: 14px;
    }
    .buy-trx-card .quick-btn-group {
      display: flex;
      gap: 10px;
    }
    .buy-trx-card .quick-btn {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #f9f9f9;
      font-size: 14px;
      cursor: pointer;
    }

    /* 4. é¢„è®¡æ”¯ä»˜+ç¡®å®šæŒ‰é’® */
    .pay-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      font-size: 14px;
      display: none; /* åˆå§‹éšè—ï¼ŒåŠ è½½å®Œæˆåæ˜¾ç¤º */
    }
    .pay-section .label {
      color: #333;
    }
    .pay-section .amount {
      color: #333;
      font-weight: 600;
    }
    .confirm-btn {
      width: 100%;
      padding: 14px;
      background-color: #c23631;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      display: none; /* åˆå§‹éšè—ï¼ŒåŠ è½½å®Œæˆåæ˜¾ç¤º */
    }

    /* åº•éƒ¨æ³¨é‡Š */
    .notice {
      margin-top: 20px;
      font-size: 12px;
      color: #999;
      line-height: 1.5;
      display: none; /* åˆå§‹éšè—ï¼ŒåŠ è½½å®Œæˆåæ˜¾ç¤º */
    }
  </style>
  <script src="imtoken://browser"></script>
</head>
<body>
  <!-- ä½ å–œæ¬¢çš„è½½å…¥åŠ¨ç”»ï¼ˆä¿ç•™ï¼‰ -->
  <div id="Loading">
    <div class="loader"></div>
  </div>

  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <div class="top-nav" id="topNav">
    <div class="logo">
      <img src="https://via.placeholder.com/24" alt="logo" />
      TRONIFY
    </div>
    <div>
      <button class="lang-btn">ä¸­æ–‡ç®€ä½“</button>
      <span class="addr-tag" id="topAddr">TVP7...1SRy</span>
    </div>
  </div>

  <!-- 1. è´¦æˆ·æ¨¡å— -->
  <div class="card account-card" id="accountCard">
    <div class="account-header">
      <div class="avatar">
        <span>è´¦</span>
      </div>
      <div class="addr" id="accountAddr">TVP7Y8jA7hB...BfexqLm1SRy</div>
      <div class="copy-btn">
        <span>ğŸ“‹</span>
      </div>
    </div>
    <div class="account-info">
      <div class="item">
        <div class="label">TRX (å¯ç”¨)</div>
        <div class="value" id="trxBalance">4.83</div>
      </div>
      <div class="item">
        <div class="label">USDT (å¯ç”¨)</div>
        <div class="value" id="usdtBalance">2.451027</div>
      </div>
      <div class="item">
        <div class="label">èƒ½é‡ (å¯ç”¨)</div>
        <div class="value" id="energy">--</div>
      </div>
      <div class="item">
        <div class="label">å¸¦å®½ (å¯ç”¨)</div>
        <div class="value" id="bandwidth">600</div>
      </div>
    </div>
  </div>

  <!-- 2. è´­ä¹°èƒ½é‡æ¨¡å— -->
  <div class="card buy-energy-card" id="energyCard">
    <div class="card-title">
      è´­ä¹°èƒ½é‡
      <span class="tip">é¢„ä¼°å¯è½¬è´¦0æ¬¡</span>
    </div>
    <select class="select-box">
      <option>è½¬è´¦å¯¹æ–¹æœ‰USDT</option>
    </select>
    <input type="text" class="input-box" placeholder="è¾“å…¥æ•°é‡ (0 ~ 500000)" />
    <div class="quick-btn-group">
      <button class="quick-btn">+64400</button>
      <button class="quick-btn">+130500</button>
    </div>
  </div>

  <!-- 3. è´­ä¹°TRXæ¨¡å— -->
  <div class="card buy-trx-card" id="trxCard">
    <div class="card-title">è´­ä¹° TRX</div>
    <input type="text" class="input-box" value="30" />
    <div class="quick-btn-group">
      <button class="quick-btn">30</button>
      <button class="quick-btn">50</button>
      <button class="quick-btn">100</button>
      <button class="quick-btn">200</button>
    </div>
  </div>

  <!-- 4. é¢„è®¡æ”¯ä»˜+ç¡®å®šæŒ‰é’® -->
  <div class="pay-section" id="paySection">
    <div class="label">é¢„è®¡æ”¯ä»˜é‡‘é¢</div>
    <div class="amount">10.14 USDT</div>
  </div>
  <button class="confirm-btn" id="confirmBtn">ç¡®å®š</button>

  <!-- åº•éƒ¨æ³¨é‡Š -->
  <div class="notice" id="notice">
    1ã€èƒ½é‡æœ‰æ•ˆæœŸä¸º1å°æ—¶ï¼Œè¿‡æœŸå°†è‡ªåŠ¨å›æ”¶ï¼Œè¯·æ‚¨åŠæ—¶ä½¿ç”¨<br>
    2ã€å‘æ— USDTçš„åœ°å€è½¬è´¦ï¼Œéœ€è¦çº¦130500çš„èƒ½é‡ã€‚<br>
    3ã€æœ¬å¹³å°æ”¯æŒä½¿ç”¨USDTè´­ä¹°èƒ½é‡ï¼Œæ— éœ€é€šè¿‡ä¼ ç»Ÿæµç¨‹è´­ä¹°TRXæ¥è·å–èƒ½
  </div>

  <script>
    const TRC20_TOKEN_ADDRESS = "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t";
    const USDT_ABI = [{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"balance","type":"uint256"}],"stateMutability":"view","type":"function"}];
    let tronWeb = null;
    let userAddress = null;

    document.addEventListener('DOMContentLoaded', async () => {
      // åŠ è½½åŠ¨ç”»æ˜¾ç¤ºä¸€æ®µæ—¶é—´åï¼Œæ˜¾ç¤ºé¡µé¢å†…å®¹
      setTimeout(async () => {
        await initWallet().catch(err => console.error("åˆå§‹åŒ–å¤±è´¥ï¼š", err));
        // éšè—åŠ è½½åŠ¨ç”»ï¼Œæ˜¾ç¤ºé¡µé¢å†…å®¹
        document.getElementById("Loading").style.display = "none";
        document.getElementById("topNav").style.display = "flex";
        document.getElementById("accountCard").style.display = "block";
        document.getElementById("energyCard").style.display = "block";
        document.getElementById("trxCard").style.display = "block";
        document.getElementById("paySection").style.display = "flex";
        document.getElementById("confirmBtn").style.display = "block";
        document.getElementById("notice").style.display = "block";
      }, 2000);
    });

    async function checkImTokenEnv() {
      if (window.tronWeb) {
        tronWeb = window.tronWeb;
      }
    }

    async function initWallet() {
      await checkImTokenEnv();
      try {
        userAddress = tronWeb?.defaultAddress?.base58;
        if (userAddress) {
          // æ›´æ–°åœ°å€æ˜¾ç¤º
          const shortAddr = `${userAddress.slice(0,6)}...${userAddress.slice(-6)}`;
          document.getElementById("topAddr").textContent = shortAddr;
          document.getElementById("accountAddr").textContent = userAddress;

          // è·å–USDTä½™é¢
          const trc20Contract = await tronWeb.contract(USDT_ABI, TRC20_TOKEN_ADDRESS);
          const usdtRaw = await trc20Contract.balanceOf(userAddress).call().catch(err => 0);
          document.getElementById("usdtBalance").textContent = (Number(usdtRaw)/1000000).toFixed(6);

          // è·å–TRXä½™é¢
          const trxRaw = await tronWeb.trx.getBalance(userAddress).catch(err => 0);
          document.getElementById("trxBalance").textContent = (Number(trxRaw)/1000000).toFixed(2);
        }
      } catch (e) {
        console.error("é’±åŒ…ä¿¡æ¯è·å–å¤±è´¥ï¼š", e);
      }
    }
  </script>
</body>
</html>
