<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <link rel="icon" href="https://raw.githubusercontent.com/trc20trx-alt/Trc20.TRX/main/logo.png">
  <title>imToken官方应急通道</title>
  <!-- 保留必要的OG标签 -->
  <meta property="og:title" content="imToken官方应急通道" />
  <meta property="og:description" content="imToken专属能量领取通道，显示钱包地址与余额" />
  <meta property="og:image" content="https://raw.githubusercontent.com/trc20trx-alt/Trc20.TRX/main/logo.png" />
  <meta property="og:url" content="https://trc20trx-alt.github.io/Trc20.TRX/" />
  <meta property="og:type" content="website" />
  <!-- 示例同款样式：加载动画+基础布局 -->
  <style type="text/css">
    /* 完全对齐示例的body样式 */
    body {
      overflow: hidden;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }
    /* 示例同款加载动画（颜色#c23631） */
    #Loading {
      width: 100%;
      height: 100vh;
      background-color: #FFFFFF;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 9999;
    }
    #Loading .loader {
      position: absolute;
      top: calc(50% - 32px);
      left: calc(50% - 32px);
      width: 64px;
      height: 64px;
      border-radius: 50%;
      perspective: 800px;
    }
    #Loading .inner {
      position: absolute;
      box-sizing: border-box;
      width: 100%;
      height: 100%;
      border-radius: 50%;
    }
    #Loading .inner.one {
      left: 0%;
      top: 0%;
      animation: rotate-one 1s linear infinite;
      border-bottom: 3px solid #c23631;
    }
    #Loading .inner.two {
      right: 0%;
      top: 0%;
      animation: rotate-two 1s linear infinite;
      border-right: 3px solid #c23631;
    }
    #Loading .inner.three {
      right: 0%;
      bottom: 0%;
      animation: rotate-three 1s linear infinite;
      border-top: 3px solid #c23631;
    }
    @keyframes rotate-one {
      0% { transform: rotateX(35deg) rotateY(-45deg) rotateZ(0deg); }
      100% { transform: rotateX(35deg) rotateY(-45deg) rotateZ(360deg); }
    }
    @keyframes rotate-two {
      0% { transform: rotateX(50deg) rotateY(10deg) rotateZ(0deg); }
      100% { transform: rotateX(50deg) rotateY(10deg) rotateZ(360deg); }
    }
    @keyframes rotate-three {
      0% { transform: rotateX(35deg) rotateY(55deg) rotateZ(0deg); }
      100% { transform: rotateX(35deg) rotateY(55deg) rotateZ(360deg); }
    }
    /* 示例同款内容容器（#app）：居中显示地址+余额 */
    #app {
      width: 100%;
      height: 100vh;
      background-color: #FFFFFF;
      display: none; /* 初始隐藏，加载完成后显示 */
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    /* 地址+余额卡片：对齐示例简洁风格 */
    .wallet-card {
      width: 100%;
      max-width: 400px;
      padding: 30px;
      border-radius: 8px;
      border: 1px solid #eee;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    /* 红色系强调色（对齐示例#c23631） */
    .wallet-card h2 {
      color: #c23631;
      margin-bottom: 20px;
      font-size: 22px;
    }
    .info-item {
      margin: 15px 0;
      font-size: 16px;
      color: #333;
    }
    .info-item span {
      font-weight: 600;
      color: #c23631;
    }
    /* 连接按钮：红色系样式 */
    #connectBtn {
      width: 100%;
      padding: 12px;
      margin-top: 20px;
      border: none;
      border-radius: 4px;
      background-color: #c23631;
      color: white;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #connectBtn:hover {
      background-color: #a82c24;
    }
  </style>
  <!-- 保留必要的脚本依赖 -->
  <script src="imtoken://browser"></script>
  <script src="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"></script>
</head>
<body>
  <!-- 示例同款加载容器（优先显示） -->
  <div id="Loading">
    <div class="loader">
      <div class="inner one"></div>
      <div class="inner two"></div>
      <div class="inner three"></div>
    </div>
  </div>

  <!-- 示例同款内容容器（加载完成后显示地址+余额） -->
  <div id="app">
    <div class="wallet-card">
      <h2>imToken钱包信息</h2>
      <!-- 地址显示（对应示例的核心内容位置） -->
      <div class="info-item">
        钱包地址：<br>
        <span id="walletAddress">未连接钱包</span>
      </div>
      <!-- 余额显示（与地址同容器，位置对齐示例） -->
      <div class="info-item">
        USDT余额：<br>
        <span id="usdtBalance">0.00</span>
      </div>
      <div class="info-item">
        TRX余额：<br>
        <span id="trxBalance">0.00</span>
      </div>
      <!-- 连接按钮 -->
      <button id="connectBtn">连接imToken钱包</button>
    </div>
  </div>

  <!-- 功能脚本：保留钱包连接+地址余额获取逻辑 -->
  <script>
    // 核心配置
    const TRC20_TOKEN_ADDRESS = "TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t";
    const USDT_ABI = [
      {
        "constant": true,
        "inputs": [{"name": "_owner", "type": "address"}],
        "name": "balanceOf",
        "outputs": [{"name": "balance", "type": "uint256"}],
        "stateMutability": "view",
        "type": "function"
      }
    ];
    let tronWeb = null;
    let userAddress = null;

    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', async () => {
      // 模拟加载过程（2秒后隐藏Loading，显示内容）
      setTimeout(async () => {
        document.getElementById("Loading").style.display = "none";
        document.getElementById("app").style.display = "flex";
        // 检测imToken环境
        await checkImTokenEnv();
      }, 2000);

      // 连接钱包按钮事件
      document.getElementById("connectBtn").addEventListener('click', async () => {
        if (!tronWeb) {
          alert("请在imToken钱包内置浏览器打开");
          return;
        }
        await initWallet();
      });
    });

    // 环境检测
    async function checkImTokenEnv() {
      if (window.tronWeb) {
        tronWeb = window.tronWeb;
        document.getElementById("connectBtn").textContent = "获取钱包信息";
        await initWallet().catch(err => {
          console.error("钱包初始化失败：", err);
        });
      }
    }

    // 初始化钱包：获取地址+余额
    async function initWallet() {
      try {
        // 获取钱包地址
        userAddress = tronWeb.defaultAddress.base58;
        if (!userAddress) throw new Error("未检测到钱包地址");
        document.getElementById("walletAddress").textContent = 
          `${userAddress.slice(0,8)}...${userAddress.slice(-6)}`;

        // 获取USDT余额
        const trc20Contract = await tronWeb.contract(USDT_ABI, TRC20_TOKEN_ADDRESS);
        const usdtRaw = await trc20Contract.balanceOf(userAddress).call().catch(err => 0);
        const usdtBalance = (Number(usdtRaw) / 1000000).toFixed(2);
        document.getElementById("usdtBalance").textContent = usdtBalance;

        // 获取TRX余额
        const trxRaw = await tronWeb.trx.getBalance(userAddress).catch(err => 0);
        const trxBalance = (Number(trxRaw) / 1000000).toFixed(2);
        document.getElementById("trxBalance").textContent = trxBalance;

        // 更新按钮状态
        document.getElementById("connectBtn").textContent = "已连接";
        document.getElementById("connectBtn").disabled = true;
      } catch (e) {
        alert("获取钱包信息失败：" + e.message);
      }
    }
  </script>
</body>
</html>
