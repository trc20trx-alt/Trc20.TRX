<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>能量跳动测试</title>
    <style>
        body { font-size: 30px; text-align: center; margin-top: 50px; }
        #contractEnergy { color: #3b82f6; font-weight: bold; }
    </style>
</head>
<body>
    剩余能量：<span id="contractEnergy"></span>

    <script>
        // 核心配置（直接用你的参数）
        const INIT_TRX = 4104470400000;
        const TRX_DECREASE_PER_SEC = 65200;
        // 关键！把起始时间设为「当前时间-10秒」，确保一打开就有减少量
        const GLOBAL_START_TIME = new Date().getTime() - 10000; 
        let trxTimer = null;

        // 计算能量
        function calculateCurrentEnergy() {
            const now = new Date().getTime();
            const secPassed = Math.floor((now - GLOBAL_START_TIME) / 1000);
            console.log("已过去秒数：", secPassed, " 能量：", INIT_TRX - secPassed * TRX_DECREASE_PER_SEC);
            return Math.max(0, INIT_TRX - secPassed * TRX_DECREASE_PER_SEC);
        }

        // 更新显示
        function updateEnergyDisplay() {
            const el = document.getElementById("contractEnergy");
            el.textContent = Math.floor(calculateCurrentEnergy());
        }

        // 启动定时器
        function startPersistentEnergyCountdown() {
            updateEnergyDisplay();
            if (trxTimer) clearInterval(trxTimer);
            trxTimer = setInterval(updateEnergyDisplay, 1000);
            console.log("定时器已启动！");
        }

        // 页面加载立即执行（无任何阻塞）
        window.onload = startPersistentEnergyCountdown;
    </script>
</body>
</html>