!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).WalletConnectTronProvider=t()}(this,(function(){"use strict";var e=Object.defineProperty;var r=Object.getOwnPropertyDescriptor;var n=Object.getOwnPropertyNames;var o=Object.prototype.hasOwnProperty;var a=(t,i)=>{for(var s in i)e(t,s,{get:i[s],enumerable:!0})},c=(t,i,s,l)=>{if(i&&typeof i=="object"||typeof i=="function")for(let u of n(i))!o.call(t,u)&&(s||u!=="default")&&e(t,u,{get:()=>i[u],enumerable:!(l=r(i,u))||l.enumerable});return t};var i=(t,i,s)=>()=>(s||i((s={exports:{}}).exports,t,s),s.exports);var s=i((function(t,i){(function(){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var l=require("events"),u=s(l),d=require("@walletconnect/types"),f=s(d),p=require("@walletconnect/utils"),m=s(p),h=require("tronweb"),v=s(h);var w=function(e){u.default.call(this),this._events=this._events||{},this._eventsCount=this._eventsCount||0,this.connector=e,this.accounts=[],this.chainId=null,this.rpcMap=void 0,this.tronWeb=void 0};w.prototype=Object.create(u.default.prototype),w.prototype.constructor=w,w.prototype.connect=function(){var e=this;return new Promise((function(t,i){try{e.connector.on("session_update",(function(t){var i=t.params[0].namespaces;e._updateSession(i),e.emit("session_update",t)}));e.connector.on("disconnect",(function(t){e.emit("disconnect",t)}));var s=e.connector.session;if(s){var l=s.namespaces.tron;e._updateSession(l),t({accounts:e.accounts,chainId:e.chainId})}else e.connector.on("connect",(function(t){var i=t.params[0].namespaces.tron;e._updateSession(i),t({accounts:e.accounts,chainId:e.chainId})}))}catch(t){i(t)}}))},w.prototype.disconnect=function(){return this.connector.disconnect()},w.prototype._updateSession=function(e){this.accounts=e.accounts.map((function(e){return e.split(":")[2]})),this.chainId=parseInt(e.chains[0].split(":")[1],10)},w.prototype.request=function(e){var t=this;return new Promise((function(i,s){if("tron_accounts"===e.method)i(t.accounts);else if("tron_signTransaction"===e.method)t._signTransaction(e.params[0]).then(i).catch(s);else if("tron_signMessage"===e.method)t._signMessage(e.params[0],e.params[1]).then(i).catch(s);else if("tron_signTypedData"===e.method)t._signTypedData(e.params[0],e.params[1]).then(i).catch(s);else s(new Error("Unsupported method: ".concat(e.method)))}))},w.prototype._signTransaction=function(e){var t=this;return new Promise((function(i,s){try{var n=t._formatTransaction(e);t.connector.request({method:"tron_signTransaction",params:[n]}).then((function(e){i(e)}))}catch(e){s(e)}}))},w.prototype._signMessage=function(e,t){var i=this;return new Promise((function(s,l){try{i.connector.request({method:"tron_signMessage",params:[e,t]}).then((function(e){s(e)}))}catch(e){l(e)}}))},w.prototype._signTypedData=function(e,t){var i=this;return new Promise((function(s,l){try{i.connector.request({method:"tron_signTypedData",params:[e,t]}).then((function(e){s(e)}))}catch(e){l(e)}}))},w.prototype._formatTransaction=function(e){var t=e.from,i=e.to,s=e.value||"0x0",l=e.data||"0x0",u=e.gas||"0x1e240",d=e.gasPrice||"0x0",f=e.nonce;return{from:t,to:i,value:s,data:l,gas:u,gasPrice:d,nonce:f}},w.prototype.on=function(e,t){this.connector.on(e,t)},w.prototype.off=function(e,t){this.connector.off(e,t)};var b=function(e){var t=e.core,i=e.projectId,s=e.rpcMap,l=e.metadata,u=e.chainId,d=e.showQrModal,f=e.qrModalOptions;this.core=t,this.projectId=i,this.rpcMap=s,this.metadata=l,this.chainId=u,this.showQrModal=d,this.qrModalOptions=f,this.connector=void 0,this.provider=void 0};b.prototype.init=function(){var e=this;return new Promise((function(t,i){try{var s=e.core||m.default.Core({projectId:e.projectId}),l={requiredNamespaces:{tron:{chains:["tron:".concat(e.chainId)],methods:["tron_accounts","tron_signTransaction","tron_signMessage","tron_signTypedData"],events:[]}}},u=new m.default.Connector({core:s,metadata:e.metadata}),d=e.showQrModal!==!1,f=e.qrModalOptions;if(d){var p=m.default.QRCodeModal;u.on("display_uri",(function(e){p.open(e,f)}))}u.on("connect",(function(){d&&p.close()})),u.on("disconnect",(function(){d&&p.close()})),u.on("session_delete",(function(){d&&p.close()})),e.connector=u,e.provider=new w(u),e.connector.connect(l).then((function(){t(e.provider)})).catch((function(t){i(t)}))}catch(t){i(t)}}))};var y=function(e){var t=e.projectId,i=e.rpcMap=e.rpcMap||{195:"https://api.trongrid.io"},s=e.chainId=e.chainId||195,l=e.metadata=e.metadata||{name:"Tron WalletConnect",description:"Tron WalletConnect Provider",url:"https://walletconnect.com",icons:["https://walletconnect.com/walletconnect-logo.png"]},u=e.showQrModal,d=e.qrModalOptions;this.projectId=t,this.rpcMap=i,this.chainId=s,this.metadata=l,this.showQrModal=u,this.qrModalOptions=d,this.core=void 0,this.connector=void 0,this.provider=void 0,this.tronWeb=void 0};y.prototype.connect=function(){var e=this;return new Promise((function(t,i){try{var s=new b({projectId:e.projectId,rpcMap:e.rpcMap,metadata:e.metadata,chainId:e.chainId,showQrModal:e.showQrModal,qrModalOptions:e.qrModalOptions});s.init().then((function(t){e.provider=t,e.tronWeb=e._createTronWeb(),t.on("session_update",(function(){e.tronWeb=e._createTronWeb()})),t.on("disconnect",(function(){e.tronWeb=void 0})),t.on("session_delete",(function(){e.tronWeb=void 0})),t.on("chainChanged",(function(){e.tronWeb=e._createTronWeb()})),t.on("accountsChanged",(function(){e.tronWeb=e._createTronWeb()})),t.on("networkChanged",(function(){e.tronWeb=e._createTronWeb()})),t.connector.on("session_update",(function(){e.tronWeb=e._createTronWeb()})),t.connector.on("disconnect",(function(){e.tronWeb=void 0})),t.connector.on("session_delete",(function(){e.tronWeb=void 0})),t.connector.on("chainChanged",(function(){e.tronWeb=e._createTronWeb()})),t.connector.on("accountsChanged",(function(){e.tronWeb=e._createTronWeb()})),t.connector.on("networkChanged",(function(){e.tronWeb=e._createTronWeb()})),t}))}catch(t){i(t)}}))},y.prototype._createTronWeb=function(){var e=this;return new v.default({fullHost:e.rpcMap[e.chainId],privateKey:"",provider:{sendAsync:function(t,i){e.provider.request(t).then((function(e){i(null,e)})).catch((function(e){i(e,null)}))},send:function(t,i){e.provider.request(t).then((function(e){i(null,e)})).catch((function(e){i(e,null)}))}}})},y.prototype.disconnect=function(){return this.connector.disconnect()},y.prototype.on=function(e,t){this.provider.on(e,t)},y.prototype.off=function(e,t){this.provider.off(e,t)};i.exports=y}).call(this)}));var l=c({__proto__:null,default:i},[i]);var u=l.default;return u}));